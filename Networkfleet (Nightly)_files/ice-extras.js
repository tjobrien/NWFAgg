if (!window.Ice.Extras) {
    window.Ice.Extras = true;
var Ajax={getTransport:function(){return Try.these(function(){return new XMLHttpRequest()},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")})||false},activeRequestCount:0};Ajax.Responders={responders:[],_each:function(iterator){this.responders._each(iterator)},register:function(responder){if(!this.include(responder)){this.responders.push(responder)}},unregister:function(responder){this.responders=this.responders.without(responder)},dispatch:function(callback,request,transport,json){this.each(function(responder){if(Object.isFunction(responder[callback])){try{responder[callback].apply(responder,[request,transport,json])}catch(e){}}})}};Object.extend(Ajax.Responders,Enumerable);Ajax.Responders.register({onCreate:function(){Ajax.activeRequestCount++},onComplete:function(){Ajax.activeRequestCount--}});Ajax.Base=Class.create({initialize:function(options){this.options={method:"post",asynchronous:true,contentType:"application/x-www-form-urlencoded",encoding:"UTF-8",parameters:"",evalJSON:true,evalJS:true};Object.extend(this.options,options||{});this.options.method=this.options.method.toLowerCase();if(Object.isHash(this.options.parameters)){this.options.parameters=this.options.parameters.toObject()}}});Ajax.Request=Class.create(Ajax.Base,{_complete:false,initialize:function($super,url,options){$super(options);this.transport=Ajax.getTransport();this.request(url)},request:function(url){this.url=url;this.method=this.options.method;var params=Object.isString(this.options.parameters)?this.options.parameters:Object.toQueryString(this.options.parameters);if(!["get","post"].include(this.method)){params+=(params?"&":"")+"_method="+this.method;this.method="post"}if(params&&this.method==="get"){this.url+=(this.url.include("?")?"&":"?")+params}this.parameters=params.toQueryParams();try{var response=new Ajax.Response(this);if(this.options.onCreate){this.options.onCreate(response)}Ajax.Responders.dispatch("onCreate",this,response);this.transport.open(this.method.toUpperCase(),this.url,this.options.asynchronous);if(this.options.asynchronous){this.respondToReadyState.bind(this).defer(1)}this.transport.onreadystatechange=this.onStateChange.bind(this);this.setRequestHeaders();this.body=this.method=="post"?(this.options.postBody||params):null;this.transport.send(this.body);if(!this.options.asynchronous&&this.transport.overrideMimeType){this.onStateChange()}}catch(e){this.dispatchException(e)}},onStateChange:function(){var readyState=this.transport.readyState;if(readyState>1&&!((readyState==4)&&this._complete)){this.respondToReadyState(this.transport.readyState)}},setRequestHeaders:function(){var headers={"X-Requested-With":"XMLHttpRequest","X-Prototype-Version":Prototype.Version,Accept:"text/javascript, text/html, application/xml, text/xml, */*"};if(this.method=="post"){headers["Content-type"]=this.options.contentType+(this.options.encoding?"; charset="+this.options.encoding:"");if(this.transport.overrideMimeType&&(navigator.userAgent.match(/Gecko\/(\d{4})/)||[0,2005])[1]<2005){headers.Connection="close"}}if(typeof this.options.requestHeaders=="object"){var extras=this.options.requestHeaders;if(Object.isFunction(extras.push)){for(var i=0,length=extras.length;i<length;i+=2){headers[extras[i]]=extras[i+1]}}else{$H(extras).each(function(pair){headers[pair.key]=pair.value})}}for(var name in headers){this.transport.setRequestHeader(name,headers[name])}},success:function(){var status=this.getStatus();return !status||(status>=200&&status<300)||status==304},getStatus:function(){try{if(this.transport.status===1223){return 204}return this.transport.status||0}catch(e){return 0}},respondToReadyState:function(readyState){var state=Ajax.Request.Events[readyState],response=new Ajax.Response(this);if(state=="Complete"){try{this._complete=true;(this.options["on"+response.status]||this.options["on"+(this.success()?"Success":"Failure")]||Prototype.emptyFunction)(response,response.headerJSON)}catch(e){this.dispatchException(e)}var contentType=response.getHeader("Content-type");if(this.options.evalJS=="force"||(this.options.evalJS&&this.isSameOrigin()&&contentType&&contentType.match(/^\s*(text|application)\/(x-)?(java|ecma)script(;.*)?\s*$/i))){this.evalResponse()}}try{(this.options["on"+state]||Prototype.emptyFunction)(response,response.headerJSON);Ajax.Responders.dispatch("on"+state,this,response,response.headerJSON)}catch(e){this.dispatchException(e)}if(state=="Complete"){this.transport.onreadystatechange=Prototype.emptyFunction}},isSameOrigin:function(){var m=this.url.match(/^\s*https?:\/\/[^\/]*/);return !m||(m[0]=="#{protocol}//#{domain}#{port}".interpolate({protocol:location.protocol,domain:document.domain,port:location.port?":"+location.port:""}))},getHeader:function(name){try{return this.transport.getResponseHeader(name)||null}catch(e){return null}},evalResponse:function(){try{return eval((this.transport.responseText||"").unfilterJSON())}catch(e){this.dispatchException(e)}},dispatchException:function(exception){(this.options.onException||Prototype.emptyFunction)(this,exception);Ajax.Responders.dispatch("onException",this,exception)}});Ajax.Request.Events=["Uninitialized","Loading","Loaded","Interactive","Complete"];Ajax.Response=Class.create({initialize:function(request){this.request=request;var transport=this.transport=request.transport,readyState=this.readyState=transport.readyState;if((readyState>2&&!Prototype.Browser.IE)||readyState==4){this.status=this.getStatus();this.statusText=this.getStatusText();this.responseText=String.interpret(transport.responseText);this.headerJSON=this._getHeaderJSON()}if(readyState==4){var xml=transport.responseXML;this.responseXML=Object.isUndefined(xml)?null:xml;this.responseJSON=this._getResponseJSON()}},status:0,statusText:"",getStatus:Ajax.Request.prototype.getStatus,getStatusText:function(){try{return this.transport.statusText||""}catch(e){return""}},getHeader:Ajax.Request.prototype.getHeader,getAllHeaders:function(){try{return this.getAllResponseHeaders()}catch(e){return null}},getResponseHeader:function(name){return this.transport.getResponseHeader(name)},getAllResponseHeaders:function(){return this.transport.getAllResponseHeaders()},_getHeaderJSON:function(){var json=this.getHeader("X-JSON");if(!json){return null}json=decodeURIComponent(escape(json));try{return json.evalJSON(this.request.options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}},_getResponseJSON:function(){var options=this.request.options;if(!options.evalJSON||(options.evalJSON!="force"&&!(this.getHeader("Content-type")||"").include("application/json"))||this.responseText.blank()){return null}try{return this.responseText.evalJSON(options.sanitizeJSON||!this.request.isSameOrigin())}catch(e){this.request.dispatchException(e)}}});Ajax.Updater=Class.create(Ajax.Request,{initialize:function($super,container,url,options){this.container={success:(container.success||container),failure:(container.failure||(container.success?null:container))};options=Object.clone(options);var onComplete=options.onComplete;options.onComplete=(function(response,json){this.updateContent(response.responseText);if(Object.isFunction(onComplete)){onComplete(response,json)}}).bind(this);$super(url,options)},updateContent:function(responseText){var receiver=this.container[this.success()?"success":"failure"],options=this.options;if(!options.evalScripts){responseText=responseText.stripScripts()}if(receiver=$(receiver)){if(options.insertion){if(Object.isString(options.insertion)){var insertion={};insertion[options.insertion]=responseText;receiver.insert(insertion)}else{options.insertion(receiver,responseText)}}else{receiver.update(responseText)}}}});Ajax.PeriodicalUpdater=Class.create(Ajax.Base,{initialize:function($super,container,url,options){$super(options);this.onComplete=this.options.onComplete;this.frequency=(this.options.frequency||2);this.decay=(this.options.decay||1);this.updater={};this.container=container;this.url=url;this.start()},start:function(){this.options.onComplete=this.updateComplete.bind(this);this.onTimerEvent()},stop:function(){this.updater.options.onComplete=undefined;clearTimeout(this.timer);(this.onComplete||Prototype.emptyFunction).apply(this,arguments)},updateComplete:function(response){if(this.options.decay){this.decay=(response.responseText==this.lastText?this.decay*this.options.decay:1);this.lastText=response.responseText}this.timer=this.onTimerEvent.bind(this).delay(this.decay*this.frequency)},onTimerEvent:function(){this.updater=new Ajax.Updater(this.container,this.url,this.options)}});
function $(element){if(arguments.length>1){for(var i=0,elements=[],length=arguments.length;i<length;i++){elements.push($(arguments[i]))}return elements}if(Object.isString(element)){element=document.getElementById(element)}return Element.extend(element)}if(Prototype.BrowserFeatures.XPath){document._getElementsByXPath=function(expression,parentElement){var results=[];var query=document.evaluate(expression,$(parentElement)||document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var i=0,length=query.snapshotLength;i<length;i++){results.push(Element.extend(query.snapshotItem(i)))}return results}}if(!Node){var Node={}}if(!Node.ELEMENT_NODE){Object.extend(Node,{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12})}(function(global){function shouldUseCache(tagName,attributes){if(tagName==="select"){return false}if("type" in attributes){return false}return true}var HAS_EXTENDED_CREATE_ELEMENT_SYNTAX=(function(){try{var el=document.createElement('<input name="x">');return el.tagName.toLowerCase()==="input"&&el.name==="x"}catch(err){return false}})();var element=global.Element;global.Element=function(tagName,attributes){attributes=attributes||{};tagName=tagName.toLowerCase();var cache=Element.cache;if(HAS_EXTENDED_CREATE_ELEMENT_SYNTAX&&attributes.name){tagName="<"+tagName+' name="'+attributes.name+'">';delete attributes.name;return Element.writeAttribute(document.createElement(tagName),attributes)}if(!cache[tagName]){cache[tagName]=Element.extend(document.createElement(tagName))}var node=shouldUseCache(tagName,attributes)?cache[tagName].cloneNode(false):document.createElement(tagName);return Element.writeAttribute(node,attributes)};Object.extend(global.Element,element||{});if(element){global.Element.prototype=element.prototype}})(this);Element.idCounter=1;Element.cache={};Element._purgeElement=function(element){var uid=element._prototypeUID;if(uid){Element.stopObserving(element);element._prototypeUID=void 0;delete Element.Storage[uid]}};Element.Methods={visible:function(element){return $(element).style.display!="none"},toggle:function(element){element=$(element);Element[Element.visible(element)?"hide":"show"](element);return element},hide:function(element){element=$(element);element.style.display="none";return element},show:function(element){element=$(element);element.style.display="";return element},remove:function(element){element=$(element);element.parentNode.removeChild(element);return element},update:(function(){var SELECT_ELEMENT_INNERHTML_BUGGY=(function(){var el=document.createElement("select"),isBuggy=true;el.innerHTML='<option value="test">test</option>';if(el.options&&el.options[0]){isBuggy=el.options[0].nodeName.toUpperCase()!=="OPTION"}el=null;return isBuggy})();var TABLE_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("table");if(el&&el.tBodies){el.innerHTML="<tbody><tr><td>test</td></tr></tbody>";var isBuggy=typeof el.tBodies[0]=="undefined";el=null;return isBuggy}}catch(e){return true}})();var LINK_ELEMENT_INNERHTML_BUGGY=(function(){try{var el=document.createElement("div");el.innerHTML="<link>";var isBuggy=(el.childNodes.length===0);el=null;return isBuggy}catch(e){return true}})();var ANY_INNERHTML_BUGGY=SELECT_ELEMENT_INNERHTML_BUGGY||TABLE_ELEMENT_INNERHTML_BUGGY||LINK_ELEMENT_INNERHTML_BUGGY;var SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING=(function(){var s=document.createElement("script"),isBuggy=false;try{s.appendChild(document.createTextNode(""));isBuggy=!s.firstChild||s.firstChild&&s.firstChild.nodeType!==3}catch(e){isBuggy=true}s=null;return isBuggy})();function update(element,content){element=$(element);var purgeElement=Element._purgeElement;var descendants=element.getElementsByTagName("*"),i=descendants.length;while(i--){purgeElement(descendants[i])}if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){return element.update().insert(content)}content=Object.toHTML(content);var tagName=element.tagName.toUpperCase();if(tagName==="SCRIPT"&&SCRIPT_ELEMENT_REJECTS_TEXTNODE_APPENDING){element.text=content;return element}if(ANY_INNERHTML_BUGGY){if(tagName in Element._insertionTranslations.tags){while(element.firstChild){element.removeChild(element.firstChild)}Element._getContentFromAnonymousElement(tagName,content.stripScripts()).each(function(node){element.appendChild(node)})}else{if(LINK_ELEMENT_INNERHTML_BUGGY&&Object.isString(content)&&content.indexOf("<link")>-1){while(element.firstChild){element.removeChild(element.firstChild)}var nodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts(),true);nodes.each(function(node){element.appendChild(node)})}else{element.innerHTML=content.stripScripts()}}}else{element.innerHTML=content.stripScripts()}content.evalScripts.bind(content).defer();return element}return update})(),replace:function(element,content){element=$(element);if(content&&content.toElement){content=content.toElement()}else{if(!Object.isElement(content)){content=Object.toHTML(content);var range=element.ownerDocument.createRange();range.selectNode(element);content.evalScripts.bind(content).defer();content=range.createContextualFragment(content.stripScripts())}}element.parentNode.replaceChild(content,element);return element},insert:function(element,insertions){element=$(element);if(Object.isString(insertions)||Object.isNumber(insertions)||Object.isElement(insertions)||(insertions&&(insertions.toElement||insertions.toHTML))){insertions={bottom:insertions}}var content,insert,tagName,childNodes;for(var position in insertions){content=insertions[position];position=position.toLowerCase();insert=Element._insertionTranslations[position];if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){insert(element,content);continue}content=Object.toHTML(content);tagName=((position=="before"||position=="after")?element.parentNode:element).tagName.toUpperCase();childNodes=Element._getContentFromAnonymousElement(tagName,content.stripScripts());if(position=="top"||position=="after"){childNodes.reverse()}childNodes.each(insert.curry(element));content.evalScripts.bind(content).defer()}return element},wrap:function(element,wrapper,attributes){element=$(element);if(Object.isElement(wrapper)){$(wrapper).writeAttribute(attributes||{})}else{if(Object.isString(wrapper)){wrapper=new Element(wrapper,attributes)}else{wrapper=new Element("div",wrapper)}}if(element.parentNode){element.parentNode.replaceChild(wrapper,element)}wrapper.appendChild(element);return wrapper},inspect:function(element){element=$(element);var result="<"+element.tagName.toLowerCase();$H({id:"id",className:"class"}).each(function(pair){var property=pair.first(),attribute=pair.last(),value=(element[property]||"").toString();if(value){result+=" "+attribute+"="+value.inspect(true)}});return result+">"},recursivelyCollect:function(element,property,maximumLength){element=$(element);maximumLength=maximumLength||-1;var elements=[];while(element=element[property]){if(element.nodeType==1){elements.push(Element.extend(element))}if(elements.length==maximumLength){break}}return elements},ancestors:function(element){return Element.recursivelyCollect(element,"parentNode")},descendants:function(element){return Element.select(element,"*")},firstDescendant:function(element){element=$(element).firstChild;while(element&&element.nodeType!=1){element=element.nextSibling}return $(element)},immediateDescendants:function(element){var results=[],child=$(element).firstChild;while(child){if(child.nodeType===1){results.push(Element.extend(child))}child=child.nextSibling}return results},previousSiblings:function(element,maximumLength){return Element.recursivelyCollect(element,"previousSibling")},nextSiblings:function(element){return Element.recursivelyCollect(element,"nextSibling")},siblings:function(element){element=$(element);return Element.previousSiblings(element).reverse().concat(Element.nextSiblings(element))},match:function(element,selector){element=$(element);if(Object.isString(selector)){return Prototype.Selector.match(element,selector)}return selector.match(element)},up:function(element,expression,index){element=$(element);if(arguments.length==1){return $(element.parentNode)}var ancestors=Element.ancestors(element);return Object.isNumber(expression)?ancestors[expression]:Prototype.Selector.find(ancestors,expression,index)},down:function(element,expression,index){element=$(element);if(arguments.length==1){return Element.firstDescendant(element)}return Object.isNumber(expression)?Element.descendants(element)[expression]:Element.select(element,expression)[index||0]},previous:function(element,expression,index){element=$(element);if(Object.isNumber(expression)){index=expression,expression=false}if(!Object.isNumber(index)){index=0}if(expression){return Prototype.Selector.find(element.previousSiblings(),expression,index)}else{return element.recursivelyCollect("previousSibling",index+1)[index]}},next:function(element,expression,index){element=$(element);if(Object.isNumber(expression)){index=expression,expression=false}if(!Object.isNumber(index)){index=0}if(expression){return Prototype.Selector.find(element.nextSiblings(),expression,index)}else{var maximumLength=Object.isNumber(index)?index+1:1;return element.recursivelyCollect("nextSibling",index+1)[index]}},select:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(expressions,element)},adjacent:function(element){element=$(element);var expressions=Array.prototype.slice.call(arguments,1).join(", ");return Prototype.Selector.select(expressions,element.parentNode).without(element)},identify:function(element){element=$(element);var id=Element.readAttribute(element,"id");if(id){return id}do{id="anonymous_element_"+Element.idCounter++}while($(id));Element.writeAttribute(element,"id",id);return id},readAttribute:function(element,name){element=$(element);if(Prototype.Browser.IE){var t=Element._attributeTranslations.read;if(t.values[name]){return t.values[name](element,name)}if(t.names[name]){name=t.names[name]}if(name.include(":")){return(!element.attributes||!element.attributes[name])?null:element.attributes[name].value}}return element.getAttribute(name)},writeAttribute:function(element,name,value){element=$(element);var attributes={},t=Element._attributeTranslations.write;if(typeof name=="object"){attributes=name}else{attributes[name]=Object.isUndefined(value)?true:value}for(var attr in attributes){name=t.names[attr]||attr;value=attributes[attr];if(t.values[attr]){name=t.values[attr](element,value)}if(value===false||value===null){element.removeAttribute(name)}else{if(value===true){element.setAttribute(name,name)}else{element.setAttribute(name,value)}}}return element},getHeight:function(element){return Element.getDimensions(element).height},getWidth:function(element){return Element.getDimensions(element).width},classNames:function(element){return new Element.ClassNames(element)},hasClassName:function(element,className){if(!(element=$(element))){return }var elementClassName=element.className;return(elementClassName.length>0&&(elementClassName==className||new RegExp("(^|\\s)"+className+"(\\s|$)").test(elementClassName)))},addClassName:function(element,className){if(!(element=$(element))){return }if(!Element.hasClassName(element,className)){element.className+=(element.className?" ":"")+className}return element},removeClassName:function(element,className){if(!(element=$(element))){return }element.className=element.className.replace(new RegExp("(^|\\s+)"+className+"(\\s+|$)")," ").strip();return element},toggleClassName:function(element,className){if(!(element=$(element))){return }return Element[Element.hasClassName(element,className)?"removeClassName":"addClassName"](element,className)},cleanWhitespace:function(element){element=$(element);var node=element.firstChild;while(node){var nextNode=node.nextSibling;if(node.nodeType==3&&!/\S/.test(node.nodeValue)){element.removeChild(node)}node=nextNode}return element},empty:function(element){return $(element).innerHTML.blank()},descendantOf:function(element,ancestor){element=$(element),ancestor=$(ancestor);if(element.compareDocumentPosition){return(element.compareDocumentPosition(ancestor)&8)===8}if(ancestor.contains){return ancestor.contains(element)&&ancestor!==element}while(element=element.parentNode){if(element==ancestor){return true}}return false},scrollTo:function(element){element=$(element);var pos=Element.cumulativeOffset(element);window.scrollTo(pos[0],pos[1]);return element},getStyle:function(element,style){element=$(element);style=style=="float"?"cssFloat":style.camelize();var value=element.style[style];if(!value||value=="auto"){var css=document.defaultView.getComputedStyle(element,null);value=css?css[style]:null}if(style=="opacity"){return value?parseFloat(value):1}return value=="auto"?null:value},getOpacity:function(element){return $(element).getStyle("opacity")},setStyle:function(element,styles){element=$(element);var elementStyle=element.style,match;if(Object.isString(styles)){element.style.cssText+=";"+styles;return styles.include("opacity")?element.setOpacity(styles.match(/opacity:\s*(\d?\.?\d*)/)[1]):element}for(var property in styles){if(property=="opacity"){element.setOpacity(styles[property])}else{elementStyle[(property=="float"||property=="cssFloat")?(Object.isUndefined(elementStyle.styleFloat)?"cssFloat":"styleFloat"):property]=styles[property]}}return element},setOpacity:function(element,value){element=$(element);element.style.opacity=(value==1||value==="")?"":(value<0.00001)?0:value;return element},makePositioned:function(element){element=$(element);var pos=Element.getStyle(element,"position");if(pos=="static"||!pos){element._madePositioned=true;element.style.position="relative";if(Prototype.Browser.Opera){element.style.top=0;element.style.left=0}}return element},undoPositioned:function(element){element=$(element);if(element._madePositioned){element._madePositioned=undefined;element.style.position=element.style.top=element.style.left=element.style.bottom=element.style.right=""}return element},makeClipping:function(element){element=$(element);if(element._overflow){return element}element._overflow=Element.getStyle(element,"overflow")||"auto";if(element._overflow!=="hidden"){element.style.overflow="hidden"}return element},undoClipping:function(element){element=$(element);if(!element._overflow){return element}element.style.overflow=element._overflow=="auto"?"":element._overflow;element._overflow=null;return element},clonePosition:function(element,source){var options=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});source=$(source);var p=Element.viewportOffset(source).toArray(),delta=[0,0],parent=null;element=$(element);if(Element.getStyle(element,"position")=="absolute"){parent=Element.getOffsetParent(element);delta=Element.viewportOffset(parent).toArray()}if(parent==document.body){delta[0]-=document.body.offsetLeft;delta[1]-=document.body.offsetTop}if(options.setLeft){element.style.left=(p[0]-delta[0]+options.offsetLeft)+"px"}if(options.setTop){element.style.top=(p[1]-delta[1]+options.offsetTop)+"px"}if(options.setWidth){element.style.width=source.offsetWidth+"px"}if(options.setHeight){element.style.height=source.offsetHeight+"px"}return element}};Object.extend(Element.Methods,{getElementsBySelector:Element.Methods.select,childElements:Element.Methods.immediateDescendants});Element._attributeTranslations={write:{names:{className:"class",htmlFor:"for"},values:{}}};if(Prototype.Browser.Opera){Element.Methods.getStyle=Element.Methods.getStyle.wrap(function(proceed,element,style){switch(style){case"height":case"width":if(!Element.visible(element)){return null}var dim=parseInt(proceed(element,style),10);if(dim!==element["offset"+style.capitalize()]){return dim+"px"}var properties;if(style==="height"){properties=["border-top-width","padding-top","padding-bottom","border-bottom-width"]}else{properties=["border-left-width","padding-left","padding-right","border-right-width"]}return properties.inject(dim,function(memo,property){var val=proceed(element,property);return val===null?memo:memo-parseInt(val,10)})+"px";default:return proceed(element,style)}});Element.Methods.readAttribute=Element.Methods.readAttribute.wrap(function(proceed,element,attribute){if(attribute==="title"){return element.title}return proceed(element,attribute)})}else{if(Prototype.Browser.IE){Element.Methods.getStyle=function(element,style){element=$(element);style=(style=="float"||style=="cssFloat")?"styleFloat":style.camelize();var value=element.style[style];if(!value&&element.currentStyle){value=element.currentStyle[style]}if(style=="opacity"){if(value=(element.getStyle("filter")||"").match(/alpha\(opacity=(.*)\)/)){if(value[1]){return parseFloat(value[1])/100}}return 1}if(value=="auto"){if((style=="width"||style=="height")&&(element.getStyle("display")!="none")){return element["offset"+style.capitalize()]+"px"}return null}if(value.endsWith&&(value.endsWith("%")||value.endsWith("em"))){if(style=="top"){value=element.cumulativeOffset().top}else{if(style=="left"){value=element.cumulativeOffset().left}}}return value};Element.Methods.setOpacity=function(element,value){function stripAlpha(filter){return filter.replace(/alpha\([^\)]*\)/gi,"")}element=$(element);var currentStyle=element.currentStyle;if((currentStyle&&!currentStyle.hasLayout)||(!currentStyle&&element.style.zoom=="normal")){element.style.zoom=1}var filter=element.getStyle("filter"),style=element.style;if(value==1||value===""){(filter=stripAlpha(filter))?style.filter=filter:style.removeAttribute("filter");return element}else{if(value<0.00001){value=0}}style.filter=stripAlpha(filter)+"alpha(opacity="+(value*100)+")";return element};Element._attributeTranslations=(function(){var classProp="className",forProp="for",el=document.createElement("div");el.setAttribute(classProp,"x");if(el.className!=="x"){el.setAttribute("class","x");if(el.className==="x"){classProp="class"}}el=null;el=document.createElement("label");el.setAttribute(forProp,"x");if(el.htmlFor!=="x"){el.setAttribute("htmlFor","x");if(el.htmlFor==="x"){forProp="htmlFor"}}el=null;return{read:{names:{"class":classProp,className:classProp,"for":forProp,htmlFor:forProp},values:{_getAttr:function(element,attribute){return element.getAttribute(attribute)},_getAttr2:function(element,attribute){return element.getAttribute(attribute,2)},_getAttrNode:function(element,attribute){var node=element.getAttributeNode(attribute);return node?node.value:""},_getEv:(function(){var el=document.createElement("div"),f;el.onclick=Prototype.emptyFunction;var value=el.getAttribute("onclick");if(String(value).indexOf("{")>-1){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute){return null}attribute=attribute.toString();attribute=attribute.split("{")[1];attribute=attribute.split("}")[0];return attribute.strip()}}else{if(value===""){f=function(element,attribute){attribute=element.getAttribute(attribute);if(!attribute){return null}return attribute.strip()}}}el=null;return f})(),_flag:function(element,attribute){return $(element).hasAttribute(attribute)?attribute:null},style:function(element){return element.style.cssText.toLowerCase()},title:function(element){return element.title}}}}})();Element._attributeTranslations.write={names:Object.extend({cellpadding:"cellPadding",cellspacing:"cellSpacing"},Element._attributeTranslations.read.names),values:{checked:function(element,value){element.checked=!!value},style:function(element,value){element.style.cssText=value?value:""}}};Element._attributeTranslations.has={};$w("colSpan rowSpan vAlign dateTime accessKey tabIndex encType maxLength readOnly longDesc frameBorder").each(function(attr){Element._attributeTranslations.write.names[attr.toLowerCase()]=attr;Element._attributeTranslations.has[attr.toLowerCase()]=attr});(function(v){Object.extend(v,{href:v._getAttr2,src:v._getAttr2,type:v._getAttr,action:v._getAttrNode,disabled:v._flag,checked:v._flag,readonly:v._flag,multiple:v._flag,onload:v._getEv,onunload:v._getEv,onclick:v._getEv,ondblclick:v._getEv,onmousedown:v._getEv,onmouseup:v._getEv,onmouseover:v._getEv,onmousemove:v._getEv,onmouseout:v._getEv,onfocus:v._getEv,onblur:v._getEv,onkeypress:v._getEv,onkeydown:v._getEv,onkeyup:v._getEv,onsubmit:v._getEv,onreset:v._getEv,onselect:v._getEv,onchange:v._getEv})})(Element._attributeTranslations.read.values);if(Prototype.BrowserFeatures.ElementExtensions){(function(){function _descendants(element){var nodes=element.getElementsByTagName("*"),results=[];for(var i=0,node;node=nodes[i];i++){if(node.tagName!=="!"){results.push(node)}}return results}Element.Methods.down=function(element,expression,index){element=$(element);if(arguments.length==1){return element.firstDescendant()}return Object.isNumber(expression)?_descendants(element)[expression]:Element.select(element,expression)[index||0]}})()}}else{if(Prototype.Browser.Gecko&&/rv:1\.8\.0/.test(navigator.userAgent)){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1)?0.999999:(value==="")?"":(value<0.00001)?0:value;return element}}else{if(Prototype.Browser.WebKit){Element.Methods.setOpacity=function(element,value){element=$(element);element.style.opacity=(value==1||value==="")?"":(value<0.00001)?0:value;if(value==1){if(element.tagName.toUpperCase()=="IMG"&&element.width){element.width++;element.width--}else{try{var n=document.createTextNode(" ");element.appendChild(n);element.removeChild(n)}catch(e){}}}return element}}}}}if("outerHTML" in document.documentElement){Element.Methods.replace=function(element,content){element=$(element);if(content&&content.toElement){content=content.toElement()}if(Object.isElement(content)){element.parentNode.replaceChild(content,element);return element}content=Object.toHTML(content);var parent=element.parentNode,tagName=parent.tagName.toUpperCase();if(Element._insertionTranslations.tags[tagName]){var nextSibling=element.next(),fragments=Element._getContentFromAnonymousElement(tagName,content.stripScripts());parent.removeChild(element);if(nextSibling){fragments.each(function(node){parent.insertBefore(node,nextSibling)})}else{fragments.each(function(node){parent.appendChild(node)})}}else{element.outerHTML=content.stripScripts()}content.evalScripts.bind(content).defer();return element}}Element._returnOffset=function(l,t){var result=[l,t];result.left=l;result.top=t;return result};Element._getContentFromAnonymousElement=function(tagName,html,force){var div=new Element("div"),t=Element._insertionTranslations.tags[tagName];var workaround=false;if(t){workaround=true}else{if(force){workaround=true;t=["","",0]}}if(workaround){div.innerHTML="&nbsp;"+t[0]+html+t[1];div.removeChild(div.firstChild);for(var i=t[2];i--;){div=div.firstChild}}else{div.innerHTML=html}return $A(div.childNodes)};Element._insertionTranslations={before:function(element,node){element.parentNode.insertBefore(node,element)},top:function(element,node){element.insertBefore(node,element.firstChild)},bottom:function(element,node){element.appendChild(node)},after:function(element,node){element.parentNode.insertBefore(node,element.nextSibling)},tags:{TABLE:["<table>","</table>",1],TBODY:["<table><tbody>","</tbody></table>",2],TR:["<table><tbody><tr>","</tr></tbody></table>",3],TD:["<table><tbody><tr><td>","</td></tr></tbody></table>",4],SELECT:["<select>","</select>",1]}};(function(){var tags=Element._insertionTranslations.tags;Object.extend(tags,{THEAD:tags.TBODY,TFOOT:tags.TBODY,TH:tags.TD})})();Element.Methods.Simulated={hasAttribute:function(element,attribute){attribute=Element._attributeTranslations.has[attribute]||attribute;var node=$(element).getAttributeNode(attribute);return !!(node&&node.specified)}};Element.Methods.ByTag={};Object.extend(Element,Element.Methods);(function(div){if(!Prototype.BrowserFeatures.ElementExtensions&&div.__proto__){window.HTMLElement={};window.HTMLElement.prototype=div.__proto__;Prototype.BrowserFeatures.ElementExtensions=true}div=null})(document.createElement("div"));Element.extend=(function(){function checkDeficiency(tagName){if(typeof window.Element!="undefined"){var proto=window.Element.prototype;if(proto){var id="_"+(Math.random()+"").slice(2),el=document.createElement(tagName);proto[id]="x";var isBuggy=(el[id]!=="x");delete proto[id];el=null;return isBuggy}}return false}function extendElementWith(element,methods){for(var property in methods){var value=methods[property];if(Object.isFunction(value)&&!(property in element)){element[property]=value.methodize()}}}var HTMLOBJECTELEMENT_PROTOTYPE_BUGGY=checkDeficiency("object");if(Prototype.BrowserFeatures.SpecificElementExtensions){if(HTMLOBJECTELEMENT_PROTOTYPE_BUGGY){return function(element){if(element&&typeof element._extendedByPrototype=="undefined"){var t=element.tagName;if(t&&(/^(?:object|applet|embed)$/i.test(t))){extendElementWith(element,Element.Methods);extendElementWith(element,Element.Methods.Simulated);extendElementWith(element,Element.Methods.ByTag[t.toUpperCase()])}}return element}}return Prototype.K}var Methods={},ByTag=Element.Methods.ByTag;var extend=Object.extend(function(element){if(!element||typeof element._extendedByPrototype!="undefined"||element.nodeType!=1||element==window){return element}var methods=Object.clone(Methods),tagName=element.tagName.toUpperCase();if(ByTag[tagName]){Object.extend(methods,ByTag[tagName])}extendElementWith(element,methods);element._extendedByPrototype=Prototype.emptyFunction;return element},{refresh:function(){if(!Prototype.BrowserFeatures.ElementExtensions){Object.extend(Methods,Element.Methods);Object.extend(Methods,Element.Methods.Simulated)}}});extend.refresh();return extend})();if(document.documentElement.hasAttribute){Element.hasAttribute=function(element,attribute){return element.hasAttribute(attribute)}}else{Element.hasAttribute=Element.Methods.Simulated.hasAttribute}Element.addMethods=function(methods){var F=Prototype.BrowserFeatures,T=Element.Methods.ByTag;if(!methods){Object.extend(Form,Form.Methods);Object.extend(Form.Element,Form.Element.Methods);Object.extend(Element.Methods.ByTag,{FORM:Object.clone(Form.Methods),INPUT:Object.clone(Form.Element.Methods),SELECT:Object.clone(Form.Element.Methods),TEXTAREA:Object.clone(Form.Element.Methods),BUTTON:Object.clone(Form.Element.Methods)})}if(arguments.length==2){var tagName=methods;methods=arguments[1]}if(!tagName){Object.extend(Element.Methods,methods||{})}else{if(Object.isArray(tagName)){tagName.each(extend)}else{extend(tagName)}}function extend(tagName){tagName=tagName.toUpperCase();if(!Element.Methods.ByTag[tagName]){Element.Methods.ByTag[tagName]={}}Object.extend(Element.Methods.ByTag[tagName],methods)}function copy(methods,destination,onlyIfAbsent){onlyIfAbsent=onlyIfAbsent||false;for(var property in methods){var value=methods[property];if(!Object.isFunction(value)){continue}if(!onlyIfAbsent||!(property in destination)){destination[property]=value.methodize()}}}function findDOMClass(tagName){var klass;var trans={OPTGROUP:"OptGroup",TEXTAREA:"TextArea",P:"Paragraph",FIELDSET:"FieldSet",UL:"UList",OL:"OList",DL:"DList",DIR:"Directory",H1:"Heading",H2:"Heading",H3:"Heading",H4:"Heading",H5:"Heading",H6:"Heading",Q:"Quote",INS:"Mod",DEL:"Mod",A:"Anchor",IMG:"Image",CAPTION:"TableCaption",COL:"TableCol",COLGROUP:"TableCol",THEAD:"TableSection",TFOOT:"TableSection",TBODY:"TableSection",TR:"TableRow",TH:"TableCell",TD:"TableCell",FRAMESET:"FrameSet",IFRAME:"IFrame"};if(trans[tagName]){klass="HTML"+trans[tagName]+"Element"}if(window[klass]){return window[klass]}klass="HTML"+tagName+"Element";if(window[klass]){return window[klass]}klass="HTML"+tagName.capitalize()+"Element";if(window[klass]){return window[klass]}var element=document.createElement(tagName),proto=element.__proto__||element.constructor.prototype;element=null;return proto}var elementPrototype=window.HTMLElement?HTMLElement.prototype:Element.prototype;if(F.ElementExtensions){copy(Element.Methods,elementPrototype);copy(Element.Methods.Simulated,elementPrototype,true)}if(F.SpecificElementExtensions){for(var tag in Element.Methods.ByTag){var klass=findDOMClass(tag);if(Object.isUndefined(klass)){continue}copy(T[tag],klass.prototype)}}Object.extend(Element,Element.Methods);delete Element.ByTag;if(Element.extend.refresh){Element.extend.refresh()}Element.cache={}};document.viewport={getDimensions:function(){return{width:this.getWidth(),height:this.getHeight()}},getScrollOffsets:function(){return Element._returnOffset(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)}};(function(viewport){var B=Prototype.Browser,doc=document,element,property={};function getRootElement(){if(B.WebKit&&!doc.evaluate){return document}if(B.Opera&&window.parseFloat(window.opera.version())<9.5||!document.compatMode||document.compatMode!="CSS1Compat"){return document.body}return document.documentElement}function define(D){if(!element){element=getRootElement()}property[D]=(B.WebKit&&!doc.evaluate?"inner":"client")+D;viewport["get"+D]=function(){return element[property[D]]};return viewport["get"+D]()}viewport.getWidth=define.curry("Width");viewport.getHeight=define.curry("Height")})(document.viewport);Element.Storage={UID:1};Element.addMethods({getStorage:function(element){if(!(element=$(element))){return }var uid;if(element===window){uid=0}else{if(typeof element._prototypeUID==="undefined"){element._prototypeUID=Element.Storage.UID++}uid=element._prototypeUID}if(!Element.Storage[uid]){Element.Storage[uid]=$H()}return Element.Storage[uid]},store:function(element,key,value){if(!(element=$(element))){return }if(arguments.length===2){Element.getStorage(element).update(key)}else{Element.getStorage(element).set(key,value)}return element},retrieve:function(element,key,defaultValue){if(!(element=$(element))){return }var hash=Element.getStorage(element),value=hash.get(key);if(Object.isUndefined(value)){hash.set(key,defaultValue);value=defaultValue}return value},clone:function(element,deep){if(!(element=$(element))){return }var clone=element.cloneNode(deep);clone._prototypeUID=void 0;if(deep){var descendants=Element.select(clone,"*"),i=descendants.length;while(i--){descendants[i]._prototypeUID=void 0}}return Element.extend(clone)},purge:function(element){if(!(element=$(element))){return }var purgeElement=Element._purgeElement;purgeElement(element);var descendants=element.getElementsByTagName("*"),i=descendants.length;while(i--){purgeElement(descendants[i])}return null}});(function(){function toDecimal(pctString){var match=pctString.match(/^(\d+)%?$/i);if(!match){return null}return(Number(match[1])/100)}function getPixelValue(value,property,context){var element=null;if(Object.isElement(value)){element=value;value=element.getStyle(property)}if(value===null){return null}if((/^(?:-)?\d+(\.\d+)?(px)?$/i).test(value)){return window.parseFloat(value)}var isPercentage=value.include("%"),isViewport=(context===document.viewport);if(/\d/.test(value)&&element&&element.runtimeStyle&&!(isPercentage&&isViewport)){var style=element.style.left,rStyle=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=value||0;value=element.style.pixelLeft;element.style.left=style;element.runtimeStyle.left=rStyle;return value}if(element&&isPercentage){context=context||element.parentNode;var decimal=toDecimal(value);var whole=null;var position=element.getStyle("position");var isHorizontal=property.include("left")||property.include("right")||property.include("width");var isVertical=property.include("top")||property.include("bottom")||property.include("height");if(context===document.viewport){if(isHorizontal){whole=document.viewport.getWidth()}else{if(isVertical){whole=document.viewport.getHeight()}}}else{if(isHorizontal){whole=$(context).measure("width")}else{if(isVertical){whole=$(context).measure("height")}}}return(whole===null)?0:whole*decimal}return 0}function toCSSPixels(number){if(Object.isString(number)&&number.endsWith("px")){return number}return number+"px"}function isDisplayed(element){var originalElement=element;while(element&&element.parentNode){var display=element.getStyle("display");if(display==="none"){return false}element=$(element.parentNode)}return true}var hasLayout=Prototype.K;if("currentStyle" in document.documentElement){hasLayout=function(element){if(!element.currentStyle.hasLayout){element.style.zoom=1}return element}}function cssNameFor(key){if(key.include("border")){key=key+"-width"}return key.camelize()}Element.Layout=Class.create(Hashtable,{initialize:function($super,element,preCompute){$super();this.element=$(element);Element.Layout.PROPERTIES.each(function(property){this._set(property,null)},this);if(preCompute){this._preComputing=true;this._begin();Element.Layout.PROPERTIES.each(this._compute,this);this._end();this._preComputing=false}},_set:function(property,value){return Hashtable.prototype.set.call(this,property,value)},set:function(property,value){throw"Properties of Element.Layout are read-only."},get:function($super,property){var value=$super(property);return value===null?this._compute(property):value},_begin:function(){if(this._prepared){return }var element=this.element;if(isDisplayed(element)){this._prepared=true;return }var originalStyles={position:element.style.position||"",width:element.style.width||"",visibility:element.style.visibility||"",display:element.style.display||""};element.store("prototype_original_styles",originalStyles);var position=element.getStyle("position"),width=element.getStyle("width");if(width==="0px"||width===null){element.style.display="block";width=element.getStyle("width")}var context=(position==="fixed")?document.viewport:element.parentNode;element.setStyle({position:"absolute",visibility:"hidden",display:"block"});var positionedWidth=element.getStyle("width");var newWidth;if(width&&(positionedWidth===width)){newWidth=getPixelValue(element,"width",context)}else{if(position==="absolute"||position==="fixed"){newWidth=getPixelValue(element,"width",context)}else{var parent=element.parentNode,pLayout=$(parent).getLayout();newWidth=pLayout.get("width")-this.get("margin-left")-this.get("border-left")-this.get("padding-left")-this.get("padding-right")-this.get("border-right")-this.get("margin-right")}}element.setStyle({width:newWidth+"px"});this._prepared=true},_end:function(){var element=this.element;var originalStyles=element.retrieve("prototype_original_styles");element.store("prototype_original_styles",null);element.setStyle(originalStyles);this._prepared=false},_compute:function(property){var COMPUTATIONS=Element.Layout.COMPUTATIONS;if(!(property in COMPUTATIONS)){throw"Property not found."}return this._set(property,COMPUTATIONS[property].call(this,this.element))},toObject:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(" ").split(" ");var obj={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key)){return }var value=this.get(key);if(value!=null){obj[key]=value}},this);return obj},toHash:function(){var obj=this.toObject.apply(this,arguments);return new Hashtable(obj)},toCSS:function(){var args=$A(arguments);var keys=(args.length===0)?Element.Layout.PROPERTIES:args.join(" ").split(" ");var css={};keys.each(function(key){if(!Element.Layout.PROPERTIES.include(key)){return }if(Element.Layout.COMPOSITE_PROPERTIES.include(key)){return }var value=this.get(key);if(value!=null){css[cssNameFor(key)]=value+"px"}},this);return css},inspect:function(){return"#<Element.Layout>"}});Object.extend(Element.Layout,{PROPERTIES:$w("height width top left right bottom border-left border-right border-top border-bottom padding-left padding-right padding-top padding-bottom margin-top margin-bottom margin-left margin-right padding-box-width padding-box-height border-box-width border-box-height margin-box-width margin-box-height"),COMPOSITE_PROPERTIES:$w("padding-box-width padding-box-height margin-box-width margin-box-height border-box-width border-box-height"),COMPUTATIONS:{height:function(element){if(!this._preComputing){this._begin()}var bHeight=this.get("border-box-height");if(bHeight<=0){if(!this._preComputing){this._end()}return 0}var bTop=this.get("border-top"),bBottom=this.get("border-bottom");var pTop=this.get("padding-top"),pBottom=this.get("padding-bottom");if(!this._preComputing){this._end()}return bHeight-bTop-bBottom-pTop-pBottom},width:function(element){if(!this._preComputing){this._begin()}var bWidth=this.get("border-box-width");if(bWidth<=0){if(!this._preComputing){this._end()}return 0}var bLeft=this.get("border-left"),bRight=this.get("border-right");var pLeft=this.get("padding-left"),pRight=this.get("padding-right");if(!this._preComputing){this._end()}return bWidth-bLeft-bRight-pLeft-pRight},"padding-box-height":function(element){var height=this.get("height"),pTop=this.get("padding-top"),pBottom=this.get("padding-bottom");return height+pTop+pBottom},"padding-box-width":function(element){var width=this.get("width"),pLeft=this.get("padding-left"),pRight=this.get("padding-right");return width+pLeft+pRight},"border-box-height":function(element){if(!this._preComputing){this._begin()}var height=element.offsetHeight;if(!this._preComputing){this._end()}return height},"border-box-width":function(element){if(!this._preComputing){this._begin()}var width=element.offsetWidth;if(!this._preComputing){this._end()}return width},"margin-box-height":function(element){var bHeight=this.get("border-box-height"),mTop=this.get("margin-top"),mBottom=this.get("margin-bottom");if(bHeight<=0){return 0}return bHeight+mTop+mBottom},"margin-box-width":function(element){var bWidth=this.get("border-box-width"),mLeft=this.get("margin-left"),mRight=this.get("margin-right");if(bWidth<=0){return 0}return bWidth+mLeft+mRight},top:function(element){var offset=element.positionedOffset();return offset.top},bottom:function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pHeight=parent.measure("height");var mHeight=this.get("border-box-height");return pHeight-mHeight-offset.top},left:function(element){var offset=element.positionedOffset();return offset.left},right:function(element){var offset=element.positionedOffset(),parent=element.getOffsetParent(),pWidth=parent.measure("width");var mWidth=this.get("border-box-width");return pWidth-mWidth-offset.left},"padding-top":function(element){return getPixelValue(element,"paddingTop")},"padding-bottom":function(element){return getPixelValue(element,"paddingBottom")},"padding-left":function(element){return getPixelValue(element,"paddingLeft")},"padding-right":function(element){return getPixelValue(element,"paddingRight")},"border-top":function(element){return getPixelValue(element,"borderTopWidth")},"border-bottom":function(element){return getPixelValue(element,"borderBottomWidth")},"border-left":function(element){return getPixelValue(element,"borderLeftWidth")},"border-right":function(element){return getPixelValue(element,"borderRightWidth")},"margin-top":function(element){return getPixelValue(element,"marginTop")},"margin-bottom":function(element){return getPixelValue(element,"marginBottom")},"margin-left":function(element){return getPixelValue(element,"marginLeft")},"margin-right":function(element){return getPixelValue(element,"marginRight")}}});if("getBoundingClientRect" in document.documentElement){Object.extend(Element.Layout.COMPUTATIONS,{right:function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.right-rect.right).round()},bottom:function(element){var parent=hasLayout(element.getOffsetParent());var rect=element.getBoundingClientRect(),pRect=parent.getBoundingClientRect();return(pRect.bottom-rect.bottom).round()}})}Element.Offset=Class.create({initialize:function(left,top){this.left=left.round();this.top=top.round();this[0]=this.left;this[1]=this.top},relativeTo:function(offset){return new Element.Offset(this.left-offset.left,this.top-offset.top)},inspect:function(){return"#<Element.Offset left: #{left} top: #{top}>".interpolate(this)},toString:function(){return"[#{left}, #{top}]".interpolate(this)},toArray:function(){return[this.left,this.top]}});function getLayout(element,preCompute){return new Element.Layout(element,preCompute)}function measure(element,property){return $(element).getLayout().get(property)}function getDimensions(element){element=$(element);var display=Element.getStyle(element,"display");if(display&&display!=="none"){return{width:element.offsetWidth,height:element.offsetHeight}}var style=element.style;var originalStyles={visibility:style.visibility,position:style.position,display:style.display};var newStyles={visibility:"hidden",display:"block"};if(originalStyles.position!=="fixed"){newStyles.position="absolute"}Element.setStyle(element,newStyles);var dimensions={width:element.offsetWidth,height:element.offsetHeight};Element.setStyle(element,originalStyles);return dimensions}function getOffsetParent(element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element)){return $(document.body)}var isInline=(Element.getStyle(element,"display")==="inline");if(!isInline&&element.offsetParent){return $(element.offsetParent)}while((element=element.parentNode)&&element!==document.body){if(Element.getStyle(element,"position")!=="static"){return isHtml(element)?$(document.body):$(element)}}return $(document.body)}function cumulativeOffset(element){element=$(element);var valueT=0,valueL=0;if(element.parentNode){do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent}while(element)}return new Element.Offset(valueL,valueT)}function positionedOffset(element){element=$(element);var layout=element.getLayout();var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;element=element.offsetParent;if(element){if(isBody(element)){break}var p=Element.getStyle(element,"position");if(p!=="static"){break}}}while(element);valueL-=layout.get("margin-top");valueT-=layout.get("margin-left");return new Element.Offset(valueL,valueT)}function cumulativeScrollOffset(element){var valueT=0,valueL=0;do{valueT+=element.scrollTop||0;valueL+=element.scrollLeft||0;element=element.parentNode}while(element);return new Element.Offset(valueL,valueT)}function viewportOffset(forElement){element=$(element);var valueT=0,valueL=0,docBody=document.body;var element=forElement;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==docBody&&Element.getStyle(element,"position")=="absolute"){break}}while(element=element.offsetParent);element=forElement;do{if(!Prototype.Browser.Opera||element==docBody){valueT-=element.scrollTop||0;valueL-=element.scrollLeft||0}}while(element=element.parentNode);return new Element.Offset(valueL,valueT)}function absolutize(element){element=$(element);if(Element.getStyle(element,"position")==="absolute"){return element}var offsetParent=getOffsetParent(element);var eOffset=element.viewportOffset(),pOffset=offsetParent.viewportOffset();var offset=eOffset.relativeTo(pOffset);var layout=element.getLayout();element.store("prototype_absolutize_original_styles",{left:element.getStyle("left"),top:element.getStyle("top"),width:element.getStyle("width"),height:element.getStyle("height")});element.setStyle({position:"absolute",top:offset.top+"px",left:offset.left+"px",width:layout.get("width")+"px",height:layout.get("height")+"px"});return element}function relativize(element){element=$(element);if(Element.getStyle(element,"position")==="relative"){return element}var originalStyles=element.retrieve("prototype_absolutize_original_styles");if(originalStyles){element.setStyle(originalStyles)}return element}if(Prototype.Browser.IE){getOffsetParent=getOffsetParent.wrap(function(proceed,element){element=$(element);if(isDocument(element)||isDetached(element)||isBody(element)||isHtml(element)){return $(document.body)}var position=element.getStyle("position");if(position!=="static"){return proceed(element)}element.setStyle({position:"relative"});var value=proceed(element);element.setStyle({position:position});return value});positionedOffset=positionedOffset.wrap(function(proceed,element){element=$(element);if(!element.parentNode){return new Element.Offset(0,0)}var position=element.getStyle("position");if(position!=="static"){return proceed(element)}var offsetParent=element.getOffsetParent();if(offsetParent&&offsetParent.getStyle("position")==="fixed"){hasLayout(offsetParent)}element.setStyle({position:"relative"});var value=proceed(element);element.setStyle({position:position});return value})}else{if(Prototype.Browser.Webkit){cumulativeOffset=function(element){element=$(element);var valueT=0,valueL=0;do{valueT+=element.offsetTop||0;valueL+=element.offsetLeft||0;if(element.offsetParent==document.body){if(Element.getStyle(element,"position")=="absolute"){break}}element=element.offsetParent}while(element);return new Element.Offset(valueL,valueT)}}}Element.addMethods({getLayout:getLayout,measure:measure,getDimensions:getDimensions,getOffsetParent:getOffsetParent,cumulativeOffset:cumulativeOffset,positionedOffset:positionedOffset,cumulativeScrollOffset:cumulativeScrollOffset,viewportOffset:viewportOffset,absolutize:absolutize,relativize:relativize});function isBody(element){return element.nodeName.toUpperCase()==="BODY"}function isHtml(element){return element.nodeName.toUpperCase()==="HTML"}function isDocument(element){return element.nodeType===Node.DOCUMENT_NODE}function isDetached(element){return element!==document.body&&!Element.descendantOf(element,document.body)}})();window.$$=function(){var expression=$A(arguments).join(", ");return Prototype.Selector.select(expression,document)};Prototype.Selector=(function(){function select(){throw new Error('Method "Prototype.Selector.select" must be defined.')}function match(){throw new Error('Method "Prototype.Selector.match" must be defined.')}function find(elements,expression,index){index=index||0;var match=Prototype.Selector.match,length=elements.length,matchIndex=0,i;for(i=0;i<length;i++){if(match(elements[i],expression)&&index==matchIndex++){return Element.extend(elements[i])}}}function extendElements(elements){for(var i=0,length=elements.length;i<length;i++){Element.extend(elements[i])}return elements}var K=Prototype.K;return{select:select,match:match,find:find,extendElements:(Element.extend===K)?K:extendElements,extendElement:Element.extend}})();Prototype._original_property=window.Sizzle;
/*
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,done=0,toString=Object.prototype.toString,hasDuplicate=false,baseHasDuplicate=true;[0,0].sort(function(){baseHasDuplicate=false;return 0});var Sizzle=function(selector,context,results,seed){results=results||[];var origContext=context=context||document;if(context.nodeType!==1&&context.nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}var parts=[],m,set,checkSet,check,mode,extra,prune=true,contextXML=isXML(context),soFar=selector;while((chunker.exec(""),m=chunker.exec(soFar))!==null){soFar=m[3];parts.push(m[1]);if(m[2]){extra=m[3];break}}if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context)}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift()}set=posProcess(selector,set)}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){var ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0]}if(context){var ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]==="~"||parts[0]==="+")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set)}else{prune=false}while(parts.length){var cur=parts.pop(),pop=cur;if(!Expr.relative[cur]){cur=""}else{pop=parts.pop()}if(pop==null){pop=context}Expr.relative[cur](checkSet,pop,contextXML)}}else{checkSet=parts=[]}}if(!checkSet){checkSet=set}if(!checkSet){throw"Syntax error, unrecognized expression: "+(cur||selector)}if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet)}else{if(context&&context.nodeType===1){for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&contains(context,checkSet[i]))){results.push(set[i])}}}else{for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i])}}}}}else{makeArray(checkSet,results)}if(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results)}return results};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=baseHasDuplicate;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1)}}}}return results};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)};Sizzle.find=function(expr,context,isXML){var set,match;if(!expr){return[]}for(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.leftMatch[type].exec(expr))){var left=match[1];match.splice(1,1);if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(/\\/g,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}if(!set){set=context.getElementsByTagName("*")}return{set:set,expr:expr}};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.match[type].exec(expr))!=null){var filter=Expr.filter[type],found,item;anyFound=false;if(curLoop==result){result=[]}if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true}else{if(match===true){continue}}}if(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true}else{curLoop[i]=false}}else{if(pass){result.push(item);anyFound=true}}}}}if(found!==undefined){if(!inplace){curLoop=result}expr=expr.replace(Expr.match[type],"");if(!anyFound){return[]}break}}}if(expr==old){if(anyFound==null){throw"Syntax error, unrecognized expression: "+expr}else{break}}old=expr}return curLoop};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")}},relative:{"+":function(checkSet,part,isXML){var isPartStr=typeof part==="string",isTag=isPartStr&&!/\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag&&!isXML){part=part.toUpperCase()}for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}checkSet[i]=isPartStrNotTag||elem&&elem.nodeName===part?elem||false:elem===part}}if(isPartStrNotTag){Sizzle.filter(part,checkSet,true)}},">":function(checkSet,part,isXML){var isPartStr=typeof part==="string";if(isPartStr&&!/\W/.test(part)){part=isXML?part:part.toUpperCase();for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName===part?parent:false}}}else{for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part}}if(isPartStr){Sizzle.filter(part,checkSet,true)}}},"":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!/\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[]}},NAME:function(match,context,isXML){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i])}}return ret.length===0?null:ret}},TAG:function(match,context){return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(/\\/g,"")+" ";if(isXML){return match}for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").indexOf(match)>=0)){if(!inplace){result.push(elem)}}else{if(inplace){curLoop[i]=false}}}}return false},ID:function(match){return match[1].replace(/\\/g,"")},TAG:function(match,curLoop){for(var i=0;curLoop[i]===false;i++){}return curLoop[i]&&isXML(curLoop[i])?match[1]:match[1].toUpperCase()},CHILD:function(match){if(match[1]=="nth"){var test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(match[2]=="even"&&"2n"||match[2]=="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0}match[0]=done++;return match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\/g,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name]}if(match[2]==="~="){match[4]=" "+match[4]+" "}return match},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if((chunker.exec(match[3])||"").length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop)}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret)}return false}}else{if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true}}return match},POS:function(match){match.unshift(true);return match}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===true},checked:function(elem){return elem.checked===true},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true},parent:function(elem){return !!elem.firstChild},empty:function(elem){return !elem.firstChild},has:function(elem,i,match){return !!Sizzle(match[3],elem).length},header:function(elem){return/h\d/i.test(elem.nodeName)},text:function(elem){return"text"===elem.type},radio:function(elem){return"radio"===elem.type},checkbox:function(elem){return"checkbox"===elem.type},file:function(elem){return"file"===elem.type},password:function(elem){return"password"===elem.type},submit:function(elem){return"submit"===elem.type},image:function(elem){return"image"===elem.type},reset:function(elem){return"reset"===elem.type},button:function(elem){return"button"===elem.type||elem.nodeName.toUpperCase()==="BUTTON"},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName)}},setFilters:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0==i},eq:function(elem,i,match){return match[3]-0==i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array)}else{if(name==="contains"){return(elem.textContent||elem.innerText||"").indexOf(match[3])>=0}else{if(name==="not"){var not=match[3];for(var i=0,l=not.length;i<l;i++){if(not[i]===elem){return false}}return true}}}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case"only":case"first":while((node=node.previousSibling)){if(node.nodeType===1){return false}}if(type=="first"){return true}node=elem;case"last":while((node=node.nextSibling)){if(node.nodeType===1){return false}}return true;case"nth":var first=match[2],last=match[3];if(first==1&&last==0){return true}var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count}}parent.sizcache=doneName}var diff=elem.nodeIndex-last;if(first==0){return diff==0}else{return(diff%first==0&&diff/first>=0)}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||elem.nodeName===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!=check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array)}}}};var origPOS=Expr.match.POS;for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source);Expr.leftMatch[type]=new RegExp(/(^(?:.|\r|\n)*?)/.source+Expr.match[type].source)}var makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results}return array};try{Array.prototype.slice.call(document.documentElement.childNodes,0)}catch(e){makeArray=function(array,results){var ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array)}else{if(typeof array.length==="number"){for(var i=0,l=array.length;i<l;i++){ret.push(array[i])}}else{for(var i=0;array[i];i++){ret.push(array[i])}}}return ret}}var sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){if(!a.compareDocumentPosition||!b.compareDocumentPosition){if(a==b){hasDuplicate=true}return 0}var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true}return ret}}else{if("sourceIndex" in document.documentElement){sortOrder=function(a,b){if(!a.sourceIndex||!b.sourceIndex){if(a==b){hasDuplicate=true}return 0}var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true}return ret}}else{if(document.createRange){sortOrder=function(a,b){if(!a.ownerDocument||!b.ownerDocument){if(a==b){hasDuplicate=true}return 0}var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.setStart(a,0);aRange.setEnd(a,0);bRange.setStart(b,0);bRange.setEnd(b,0);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true}return ret}}}}(function(){var form=document.createElement("div"),id="script"+(new Date).getTime();form.innerHTML="<a name='"+id+"'/>";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(!!document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}}root.removeChild(form);root=form=null})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i])}}results=tmp}return results}}div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}}div=null})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div");div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return }Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!isXML(context)){try{return makeArray(context.querySelectorAll(query),extra)}catch(e){}}return oldSizzle(query,context,extra,seed)};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop]}div=null})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(div.getElementsByClassName("e").length===0){return }div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return }Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1])}};div=null})()}function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i}if(elem.nodeName===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i}if(typeof cur!=="string"){if(elem===cur){match=true;break}}else{if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}}elem=elem[dir]}checkSet[i]=match}}}var contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};var isXML=function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!=="HTML"||!!elem.ownerDocument&&elem.ownerDocument.documentElement.nodeName!=="HTML"};var posProcess=function(selector,context){var tmpSet=[],later="",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"")}selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet)}return Sizzle.filter(later,tmpSet)};window.Sizzle=Sizzle})();(function(engine){var extendElements=Prototype.Selector.extendElements;function select(selector,scope){return extendElements(engine(selector,scope||document))}function match(element,selector){return engine.matches(selector,[element]).length==1}Prototype.Selector.engine=engine;Prototype.Selector.select=select;Prototype.Selector.match=match})(Sizzle);window.Sizzle=Prototype._original_property;delete Prototype._original_property;var Form={reset:function(form){form=$(form);form.reset();return form},serializeElements:function(elements,options){if(typeof options!="object"){options={hash:!!options}}else{if(Object.isUndefined(options.hash)){options.hash=true}}var key,value,submitted=false,submit=options.submit,accumulator,initial;if(options.hash){initial={};accumulator=function(result,key,value){if(key in result){if(!Object.isArray(result[key])){result[key]=[result[key]]}result[key].push(value)}else{result[key]=value}return result}}else{initial="";accumulator=function(result,key,value){return result+(result?"&":"")+encodeURIComponent(key)+"="+encodeURIComponent(value)}}return elements.inject(initial,function(result,element){if(!element.disabled&&element.name){key=element.name;value=$(element).getValue();if(value!=null&&element.type!="file"&&(element.type!="submit"||(!submitted&&submit!==false&&(!submit||key==submit)&&(submitted=true)))){result=accumulator(result,key,value)}}return result})}};Form.Methods={serialize:function(form,options){return Form.serializeElements(Form.getElements(form),options)},getElements:function(form){var elements=$(form).getElementsByTagName("*"),element,arr=[],serializers=Form.Element.Serializers;for(var i=0;element=elements[i];i++){arr.push(element)}return arr.inject([],function(elements,child){if(serializers[child.tagName.toLowerCase()]){elements.push(Element.extend(child))}return elements})},getInputs:function(form,typeName,name){form=$(form);var inputs=form.getElementsByTagName("input");if(!typeName&&!name){return $A(inputs).map(Element.extend)}for(var i=0,matchingInputs=[],length=inputs.length;i<length;i++){var input=inputs[i];if((typeName&&input.type!=typeName)||(name&&input.name!=name)){continue}matchingInputs.push(Element.extend(input))}return matchingInputs},disable:function(form){form=$(form);Form.getElements(form).invoke("disable");return form},enable:function(form){form=$(form);Form.getElements(form).invoke("enable");return form},findFirstElement:function(form){var elements=$(form).getElements().findAll(function(element){return"hidden"!=element.type&&!element.disabled});var firstByIndex=elements.findAll(function(element){return element.hasAttribute("tabIndex")&&element.tabIndex>=0}).sortBy(function(element){return element.tabIndex}).first();return firstByIndex?firstByIndex:elements.find(function(element){return/^(?:input|select|textarea)$/i.test(element.tagName)})},focusFirstElement:function(form){form=$(form);var element=form.findFirstElement();if(element){element.activate()}return form},request:function(form,options){form=$(form),options=Object.clone(options||{});var params=options.parameters,action=form.readAttribute("action")||"";if(action.blank()){action=window.location.href}options.parameters=form.serialize(true);if(params){if(Object.isString(params)){params=params.toQueryParams()}Object.extend(options.parameters,params)}if(form.hasAttribute("method")&&!options.method){options.method=form.method}return new Ajax.Request(action,options)}};Form.Element={focus:function(element){$(element).focus();return element},select:function(element){$(element).select();return element}};Form.Element.Methods={serialize:function(element){element=$(element);if(!element.disabled&&element.name){var value=element.getValue();if(value!=undefined){var pair={};pair[element.name]=value;return Object.toQueryString(pair)}}return""},getValue:function(element){element=$(element);var method=element.tagName.toLowerCase();return Form.Element.Serializers[method](element)},setValue:function(element,value){element=$(element);var method=element.tagName.toLowerCase();Form.Element.Serializers[method](element,value);return element},clear:function(element){$(element).value="";return element},present:function(element){return $(element).value!=""},activate:function(element){element=$(element);try{element.focus();if(element.select&&(element.tagName.toLowerCase()!="input"||!(/^(?:button|reset|submit)$/i.test(element.type)))){element.select()}}catch(e){}return element},disable:function(element){element=$(element);element.disabled=true;return element},enable:function(element){element=$(element);element.disabled=false;return element}};var Field=Form.Element;var $F=Form.Element.Methods.getValue;Form.Element.Serializers=(function(){function input(element,value){switch(element.type.toLowerCase()){case"checkbox":case"radio":return inputSelector(element,value);default:return valueSelector(element,value)}}function inputSelector(element,value){if(Object.isUndefined(value)){return element.checked?element.value:null}else{element.checked=!!value}}function valueSelector(element,value){if(Object.isUndefined(value)){return element.value}else{element.value=value}}function select(element,value){if(Object.isUndefined(value)){return(element.type==="select-one"?selectOne:selectMany)(element)}var opt,currentValue,single=!Object.isArray(value);for(var i=0,length=element.length;i<length;i++){opt=element.options[i];currentValue=this.optionValue(opt);if(single){if(currentValue==value){opt.selected=true;return }}else{opt.selected=value.include(currentValue)}}}function selectOne(element){var index=element.selectedIndex;return index>=0?optionValue(element.options[index]):null}function selectMany(element){var values,length=element.length;if(!length){return null}for(var i=0,values=[];i<length;i++){var opt=element.options[i];if(opt.selected){values.push(optionValue(opt))}}return values}function optionValue(opt){return Element.hasAttribute(opt,"value")?opt.value:opt.text}return{input:input,inputSelector:inputSelector,textarea:valueSelector,select:select,selectOne:selectOne,selectMany:selectMany,optionValue:optionValue,button:valueSelector}})();Abstract.TimedObserver=Class.create(PeriodicalExecuter,{initialize:function($super,element,frequency,callback){$super(callback,frequency);this.element=$(element);this.lastValue=this.getValue()},execute:function(){var value=this.getValue();if(Object.isString(this.lastValue)&&Object.isString(value)?this.lastValue!=value:String(this.lastValue)!=String(value)){this.callback(this.element,value);this.lastValue=value}}});Form.Element.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.Observer=Class.create(Abstract.TimedObserver,{getValue:function(){return Form.serialize(this.element)}});Abstract.EventObserver=Class.create({initialize:function(element,callback){this.element=$(element);this.callback=callback;this.lastValue=this.getValue();if(this.element.tagName.toLowerCase()=="form"){this.registerFormCallbacks()}else{this.registerCallback(this.element)}},onElementEvent:function(){var value=this.getValue();if(this.lastValue!=value){this.callback(this.element,value);this.lastValue=value}},registerFormCallbacks:function(){Form.getElements(this.element).each(this.registerCallback,this)},registerCallback:function(element){if(element.type){switch(element.type.toLowerCase()){case"checkbox":case"radio":Event.observe(element,"click",this.onElementEvent.bind(this));break;default:Event.observe(element,"change",this.onElementEvent.bind(this));break}}}});Form.Element.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.Element.getValue(this.element)}});Form.EventObserver=Class.create(Abstract.EventObserver,{getValue:function(){return Form.serialize(this.element)}});(function(){var Event={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,cache:{}};var docEl=document.documentElement;var MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED="onmouseenter" in docEl&&"onmouseleave" in docEl;var isIELegacyEvent=function(event){return false};if(window.attachEvent){if(window.addEventListener){isIELegacyEvent=function(event){return !(event instanceof window.Event)}}else{isIELegacyEvent=function(event){return true}}}var _isButton;function _isButtonForDOMEvents(event,code){return event.which?(event.which===code+1):(event.button===code)}var legacyButtonMap={0:1,1:4,2:2};function _isButtonForLegacyEvents(event,code){return event.button===legacyButtonMap[code]}function _isButtonForWebKit(event,code){switch(code){case 0:return event.which==1&&!event.metaKey;case 1:return event.which==2||(event.which==1&&event.metaKey);case 2:return event.which==3;default:return false}}if(window.attachEvent){if(!window.addEventListener){_isButton=_isButtonForLegacyEvents}else{_isButton=function(event,code){return isIELegacyEvent(event)?_isButtonForLegacyEvents(event,code):_isButtonForDOMEvents(event,code)}}}else{if(Prototype.Browser.WebKit){_isButton=_isButtonForWebKit}else{_isButton=_isButtonForDOMEvents}}function isLeftClick(event){return _isButton(event,0)}function isMiddleClick(event){return _isButton(event,1)}function isRightClick(event){return _isButton(event,2)}function element(event){event=Event.extend(event);var node=event.target,type=event.type,currentTarget=event.currentTarget;if(currentTarget&&currentTarget.tagName){if(type==="load"||type==="error"||(type==="click"&&currentTarget.tagName.toLowerCase()==="input"&&currentTarget.type==="radio")){node=currentTarget}}if(node.nodeType==Node.TEXT_NODE){node=node.parentNode}return Element.extend(node)}function findElement(event,expression){var element=Event.element(event);if(!expression){return element}while(element){if(Object.isElement(element)&&Prototype.Selector.match(element,expression)){return Element.extend(element)}element=element.parentNode}}function pointer(event){return{x:pointerX(event),y:pointerY(event)}}function pointerX(event){var docElement=document.documentElement,body=document.body||{scrollLeft:0};return event.pageX||(event.clientX+(docElement.scrollLeft||body.scrollLeft)-(docElement.clientLeft||0))}function pointerY(event){var docElement=document.documentElement,body=document.body||{scrollTop:0};return event.pageY||(event.clientY+(docElement.scrollTop||body.scrollTop)-(docElement.clientTop||0))}function stop(event){Event.extend(event);event.preventDefault();event.stopPropagation();event.stopped=true}Event.Methods={isLeftClick:isLeftClick,isMiddleClick:isMiddleClick,isRightClick:isRightClick,element:element,findElement:findElement,pointer:pointer,pointerX:pointerX,pointerY:pointerY,stop:stop};var methods=Object.keys(Event.Methods).inject({},function(m,name){m[name]=Event.Methods[name].methodize();return m});if(window.attachEvent){function _relatedTarget(event){var element;switch(event.type){case"mouseover":case"mouseenter":element=event.fromElement;break;case"mouseout":case"mouseleave":element=event.toElement;break;default:return null}return Element.extend(element)}var additionalMethods={stopPropagation:function(){this.cancelBubble=true},preventDefault:function(){this.returnValue=false},inspect:function(){return"[object Event]"}};Event.extend=function(event,element){if(!event){return false}if(!isIELegacyEvent(event)){return event}if(event._extendedByPrototype){return event}event._extendedByPrototype=Prototype.emptyFunction;var pointer=Event.pointer(event);Object.extend(event,{target:event.srcElement||element,relatedTarget:_relatedTarget(event),pageX:pointer.x,pageY:pointer.y});Object.extend(event,methods);Object.extend(event,additionalMethods);return event}}else{Event.extend=Prototype.K}if(window.addEventListener){Event.prototype=window.Event.prototype||document.createEvent("HTMLEvents").__proto__;Object.extend(Event.prototype,methods)}function _createResponder(element,eventName,handler){var registry=Element.retrieve(element,"prototype_event_registry");if(Object.isUndefined(registry)){CACHE.push(element);registry=Element.retrieve(element,"prototype_event_registry",$H())}var respondersForEvent=registry.get(eventName);if(Object.isUndefined(respondersForEvent)){respondersForEvent=[];registry.set(eventName,respondersForEvent)}if(respondersForEvent.pluck("handler").include(handler)){return false}var responder;if(eventName.include(":")){responder=function(event){if(Object.isUndefined(event.eventName)){return false}if(event.eventName!==eventName){return false}Event.extend(event,element);handler.call(element,event)}}else{if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED&&(eventName==="mouseenter"||eventName==="mouseleave")){if(eventName==="mouseenter"||eventName==="mouseleave"){responder=function(event){Event.extend(event,element);var parent=event.relatedTarget;while(parent&&parent!==element){try{parent=parent.parentNode}catch(e){parent=element}}if(parent===element){return }handler.call(element,event)}}}else{responder=function(event){Event.extend(event,element);handler.call(element,event)}}}responder.handler=handler;respondersForEvent.push(responder);return responder}function _destroyCache(){for(var i=0,length=CACHE.length;i<length;i++){Event.stopObserving(CACHE[i]);CACHE[i]=null}}var CACHE=[];if(Prototype.Browser.IE){window.attachEvent("onunload",_destroyCache)}if(Prototype.Browser.WebKit){window.addEventListener("unload",Prototype.emptyFunction,false)}var _getDOMEventName=Prototype.K,translations={mouseenter:"mouseover",mouseleave:"mouseout"};if(!MOUSEENTER_MOUSELEAVE_EVENTS_SUPPORTED){_getDOMEventName=function(eventName){return(translations[eventName]||eventName)}}function observe(element,eventName,handler){element=$(element);var responder=_createResponder(element,eventName,handler);if(!responder){return element}if(eventName.include(":")){if(element.addEventListener){element.addEventListener("dataavailable",responder,false)}else{element.attachEvent("ondataavailable",responder);element.attachEvent("onlosecapture",responder)}}else{var actualEventName=_getDOMEventName(eventName);if(element.addEventListener){element.addEventListener(actualEventName,responder,false)}else{element.attachEvent("on"+actualEventName,responder)}}return element}function stopObserving(element,eventName,handler){element=$(element);var registry=Element.retrieve(element,"prototype_event_registry");if(!registry){return element}if(!eventName){registry.each(function(pair){var eventName=pair.key;stopObserving(element,eventName)});return element}var responders=registry.get(eventName);if(!responders){return element}if(!handler){responders.each(function(r){stopObserving(element,eventName,r.handler)});return element}var i=responders.length,responder;while(i--){if(responders[i].handler===handler){responder=responders[i];break}}if(!responder){return element}if(eventName.include(":")){if(element.removeEventListener){element.removeEventListener("dataavailable",responder,false)}else{element.detachEvent("ondataavailable",responder);element.detachEvent("onlosecapture",responder)}}else{var actualEventName=_getDOMEventName(eventName);if(element.removeEventListener){element.removeEventListener(actualEventName,responder,false)}else{element.detachEvent("on"+actualEventName,responder)}}registry.set(eventName,responders.without(responder));return element}function fire(element,eventName,memo,bubble){element=$(element);if(Object.isUndefined(bubble)){bubble=true}if(element==document&&document.createEvent&&!element.dispatchEvent){element=document.documentElement}var event;if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent("dataavailable",bubble,true)}else{event=document.createEventObject();event.eventType=bubble?"ondataavailable":"onlosecapture"}event.eventName=eventName;event.memo=memo||{};if(document.createEvent){element.dispatchEvent(event)}else{element.fireEvent(event.eventType,event)}return Event.extend(event)}Event.Handler=Class.create({initialize:function(element,eventName,selector,callback){this.element=$(element);this.eventName=eventName;this.selector=selector;this.callback=callback;this.handler=this.handleEvent.bind(this)},start:function(){Event.observe(this.element,this.eventName,this.handler);return this},stop:function(){Event.stopObserving(this.element,this.eventName,this.handler);return this},handleEvent:function(event){var element=Event.findElement(event,this.selector);if(element){this.callback.call(this.element,event,element)}}});function on(element,eventName,selector,callback){element=$(element);if(Object.isFunction(selector)&&Object.isUndefined(callback)){callback=selector,selector=null}return new Event.Handler(element,eventName,selector,callback).start()}Object.extend(Event,Event.Methods);Object.extend(Event,{fire:fire,observe:observe,stopObserving:stopObserving,prototype_on:on});Element.addMethods({fire:fire,observe:observe,stopObserving:stopObserving,prototype_on:on});Object.extend(document,{fire:fire.methodize(),observe:observe.methodize(),stopObserving:stopObserving.methodize(),prototype_on:on.methodize(),loaded:false});if(window.Event){Object.extend(window.Event,Event)}else{window.Event=Event}})();(function(){var timer;function fireContentLoadedEvent(){if(document.loaded){return }if(timer){window.clearTimeout(timer)}document.loaded=true;document.fire("dom:loaded")}function checkReadyState(){if(document.readyState==="complete"){document.stopObserving("readystatechange",checkReadyState);fireContentLoadedEvent()}}function pollDoScroll(){try{document.documentElement.doScroll("left")}catch(e){timer=pollDoScroll.defer();return }fireContentLoadedEvent()}if(document.addEventListener){document.addEventListener("DOMContentLoaded",fireContentLoadedEvent,false)}else{document.observe("readystatechange",checkReadyState);if(window==top){timer=pollDoScroll.defer()}}Event.observe(window,"load",fireContentLoadedEvent)})();Element.addMethods();
Hashtable.toQueryString=Object.toQueryString;var Toggle={display:Element.toggle};Element.Methods.childOf=Element.Methods.descendantOf;var Insertion={Before:function(A,B){return Element.insert(A,{before:B});},Top:function(A,B){return Element.insert(A,{top:B});},Bottom:function(A,B){return Element.insert(A,{bottom:B});},After:function(A,B){return Element.insert(A,{after:B});}};var $continue=new Error('"throw $continue" is deprecated, use "return" instead');var Position={includeScrollOffsets:false,prepare:function(){this.deltaX=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;this.deltaY=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;},within:function(B,A,C){if(this.includeScrollOffsets){return this.withinIncludingScrolloffsets(B,A,C);}this.xcomp=A;this.ycomp=C;this.offset=Element.cumulativeOffset(B);return(C>=this.offset[1]&&C<this.offset[1]+B.offsetHeight&&A>=this.offset[0]&&A<this.offset[0]+B.offsetWidth);},withinIncludingScrolloffsets:function(B,A,D){var C=Element.cumulativeScrollOffset(B);this.xcomp=A+C[0]-this.deltaX;this.ycomp=D+C[1]-this.deltaY;this.offset=Element.cumulativeOffset(B);return(this.ycomp>=this.offset[1]&&this.ycomp<this.offset[1]+B.offsetHeight&&this.xcomp>=this.offset[0]&&this.xcomp<this.offset[0]+B.offsetWidth);},overlap:function(B,A){if(!B){return 0;}if(B=="vertical"){return((this.offset[1]+A.offsetHeight)-this.ycomp)/A.offsetHeight;}if(B=="horizontal"){return((this.offset[0]+A.offsetWidth)-this.xcomp)/A.offsetWidth;}},cumulativeOffset:Element.Methods.cumulativeOffset,positionedOffset:Element.Methods.positionedOffset,absolutize:function(A){Position.prepare();return Element.absolutize(A);},relativize:function(A){Position.prepare();return Element.relativize(A);},realOffset:Element.Methods.cumulativeScrollOffset,offsetParent:Element.Methods.getOffsetParent,page:Element.Methods.viewportOffset,clone:function(B,C,A){A=A||{};return Element.clonePosition(C,B,A);}};if(!document.getElementsByClassName){document.getElementsByClassName=function(B){function A(C){return C.blank()?null:"[contains(concat(' ', @class, ' '), ' "+C+" ')]";}B.getElementsByClassName=Prototype.BrowserFeatures.XPath?function(C,E){E=E.toString().strip();var D=/\s/.test(E)?$w(E).map(A).join(""):A(E);return D?document._getElementsByXPath(".//*"+D,C):[];}:function(E,F){F=F.toString().strip();var G=[],H=(/\s/.test(F)?$w(F):null);if(!H&&!F){return G;}var C=$(E).getElementsByTagName("*");F=" "+F+" ";for(var D=0,J,I;J=C[D];D++){if(J.className&&(I=" "+J.className+" ")&&(I.include(F)||(H&&H.all(function(K){return !K.toString().blank()&&I.include(" "+K+" ");})))){G.push(Element.extend(J));}}return G;};return function(D,C){return $(C||document.body).getElementsByClassName(D);};}(Element.Methods);}Element.ClassNames=Class.create();Element.ClassNames.prototype={initialize:function(A){this.element=$(A);},_each:function(A){this.element.className.split(/\s+/).select(function(B){return B.length>0;})._each(A);},set:function(A){this.element.className=A;},add:function(A){if(this.include(A)){return ;}this.set($A(this).concat(A).join(" "));},remove:function(A){if(!this.include(A)){return ;}this.set($A(this).without(A).join(" "));},toString:function(){return $A(this).join(" ");}};Object.extend(Element.ClassNames.prototype,Enumerable);(function(){window.Selector=Class.create({initialize:function(A){this.expression=A.strip();},findElements:function(A){return Prototype.Selector.select(this.expression,A);},match:function(A){return Prototype.Selector.match(A,this.expression);},toString:function(){return this.expression;},inspect:function(){return"#<Selector: "+this.expression+">";}});Object.extend(Selector,{matchElements:function(F,G){var A=Prototype.Selector.match,D=[];for(var C=0,E=F.length;C<E;C++){var B=F[C];if(A(B,G)){D.push(Element.extend(B));}}return D;},findElement:function(F,G,B){B=B||0;var A=0,D;for(var C=0,E=F.length;C<E;C++){D=F[C];if(Prototype.Selector.match(D,G)&&B===A++){return Element.extend(D);}}},findChildElements:function(B,C){var A=C.toArray().join(", ");return Prototype.Selector.select(A,B||document);}});})();
String.prototype.parseColor=function(){var A="#";if(this.slice(0,4)=="rgb("){var C=this.slice(4,this.length-1).split(",");var B=0;do{A+=parseInt(C[B]).toColorPart();}while(++B<3);}else{if(this.slice(0,1)=="#"){if(this.length==4){for(var B=1;B<4;B++){A+=(this.charAt(B)+this.charAt(B)).toLowerCase();}}if(this.length==7){A=this.toLowerCase();}}}return(A.length==7?A:(arguments[0]||this));};Element.collectTextNodes=function(A){return $A($(A).childNodes).collect(function(B){return(B.nodeType==3?B.nodeValue:(B.hasChildNodes()?Element.collectTextNodes(B):""));}).flatten().join("");};Element.collectTextNodesIgnoreClass=function(A,B){return $A($(A).childNodes).collect(function(C){return(C.nodeType==3?C.nodeValue:((C.hasChildNodes()&&!Element.hasClassName(C,B))?Element.collectTextNodesIgnoreClass(C,B):""));}).flatten().join("");};Element.setContentZoom=function(A,B){A=$(A);A.setStyle({fontSize:(B/100)+"em"});if(Prototype.Browser.WebKit){window.scrollBy(0,0);}return A;};Element.getInlineOpacity=function(A){return $(A).style.opacity||"";};Element.forceRerendering=function(A){try{A=$(A);var C=document.createTextNode(" ");A.appendChild(C);A.removeChild(C);}catch(B){}};var Effect={_elementDoesNotExistError:{name:"ElementDoesNotExistError",message:"The specified DOM element does not exist, but is required for this effect to operate"},Transitions:{linear:Prototype.K,sinoidal:function(A){return(-Math.cos(A*Math.PI)/2)+0.5;},reverse:function(A){return 1-A;},flicker:function(A){var A=((-Math.cos(A*Math.PI)/4)+0.75)+Math.random()/4;return A>1?1:A;},wobble:function(A){return(-Math.cos(A*Math.PI*(9*A))/2)+0.5;},pulse:function(B,A){return(-Math.cos((B*((A||5)-0.5)*2)*Math.PI)/2)+0.5;},spring:function(A){return 1-(Math.cos(A*4.5*Math.PI)*Math.exp(-A*6));},none:function(A){return 0;},full:function(A){return 1;}},DefaultOptions:{duration:1,fps:100,sync:false,from:0,to:1,delay:0,queue:"parallel"},tagifyText:function(A){var B="position:relative";if(Prototype.Browser.IE){B+=";zoom:1";}A=$(A);$A(A.childNodes).each(function(C){if(C.nodeType==3){C.nodeValue.toArray().each(function(D){A.insertBefore(new Element("span",{style:B}).update(D==" "?String.fromCharCode(160):D),C);});Element.remove(C);}});},multiple:function(B,C){var E;if(((typeof B=="object")||Object.isFunction(B))&&(B.length)){E=B;}else{E=$(B).childNodes;}var A=Object.extend({speed:0.1,delay:0},arguments[2]||{});var D=A.delay;$A(E).each(function(G,F){new C(G,Object.extend(A,{delay:F*A.speed+D}));});},PAIRS:{slide:["SlideDown","SlideUp"],blind:["BlindDown","BlindUp"],appear:["Appear","Fade"]},toggle:function(B,C,A){B=$(B);C=(C||"appear").toLowerCase();return Effect[Effect.PAIRS[C][B.visible()?1:0]](B,Object.extend({queue:{position:"end",scope:(B.id||"global"),limit:1}},A||{}));}};Effect.DefaultOptions.transition=Effect.Transitions.sinoidal;Effect.ScopedQueue=Class.create(Enumerable,{initialize:function(){this.effects=[];this.interval=null;},_each:function(A){this.effects._each(A);},add:function(B){var C=new Date().getTime();var A=Object.isString(B.options.queue)?B.options.queue:B.options.queue.position;switch(A){case"front":this.effects.findAll(function(D){return D.state=="idle";}).each(function(D){D.startOn+=B.finishOn;D.finishOn+=B.finishOn;});break;case"with-last":C=this.effects.pluck("startOn").max()||C;break;case"end":C=this.effects.pluck("finishOn").max()||C;break;}B.startOn+=C;B.finishOn+=C;if(!B.options.queue.limit||(this.effects.length<B.options.queue.limit)){this.effects.push(B);}if(!this.interval){this.interval=setInterval(this.loop.bind(this),15);}},remove:function(A){this.effects=this.effects.reject(function(B){return B==A;});if(this.effects.length==0){clearInterval(this.interval);this.interval=null;}},loop:function(){var C=new Date().getTime();for(var B=0,A=this.effects.length;B<A;B++){this.effects[B]&&this.effects[B].loop(C);}}});Effect.Queues={instances:$H(),get:function(A){if(!Object.isString(A)){return A;}return this.instances.get(A)||this.instances.set(A,new Effect.ScopedQueue());}};Effect.Queue=Effect.Queues.get("global");Effect.Base=Class.create({position:null,start:function(A){if(A&&A.transition===false){A.transition=Effect.Transitions.linear;}this.options=Object.extend(Object.extend({},Effect.DefaultOptions),A||{});this.currentFrame=0;this.state="idle";this.startOn=this.options.delay*1000;this.finishOn=this.startOn+(this.options.duration*1000);this.fromToDelta=this.options.to-this.options.from;this.totalTime=this.finishOn-this.startOn;this.totalFrames=this.options.fps*this.options.duration;this.render=(function(){function B(D,C){if(D.options[C+"Internal"]){D.options[C+"Internal"](D);}if(D.options[C]){D.options[C](D);}}return function(C){if(this.state==="idle"){this.state="running";B(this,"beforeSetup");if(this.setup){this.setup();}B(this,"afterSetup");}if(this.state==="running"){C=(this.options.transition(C)*this.fromToDelta)+this.options.from;this.position=C;B(this,"beforeUpdate");if(this.update){this.update(C);}B(this,"afterUpdate");}};})();this.event("beforeStart");if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).add(this);}},loop:function(C){if(C>=this.startOn){if(C>=this.finishOn){this.render(1);this.cancel();this.event("beforeFinish");if(this.finish){this.finish();}this.event("afterFinish");return ;}var B=(C-this.startOn)/this.totalTime,A=(B*this.totalFrames).round();if(A>this.currentFrame){this.render(B);this.currentFrame=A;}}},cancel:function(){if(!this.options.sync){Effect.Queues.get(Object.isString(this.options.queue)?"global":this.options.queue.scope).remove(this);}this.state="finished";},event:function(A){if(this.options[A+"Internal"]){this.options[A+"Internal"](this);}if(this.options[A]){this.options[A](this);}},inspect:function(){var A=$H();for(property in this){if(!Object.isFunction(this[property])){A.set(property,this[property]);}}return"#<Effect:"+A.inspect()+",options:"+$H(this.options).inspect()+">";}});Effect.Parallel=Class.create(Effect.Base,{initialize:function(A){this.effects=A||[];this.start(arguments[1]);},update:function(A){this.effects.invoke("render",A);},finish:function(A){this.effects.each(function(B){B.render(1);B.cancel();B.event("beforeFinish");if(B.finish){B.finish(A);}B.event("afterFinish");});}});Effect.Tween=Class.create(Effect.Base,{initialize:function(C,F,E){C=Object.isString(C)?$(C):C;var B=$A(arguments),D=B.last(),A=B.length==5?B[3]:null;this.method=Object.isFunction(D)?D.bind(C):Object.isFunction(C[D])?C[D].bind(C):function(G){C[D]=G;};this.start(Object.extend({from:F,to:E},A||{}));},update:function(A){this.method(A);}});Effect.Event=Class.create(Effect.Base,{initialize:function(){this.start(Object.extend({duration:0},arguments[0]||{}));},update:Prototype.emptyFunction});Effect.Opacity=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}var A=Object.extend({from:this.element.getOpacity()||0,to:1},arguments[1]||{});this.start(A);},update:function(A){this.element.setOpacity(A);}});Effect.Move=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({x:0,y:0,mode:"relative"},arguments[1]||{});this.start(A);},setup:function(){this.element.makePositioned();this.originalLeft=parseFloat(this.element.getStyle("left")||"0");this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.x=this.options.x-this.originalLeft;this.options.y=this.options.y-this.originalTop;}},update:function(A){this.element.setStyle({left:(this.options.x*A+this.originalLeft).round()+"px",top:(this.options.y*A+this.originalTop).round()+"px"});}});Effect.MoveBy=function(B,A,C){return new Effect.Move(B,Object.extend({x:C,y:A},arguments[3]||{}));};Effect.Scale=Class.create(Effect.Base,{initialize:function(B,C){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({scaleX:true,scaleY:true,scaleContent:true,scaleFromCenter:false,scaleMode:"box",scaleFrom:100,scaleTo:C},arguments[2]||{});this.start(A);},setup:function(){this.restoreAfterFinish=this.options.restoreAfterFinish||false;this.elementPositioning=this.element.getStyle("position");this.originalStyle={};["top","left","width","height","fontSize"].each(function(B){this.originalStyle[B]=this.element.style[B];}.bind(this));this.originalTop=this.element.offsetTop;this.originalLeft=this.element.offsetLeft;var A=this.element.getStyle("font-size")||"100%";["em","px","%","pt"].each(function(B){if(A.indexOf(B)>0){this.fontSize=parseFloat(A);this.fontSizeType=B;}}.bind(this));this.factor=(this.options.scaleTo-this.options.scaleFrom)/100;this.dims=null;if(this.options.scaleMode=="box"){this.dims=[this.element.offsetHeight,this.element.offsetWidth];}if(/^content/.test(this.options.scaleMode)){this.dims=[this.element.scrollHeight,this.element.scrollWidth];}if(!this.dims){this.dims=[this.options.scaleMode.originalHeight,this.options.scaleMode.originalWidth];}},update:function(A){var B=(this.options.scaleFrom/100)+(this.factor*A);if(this.options.scaleContent&&this.fontSize){this.element.setStyle({fontSize:this.fontSize*B+this.fontSizeType});}this.setDimensions(this.dims[0]*B,this.dims[1]*B);},finish:function(A){if(this.restoreAfterFinish){this.element.setStyle(this.originalStyle);}},setDimensions:function(A,D){var E={};if(this.options.scaleX){E.width=D.round()+"px";}if(this.options.scaleY){E.height=A.round()+"px";}if(this.options.scaleFromCenter){var C=(A-this.dims[0])/2;var B=(D-this.dims[1])/2;if(this.elementPositioning=="absolute"){if(this.options.scaleY){E.top=this.originalTop-C+"px";}if(this.options.scaleX){E.left=this.originalLeft-B+"px";}}else{if(this.options.scaleY){E.top=-C+"px";}if(this.options.scaleX){E.left=-B+"px";}}}this.element.setStyle(E);}});Effect.Highlight=Class.create(Effect.Base,{initialize:function(B){this.element=$(B);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({startcolor:"#ffff99"},arguments[1]||{});this.start(A);},setup:function(){if(this.element.getStyle("display")=="none"){this.cancel();return ;}this.oldStyle={};if(!this.options.keepBackgroundImage){this.oldStyle.backgroundImage=this.element.getStyle("background-image");this.element.setStyle({backgroundImage:"none"});}if(!this.options.endcolor){this.options.endcolor=this.element.getStyle("background-color").parseColor("#ffffff");}if(!this.options.restorecolor){this.options.restorecolor=this.element.getStyle("background-color");}this._base=$R(0,2).map(function(A){return parseInt(this.options.startcolor.slice(A*2+1,A*2+3),16);}.bind(this));this._delta=$R(0,2).map(function(A){return parseInt(this.options.endcolor.slice(A*2+1,A*2+3),16)-this._base[A];}.bind(this));},update:function(A){this.element.setStyle({backgroundColor:$R(0,2).inject("#",function(B,C,D){return B+((this._base[D]+(this._delta[D]*A)).round().toColorPart());}.bind(this))});},finish:function(){this.element.setStyle(Object.extend(this.oldStyle,{backgroundColor:this.options.restorecolor}));}});Effect.ScrollTo=function(C){var B=arguments[1]||{},A=document.viewport.getScrollOffsets(),D=$(C).cumulativeOffset();if(B.offset){D[1]+=B.offset;}return new Effect.Tween(null,A.top,D[1],B,function(E){scrollTo(A.left,E.round());});};Effect.Fade=function(C){C=$(C);var A=C.getInlineOpacity();var B=Object.extend({from:C.getOpacity()||1,to:0,afterFinishInternal:function(D){if(D.options.to!=0){return ;}D.element.hide().setStyle({opacity:A});}},arguments[1]||{});return new Effect.Opacity(C,B);};Effect.Appear=function(B){B=$(B);var A=Object.extend({from:(B.getStyle("display")=="none"?0:B.getOpacity()||0),to:1,afterFinishInternal:function(C){C.element.forceRerendering();},beforeSetup:function(C){C.element.setOpacity(C.options.from).show();}},arguments[1]||{});return new Effect.Opacity(B,A);};Effect.Puff=function(B){B=$(B);var A={opacity:B.getInlineOpacity(),position:B.getStyle("position"),top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};return new Effect.Parallel([new Effect.Scale(B,200,{sync:true,scaleFromCenter:true,scaleContent:true,restoreAfterFinish:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:1,beforeSetupInternal:function(C){Position.absolutize(C.effects[0].element);},afterFinishInternal:function(C){C.effects[0].element.hide().setStyle(A);}},arguments[1]||{}));};Effect.BlindUp=function(A){A=$(A);A.makeClipping();return new Effect.Scale(A,0,Object.extend({scaleContent:false,scaleX:false,restoreAfterFinish:true,afterFinishInternal:function(B){B.element.hide().undoClipping();}},arguments[1]||{}));};Effect.BlindDown=function(B){B=$(B);var A=B.getDimensions();return new Effect.Scale(B,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:0,scaleMode:{originalHeight:A.height,originalWidth:A.width},restoreAfterFinish:true,afterSetup:function(C){C.element.makeClipping().setStyle({height:"0px"}).show();},afterFinishInternal:function(C){C.element.undoClipping();}},arguments[1]||{}));};Effect.SwitchOff=function(B){B=$(B);var A=B.getInlineOpacity();return new Effect.Appear(B,Object.extend({duration:0.4,from:0,transition:Effect.Transitions.flicker,afterFinishInternal:function(C){new Effect.Scale(C.element,1,{duration:0.3,scaleFromCenter:true,scaleX:false,scaleContent:false,restoreAfterFinish:true,beforeSetup:function(D){D.element.makePositioned().makeClipping();},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned().setStyle({opacity:A});}});}},arguments[1]||{}));};Effect.DropOut=function(B){B=$(B);var A={top:B.getStyle("top"),left:B.getStyle("left"),opacity:B.getInlineOpacity()};return new Effect.Parallel([new Effect.Move(B,{x:0,y:100,sync:true}),new Effect.Opacity(B,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(C){C.effects[0].element.makePositioned();},afterFinishInternal:function(C){C.effects[0].element.hide().undoPositioned().setStyle(A);}},arguments[1]||{}));};Effect.Shake=function(D){D=$(D);var B=Object.extend({distance:20,duration:0.5},arguments[1]||{});var E=parseFloat(B.distance);var C=parseFloat(B.duration)/10;var A={top:D.getStyle("top"),left:D.getStyle("left")};return new Effect.Move(D,{x:E,y:0,duration:C,afterFinishInternal:function(F){new Effect.Move(F.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(G){new Effect.Move(G.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(H){new Effect.Move(H.element,{x:-E*2,y:0,duration:C*2,afterFinishInternal:function(I){new Effect.Move(I.element,{x:E*2,y:0,duration:C*2,afterFinishInternal:function(J){new Effect.Move(J.element,{x:-E,y:0,duration:C,afterFinishInternal:function(K){K.element.undoPositioned().setStyle(A);}});}});}});}});}});}});};Effect.SlideDown=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,100,Object.extend({scaleContent:false,scaleX:false,scaleFrom:window.opera?0:1,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""});}D.element.makeClipping().setStyle({height:"0px"}).show();},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"});},afterFinishInternal:function(D){D.element.undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A});}},arguments[1]||{}));};Effect.SlideUp=function(C){C=$(C).cleanWhitespace();var A=C.down().getStyle("bottom");var B=C.getDimensions();return new Effect.Scale(C,window.opera?0:1,Object.extend({scaleContent:false,scaleX:false,scaleMode:"box",scaleFrom:100,scaleMode:{originalHeight:B.height,originalWidth:B.width},restoreAfterFinish:true,afterSetup:function(D){D.element.makePositioned();D.element.down().makePositioned();if(window.opera){D.element.setStyle({top:""});}D.element.makeClipping().show();},afterUpdateInternal:function(D){D.element.down().setStyle({bottom:(D.dims[0]-D.element.clientHeight)+"px"});},afterFinishInternal:function(D){D.element.hide().undoClipping().undoPositioned();D.element.down().undoPositioned().setStyle({bottom:A});}},arguments[1]||{}));};Effect.Squish=function(A){return new Effect.Scale(A,window.opera?1:0,{restoreAfterFinish:true,beforeSetup:function(B){B.element.makeClipping();},afterFinishInternal:function(B){B.element.hide().undoClipping();}});};Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break;}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:true,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:true,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"0px"}).show();},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A);}},B));}});};Effect.Shrink=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.none},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var F=C.getDimensions();var E,D;switch(B.direction){case"top-left":E=D=0;break;case"top-right":E=F.width;D=0;break;case"bottom-left":E=0;D=F.height;break;case"bottom-right":E=F.width;D=F.height;break;case"center":E=F.width/2;D=F.height/2;break;}return new Effect.Parallel([new Effect.Opacity(C,{sync:true,to:0,from:1,transition:B.opacityTransition}),new Effect.Scale(C,window.opera?1:0,{sync:true,transition:B.scaleTransition,restoreAfterFinish:true}),new Effect.Move(C,{x:E,y:D,sync:true,transition:B.moveTransition})],Object.extend({beforeStartInternal:function(G){G.effects[0].element.makePositioned().makeClipping();},afterFinishInternal:function(G){G.effects[0].element.hide().undoClipping().undoPositioned().setStyle(A);}},B));};Effect.Pulsate=function(C){C=$(C);var B=arguments[1]||{},A=C.getInlineOpacity(),E=B.transition||Effect.Transitions.linear,D=function(F){return 1-E((-Math.cos((F*(B.pulses||5)*2)*Math.PI)/2)+0.5);};return new Effect.Opacity(C,Object.extend(Object.extend({duration:2,from:0,afterFinishInternal:function(F){F.element.setStyle({opacity:A});}},B),{transition:D}));};Effect.Fold=function(B){B=$(B);var A={top:B.style.top,left:B.style.left,width:B.style.width,height:B.style.height};B.makeClipping();return new Effect.Scale(B,5,Object.extend({scaleContent:false,scaleX:false,afterFinishInternal:function(C){new Effect.Scale(B,1,{scaleContent:false,scaleY:false,afterFinishInternal:function(D){D.element.hide().undoClipping().setStyle(A);}});}},arguments[1]||{}));};Effect.Morph=Class.create(Effect.Base,{initialize:function(C){this.element=$(C);if(!this.element){throw (Effect._elementDoesNotExistError);}var A=Object.extend({style:{}},arguments[1]||{});if(!Object.isString(A.style)){this.style=$H(A.style);}else{if(A.style.include(":")){this.style=A.style.parseStyle();}else{this.element.addClassName(A.style);this.style=$H(this.element.getStyles());this.element.removeClassName(A.style);var B=this.element.getStyles();this.style=this.style.reject(function(D){return D.value==B[D.key];});A.afterFinishInternal=function(D){D.element.addClassName(D.options.style);D.transforms.each(function(E){D.element.style[E.style]="";});};}}this.start(A);},setup:function(){function A(B){if(!B||["rgba(0, 0, 0, 0)","transparent"].include(B)){B="#ffffff";}B=B.parseColor();return $R(0,2).map(function(C){return parseInt(B.slice(C*2+1,C*2+3),16);});}this.transforms=this.style.map(function(G){var F=G[0],E=G[1],D=null;if(E.parseColor("#zzzzzz")!="#zzzzzz"){E=E.parseColor();D="color";}else{if(F=="opacity"){E=parseFloat(E);if(Prototype.Browser.IE&&(!this.element.currentStyle.hasLayout)){this.element.setStyle({zoom:1});}}else{if(Element.CSS_LENGTH.test(E)){var C=E.match(/^([\+\-]?[0-9\.]+)(.*)$/);E=parseFloat(C[1]);D=(C.length==3)?C[2]:null;}}}var B=this.element.getStyle(F);return{style:F.camelize(),originalValue:D=="color"?A(B):parseFloat(B||0),targetValue:D=="color"?A(E):E,unit:D};}.bind(this)).reject(function(B){return((B.originalValue==B.targetValue)||(B.unit!="color"&&(isNaN(B.originalValue)||isNaN(B.targetValue))));});},update:function(A){var D={},B,C=this.transforms.length;while(C--){D[(B=this.transforms[C]).style]=B.unit=="color"?"#"+(Math.round(B.originalValue[0]+(B.targetValue[0]-B.originalValue[0])*A)).toColorPart()+(Math.round(B.originalValue[1]+(B.targetValue[1]-B.originalValue[1])*A)).toColorPart()+(Math.round(B.originalValue[2]+(B.targetValue[2]-B.originalValue[2])*A)).toColorPart():(B.originalValue+(B.targetValue-B.originalValue)*A).toFixed(3)+(B.unit===null?"":B.unit);}this.element.setStyle(D,true);}});Effect.Transform=Class.create({initialize:function(A){this.tracks=[];this.options=arguments[1]||{};this.addTracks(A);},addTracks:function(A){A.each(function(B){B=$H(B);var C=B.values().first();this.tracks.push($H({ids:B.keys().first(),effect:Effect.Morph,options:{style:C}}));}.bind(this));return this;},play:function(){return new Effect.Parallel(this.tracks.map(function(A){var D=A.get("ids"),C=A.get("effect"),B=A.get("options");var E=[$(D)||$$(D)].flatten();return E.map(function(F){return new C(F,Object.extend({sync:true},B));});}).flatten(),this.options);}});Element.CSS_PROPERTIES=$w("backgroundColor backgroundPosition borderBottomColor borderBottomStyle borderBottomWidth borderLeftColor borderLeftStyle borderLeftWidth borderRightColor borderRightStyle borderRightWidth borderSpacing borderTopColor borderTopStyle borderTopWidth bottom clip color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop markerOffset maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex");Element.CSS_LENGTH=/^(([\+\-]?[0-9\.]+)(em|ex|px|in|cm|mm|pt|pc|\%))|0$/;String.__parseStyleElement=document.createElement("div");String.prototype.parseStyle=function(){var B,A=$H();if(Prototype.Browser.WebKit){B=new Element("div",{style:this}).style;}else{String.__parseStyleElement.innerHTML='<div style="'+this+'"></div>';B=String.__parseStyleElement.childNodes[0].style;}Element.CSS_PROPERTIES.each(function(C){if(B[C]){A.set(C,B[C]);}});if(Prototype.Browser.IE&&this.include("opacity")){A.set("opacity",this.match(/opacity:\s*((?:0|1)?(?:\.\d*)?)/)[1]);}return A;};if(document.defaultView&&document.defaultView.getComputedStyle){Element.getStyles=function(B){var A=document.defaultView.getComputedStyle($(B),null);return Element.CSS_PROPERTIES.inject({},function(C,D){C[D]=A[D];return C;});};}else{Element.getStyles=function(B){B=$(B);var A=B.currentStyle,C;C=Element.CSS_PROPERTIES.inject({},function(D,E){D[E]=A[E];return D;});if(!C.opacity){C.opacity=B.getOpacity();}return C;};}Effect.Methods={morph:function(A,B){A=$(A);new Effect.Morph(A,Object.extend({style:B},arguments[2]||{}));return A;},visualEffect:function(C,E,B){C=$(C);var D=E.dasherize().camelize(),A=D.charAt(0).toUpperCase()+D.substring(1);new Effect[A](C,B);return C;},highlight:function(B,A){B=$(B);new Effect.Highlight(B,A);return B;}};$w("fade appear grow shrink fold blindUp blindDown slideUp slideDown pulsate shake puff squish switchOff dropOut").each(function(A){Effect.Methods[A]=function(C,B){C=$(C);Effect[A.charAt(0).toUpperCase()+A.substring(1)](C,B);return C;};});$w("getInlineOpacity forceRerendering setContentZoom collectTextNodes collectTextNodesIgnoreClass getStyles").each(function(A){Effect.Methods[A]=Element[A];});Element.addMethods(Effect.Methods);
if(Object.isUndefined(Effect)){throw ("dragdrop.js requires including script.aculo.us' effects.js library");}var Droppables={drops:[],remove:function(A){this.drops=this.drops.reject(function(B){return B.element==$(A);});},add:function(B){B=$(B);var A=Object.extend({greedy:true,hoverclass:null,tree:false},arguments[1]||{});if(A.containment){A._containers=[];var C=A.containment;if(Object.isArray(C)){C.each(function(D){A._containers.push($(D));});}else{A._containers.push($(C));}}if(A.accept){A.accept=[A.accept].flatten();}Element.makePositioned(B);A.element=B;this.drops.push(A);},findDeepestChild:function(A){deepest=A[0];for(i=1;i<A.length;++i){if(Element.isParent(A[i].element,deepest.element)){deepest=A[i];}}return deepest;},isContained:function(B,A){var C;if(A.tree){C=B.treeNode;}else{C=B.parentNode;}return A._containers.detect(function(D){return C==D;});},isAffected:function(A,C,B){return((B.element!=C)&&((!B._containers)||this.isContained(C,B))&&((!B.accept)||(Element.classNames(C).detect(function(D){return B.accept.include(D);})))&&Position.within(B.element,A[0],A[1]));},deactivate:function(A){if(A.hoverclass){Element.removeClassName(A.element,A.hoverclass);}this.last_active=null;},activate:function(A){if(A.hoverclass){Element.addClassName(A.element,A.hoverclass);}this.last_active=A;},show:function(A,C){if(!this.drops.length){return ;}var B,D=[];this.drops.each(function(E){if(Droppables.isAffected(A,C,E)){D.push(E);}});if(D.length>0){B=Droppables.findDeepestChild(D);}if(this.last_active&&this.last_active!=B){this.deactivate(this.last_active);}if(B){Position.within(B.element,A[0],A[1]);if(B.onHover){B.onHover(C,B.element,Position.overlap(B.overlap,B.element));}if(B!=this.last_active){Droppables.activate(B);}}},fire:function(B,A){if(!this.last_active){return ;}Position.prepare();if(this.isAffected([Event.pointerX(B),Event.pointerY(B)],A,this.last_active)){if(this.last_active.onDrop){this.last_active.onDrop(A,this.last_active.element,B);return true;}}},reset:function(){if(this.last_active){this.deactivate(this.last_active);}}};var Draggables={drags:[],observers:[],register:function(A){if(this.drags.length==0){this.eventMouseUp=this.endDrag.bindAsEventListener(this);this.eventMouseMove=this.updateDrag.bindAsEventListener(this);this.eventKeypress=this.keyPress.bindAsEventListener(this);Event.observe(document,"mouseup",this.eventMouseUp);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"keypress",this.eventKeypress);}this.drags.push(A);},unregister:function(A){this.drags=this.drags.reject(function(B){return B==A;});if(this.drags.length==0){Event.stopObserving(document,"mouseup",this.eventMouseUp);Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"keypress",this.eventKeypress);}},activate:function(A){if(A.options.delay){this._timeout=setTimeout(function(){Draggables._timeout=null;window.focus();Draggables.activeDraggable=A;}.bind(this),A.options.delay);}else{this.activeDraggable=A;}},deactivate:function(){this.activeDraggable=null;},updateDrag:function(A){if(!this.activeDraggable){return ;}var B=[Event.pointerX(A),Event.pointerY(A)];if(this._lastPointer&&(this._lastPointer.inspect()==B.inspect())){return ;}this._lastPointer=B;this.activeDraggable.updateDrag(A,B);},endDrag:function(A){if(this._timeout){clearTimeout(this._timeout);this._timeout=null;}if(!this.activeDraggable){return ;}this._lastPointer=null;this.activeDraggable.endDrag(A);this.activeDraggable=null;},keyPress:function(A){if(this.activeDraggable){this.activeDraggable.keyPress(A);}},addObserver:function(A){this.observers.push(A);this._cacheObserverCallbacks();},removeObserver:function(A){this.observers=this.observers.reject(function(B){return B.element==A;});this._cacheObserverCallbacks();},notify:function(B,A,C){if(this[B+"Count"]>0){this.observers.each(function(D){if(D[B]){D[B](B,A,C);}});}if(A.options[B]){A.options[B](A,C);}},_cacheObserverCallbacks:function(){["onStart","onEnd","onDrag"].each(function(A){Draggables[A+"Count"]=Draggables.observers.select(function(B){return B[A];}).length;});}};var Draggable=Class.create({initialize:function(B){var C={handle:false,reverteffect:function(F,E,D){var G=Math.sqrt(Math.abs(E^2)+Math.abs(D^2))*0.02;new Effect.Move(F,{x:-D,y:-E,duration:G,queue:{scope:"_draggable",position:"end"}});},endeffect:function(E){var D=Object.isNumber(E._opacity)?E._opacity:1;new Effect.Opacity(E,{duration:0.2,from:0.7,to:D,queue:{scope:"_draggable",position:"end"},afterFinish:function(){Draggable._dragging[E]=false;}});},zindex:1000,revert:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,snap:false,delay:0};if(!arguments[1]||Object.isUndefined(arguments[1].endeffect)){Object.extend(C,{starteffect:function(D){D._opacity=Element.getOpacity(D);Draggable._dragging[D]=true;new Effect.Opacity(D,{duration:0.2,from:D._opacity,to:0.7});}});}var A=Object.extend(C,arguments[1]||{});this.element=$(B);if(A.handle&&Object.isString(A.handle)){this.handle=this.element.down("."+A.handle,0);}if(!this.handle){this.handle=$(A.handle);}if(!this.handle){this.handle=this.element;}if(A.scroll&&!A.scroll.scrollTo&&!A.scroll.outerHTML){A.scroll=$(A.scroll);this._isScrollChild=Element.childOf(this.element,A.scroll);}Element.makePositioned(this.element);this.options=A;this.dragging=false;this.eventMouseDown=this.initDrag.bindAsEventListener(this);Event.observe(this.handle,"mousedown",this.eventMouseDown);Draggables.register(this);},destroy:function(){Event.stopObserving(this.handle,"mousedown",this.eventMouseDown);Draggables.unregister(this);},currentDelta:function(){return([parseInt(Element.getStyle(this.element,"left")||"0"),parseInt(Element.getStyle(this.element,"top")||"0")]);},initDrag:function(A){if(!Object.isUndefined(Draggable._dragging[this.element])&&Draggable._dragging[this.element]){return ;}if(Event.isLeftClick(A)){var C=Event.element(A);if((tag_name=C.tagName.toUpperCase())&&(tag_name=="INPUT"||tag_name=="SELECT"||tag_name=="OPTION"||tag_name=="BUTTON"||tag_name=="TEXTAREA")){return ;}var B=[Event.pointerX(A),Event.pointerY(A)];var D=this.element.cumulativeOffset();this.offset=[0,1].map(function(E){return(B[E]-D[E]);});Draggables.activate(this);Event.stop(A);}},startDrag:function(B){this.dragging=true;if(!this.delta){this.delta=this.currentDelta();}if(this.options.zindex){this.originalZ=parseInt(Element.getStyle(this.element,"z-index")||0);this.element.style.zIndex=this.options.zindex;}if(this.options.ghosting){this._clone=this.element.cloneNode(true);this._originallyAbsolute=(this.element.getStyle("position")=="absolute");if(!this._originallyAbsolute){Position.absolutize(this.element);}this.element.parentNode.insertBefore(this._clone,this.element);}if(this.options.scroll){if(this.options.scroll==window){var A=this._getWindowScroll(this.options.scroll);this.originalScrollLeft=A.left;this.originalScrollTop=A.top;}else{this.originalScrollLeft=this.options.scroll.scrollLeft;this.originalScrollTop=this.options.scroll.scrollTop;}}Draggables.notify("onStart",this,B);if(this.options.starteffect){this.options.starteffect(this.element);}},updateDrag:function(event,pointer){if(!this.dragging){this.startDrag(event);}if(!this.options.quiet){Position.prepare();Droppables.show(pointer,this.element);}Draggables.notify("onDrag",this,event);this.draw(pointer);if(this.options.change){this.options.change(this);}if(this.options.scroll){this.stopScrolling();var p;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){p=[left,top,left+width,top+height];}}else{p=Position.page(this.options.scroll).toArray();p[0]+=this.options.scroll.scrollLeft+Position.deltaX;p[1]+=this.options.scroll.scrollTop+Position.deltaY;p.push(p[0]+this.options.scroll.offsetWidth);p.push(p[1]+this.options.scroll.offsetHeight);}var speed=[0,0];if(pointer[0]<(p[0]+this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[0]+this.options.scrollSensitivity);}if(pointer[1]<(p[1]+this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[1]+this.options.scrollSensitivity);}if(pointer[0]>(p[2]-this.options.scrollSensitivity)){speed[0]=pointer[0]-(p[2]-this.options.scrollSensitivity);}if(pointer[1]>(p[3]-this.options.scrollSensitivity)){speed[1]=pointer[1]-(p[3]-this.options.scrollSensitivity);}this.startScrolling(speed);}if(Prototype.Browser.WebKit){window.scrollBy(0,0);}Event.stop(event);},finishDrag:function(B,E){this.dragging=false;if(this.options.quiet){Position.prepare();var D=[Event.pointerX(B),Event.pointerY(B)];Droppables.show(D,this.element);}if(this.options.ghosting){if(!this._originallyAbsolute){Position.relativize(this.element);}delete this._originallyAbsolute;Element.remove(this._clone);this._clone=null;}var F=false;if(E){F=Droppables.fire(B,this.element);if(!F){F=false;}}if(F&&this.options.onDropped){this.options.onDropped(this.element);}Draggables.notify("onEnd",this,B);var A=this.options.revert;if(A&&Object.isFunction(A)){A=A(this.element);}var C=this.currentDelta();if(A&&this.options.reverteffect){if(F==0||A!="failure"){this.options.reverteffect(this.element,C[1]-this.delta[1],C[0]-this.delta[0]);}}else{this.delta=C;}if(this.options.zindex){this.element.style.zIndex=this.originalZ;}if(this.options.endeffect){this.options.endeffect(this.element);}Draggables.deactivate(this);Droppables.reset();},keyPress:function(A){if(A.keyCode!=Event.KEY_ESC){return ;}this.finishDrag(A,false);Event.stop(A);},endDrag:function(A){if(!this.dragging){return ;}this.stopScrolling();this.finishDrag(A,true);Event.stop(A);},draw:function(A){var F=this.element.cumulativeOffset();if(this.options.ghosting){var C=Position.realOffset(this.element);F[0]+=C[0]-Position.deltaX;F[1]+=C[1]-Position.deltaY;}var E=this.currentDelta();F[0]-=E[0];F[1]-=E[1];if(this.options.scroll&&(this.options.scroll!=window&&this._isScrollChild)){F[0]-=this.options.scroll.scrollLeft-this.originalScrollLeft;F[1]-=this.options.scroll.scrollTop-this.originalScrollTop;}var D=[0,1].map(function(G){return(A[G]-F[G]-this.offset[G]);}.bind(this));if(this.options.snap){if(Object.isFunction(this.options.snap)){D=this.options.snap(D[0],D[1],this);}else{if(Object.isArray(this.options.snap)){D=D.map(function(G,H){return(G/this.options.snap[H]).round()*this.options.snap[H];}.bind(this));}else{D=D.map(function(G){return(G/this.options.snap).round()*this.options.snap;}.bind(this));}}}var B=this.element.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=D[0]+"px";}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=D[1]+"px";}if(B.visibility=="hidden"){B.visibility="";}},stopScrolling:function(){if(this.scrollInterval){clearInterval(this.scrollInterval);this.scrollInterval=null;Draggables._lastScrollPointer=null;}},startScrolling:function(A){if(!(A[0]||A[1])){return ;}this.scrollSpeed=[A[0]*this.options.scrollSpeed,A[1]*this.options.scrollSpeed];this.lastScrolled=new Date();this.scrollInterval=setInterval(this.scroll.bind(this),10);},scroll:function(){var current=new Date();var delta=current-this.lastScrolled;this.lastScrolled=current;if(this.options.scroll==window){with(this._getWindowScroll(this.options.scroll)){if(this.scrollSpeed[0]||this.scrollSpeed[1]){var d=delta/1000;this.options.scroll.scrollTo(left+d*this.scrollSpeed[0],top+d*this.scrollSpeed[1]);}}}else{this.options.scroll.scrollLeft+=this.scrollSpeed[0]*delta/1000;this.options.scroll.scrollTop+=this.scrollSpeed[1]*delta/1000;}Position.prepare();Droppables.show(Draggables._lastPointer,this.element);Draggables.notify("onDrag",this);if(this._isScrollChild){Draggables._lastScrollPointer=Draggables._lastScrollPointer||$A(Draggables._lastPointer);Draggables._lastScrollPointer[0]+=this.scrollSpeed[0]*delta/1000;Draggables._lastScrollPointer[1]+=this.scrollSpeed[1]*delta/1000;if(Draggables._lastScrollPointer[0]<0){Draggables._lastScrollPointer[0]=0;}if(Draggables._lastScrollPointer[1]<0){Draggables._lastScrollPointer[1]=0;}this.draw(Draggables._lastScrollPointer);}if(this.options.change){this.options.change(this);}},_getWindowScroll:function(w){var T,L,W,H;with(w.document){if(w.document.documentElement&&documentElement.scrollTop){T=documentElement.scrollTop;L=documentElement.scrollLeft;}else{if(w.document.body){T=body.scrollTop;L=body.scrollLeft;}}if(w.innerWidth){W=w.innerWidth;H=w.innerHeight;}else{if(w.document.documentElement&&documentElement.clientWidth){W=documentElement.clientWidth;H=documentElement.clientHeight;}else{W=body.offsetWidth;H=body.offsetHeight;}}}return{top:T,left:L,width:W,height:H};}});Draggable._dragging={};var SortableObserver=Class.create({initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element);},onStart:function(){this.lastValue=Sortable.serialize(this.element);},onEnd:function(){Sortable.unmark();if(this.lastValue!=Sortable.serialize(this.element)){this.observer(this.element);}}});var Sortable={SERIALIZE_RULE:/^[^_\-](?:[A-Za-z0-9\-\_]*)[_](.*)$/,sortables:{},_findRootElement:function(A){while(A.tagName.toUpperCase()!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A;}A=A.parentNode;}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return ;}return Sortable.sortables[A.id];},destroy:function(A){A=$(A);var B=Sortable.sortables[A.id];if(B){Draggables.removeObserver(B.element);B.droppables.each(function(C){Droppables.remove(C);});B.draggables.invoke("destroy");delete Sortable.sortables[B.element.id];}},create:function(C){C=$(C);var B=Object.extend({element:C,tag:"li",dropOnEmpty:false,tree:false,treeTag:"ul",overlap:"vertical",constraint:"vertical",containment:C,handle:false,only:false,delay:0,hoverclass:null,ghosting:false,quiet:false,scroll:false,scrollSensitivity:20,scrollSpeed:15,format:this.SERIALIZE_RULE,elements:false,handles:false,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(C);var A={revert:true,quiet:B.quiet,scroll:B.scroll,scrollSpeed:B.scrollSpeed,scrollSensitivity:B.scrollSensitivity,delay:B.delay,ghosting:B.ghosting,constraint:B.constraint,handle:B.handle};if(B.starteffect){A.starteffect=B.starteffect;}if(B.reverteffect){A.reverteffect=B.reverteffect;}else{if(B.ghosting){A.reverteffect=function(F){F.style.top=0;F.style.left=0;};}}if(B.endeffect){A.endeffect=B.endeffect;}if(B.zindex){A.zindex=B.zindex;}var D={overlap:B.overlap,containment:B.containment,tree:B.tree,hoverclass:B.hoverclass,onHover:Sortable.onHover};var E={onHover:Sortable.onEmptyHover,overlap:B.overlap,containment:B.containment,hoverclass:B.hoverclass};Element.cleanWhitespace(C);B.draggables=[];B.droppables=[];if(B.dropOnEmpty||B.tree){Droppables.add(C,E);B.droppables.push(C);}(B.elements||this.findElements(C,B)||[]).each(function(H,F){var G=B.handles?$(B.handles[F]):(B.handle?$(H).select("."+B.handle)[0]:H);B.draggables.push(new Draggable(H,Object.extend(A,{handle:G})));Droppables.add(H,D);if(B.tree){H.treeNode=C;}B.droppables.push(H);});if(B.tree){(Sortable.findTreeElements(C,B)||[]).each(function(F){Droppables.add(F,E);F.treeNode=C;B.droppables.push(F);});}this.sortables[C.identify()]=B;Draggables.addObserver(new SortableObserver(C,B.onUpdate));},findElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.tag);},findTreeElements:function(B,A){return Element.findChildren(B,A.only,A.tree?true:false,A.treeTag);},onHover:function(E,D,A){if(Element.isParent(D,E)){return ;}if(A>0.33&&A<0.66&&Sortable.options(D).tree){return ;}else{if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}}},onEmptyHover:function(E,G,H){var I=E.parentNode;var A=Sortable.options(G);if(!Element.isParent(G,E)){var F;var C=Sortable.findElements(G,{tag:A.tag,only:A.only});var B=null;if(C){var D=Element.offsetSize(G,A.overlap)*(1-H);for(F=0;F<C.length;F+=1){if(D-Element.offsetSize(C[F],A.overlap)>=0){D-=Element.offsetSize(C[F],A.overlap);}else{if(D-(Element.offsetSize(C[F],A.overlap)/2)>=0){B=F+1<C.length?C[F+1]:null;break;}else{B=C[F];break;}}}}G.insertBefore(E,B);Sortable.options(I).onChange(E);A.onChange(E);}},unmark:function(){if(Sortable._marker){Sortable._marker.hide();}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(D&&!D.ghosting){return ;}if(!Sortable._marker){Sortable._marker=($("dropmarker")||Element.extend(document.createElement("DIV"))).hide().addClassName("dropmarker").setStyle({position:"absolute"});document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}var C=B.cumulativeOffset();Sortable._marker.setStyle({left:C[0]+"px",top:C[1]+"px"});if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.setStyle({left:(C[0]+B.clientWidth)+"px"});}else{Sortable._marker.setStyle({top:(C[1]+B.clientHeight)+"px"});}}Sortable._marker.show();},_tree:function(E,B,F){var D=Sortable.findElements(E,B)||[];for(var C=0;C<D.length;++C){var A=D[C].id.match(B.format);if(!A){continue;}var G={id:encodeURIComponent(A?A[1]:null),element:E,parent:F,children:[],position:F.children.length,container:$(D[C]).down(B.treeTag)};if(G.container){this._tree(G.container,B,G);}F.children.push(G);}return F;},tree:function(D){D=$(D);var C=this.options(D);var B=Object.extend({tag:C.tag,treeTag:C.treeTag,only:C.only,name:D.id,format:C.format},arguments[1]||{});var A={id:null,parent:null,children:[],container:D,position:0};return Sortable._tree(D,B,A);},_constructIndex:function(B){var A="";do{if(B.id){A="["+B.position+"]"+A;}}while((B=B.parent)!=null);return A;},sequence:function(B){B=$(B);var A=Object.extend(this.options(B),arguments[1]||{});return $(this.findElements(B,A)||[]).map(function(C){return C.id.match(A.format)?C.id.match(A.format)[1]:"";});},setSequence:function(B,C){B=$(B);var A=Object.extend(this.options(B),arguments[2]||{});var D={};this.findElements(B,A).each(function(E){if(E.id.match(A.format)){D[E.id.match(A.format)[1]]=[E,E.parentNode];}E.parentNode.removeChild(E);});C.each(function(E){var F=D[E];if(F){F[1].appendChild(F[0]);delete D[E];}});},serialize:function(C){C=$(C);var B=Object.extend(Sortable.options(C),arguments[1]||{});var A=encodeURIComponent((arguments[1]&&arguments[1].name)?arguments[1].name:C.id);if(B.tree){return Sortable.tree(C,arguments[1]).children.map(function(D){return[A+Sortable._constructIndex(D)+"[id]="+encodeURIComponent(D.id)].concat(D.children.map(arguments.callee));}).flatten().join("&");}else{return Sortable.sequence(C,arguments[1]).map(function(D){return A+"[]="+encodeURIComponent(D);}).join("&");}}};Element.isParent=function(B,A){if(!B.parentNode||B==A){return false;}if(B.parentNode==A){return true;}return Element.isParent(B.parentNode,A);};Element.findChildren=function(D,B,A,C){if(!D.hasChildNodes()){return null;}C=C.toUpperCase();if(B){B=[B].flatten();}var E=[];$A(D.childNodes).each(function(G){if(G.tagName&&G.tagName.toUpperCase()==C&&(!B||(Element.classNames(G).detect(function(H){return B.include(H);})))){E.push(G);}if(A){var F=Element.findChildren(G,B,A,C);if(F){E.push(F);}}});return(E.length>0?E.flatten():[]);};Element.offsetSize=function(A,B){return A["offset"+((B=="vertical"||B=="height")?"Height":"Width")];};
Ice.DnD=Class.create();var IceLoaded=false;Ice.DnD.logger=Class.create();Ice.DnD.logger={debug:function(){},warn:function(){},error:function(){}};Ice.DnD={log:function(A){Ice.DnD.logger.debug(A);},DRAG_START:1,DRAG_CANCEL:2,DROPPED:3,HOVER_START:4,HOVER_END:5,init:function(){Ice.DnD.logger=window.logger.child("dragDrop");Ice.StateMon.logger=window.logger.child("stateMon");Ice.StateMon.destroyAll();IceLoaded=true;},elementReplaced:function(B){var A=$(B.id);return A!=null&&A!=B;},check:function(){Ice.StateMon.checkAll();},alreadyDrag:function(B){B=$(B);var A=false;$A(Draggables.drags).each(function(C){if(C.element&&C.element.id==B.id){A=true;}});return A;},sortableDraggable:function(B){B=$(B);var A=false;$A(Draggables.drags).each(function(C){if(C.element&&C.element.id==B.id){if(C.options.sort){A=true;}}});return A;},alreadyDrop:function(B){B=$(B);var A=false;$(Droppables.drops).each(function(C){if(C&&C.element.id==B.id){A=true;}});return A;},alreadySort:function(B){var A=Sortable.options(B);if(A){return true;}return false;}};Ice.PanelCollapsible={fire:function(A,E,B,G){var F=document.getElementById(A);var D=document.getElementById(E);try{if(Element.visible(F)){D.className=Ice.PanelCollapsible.getStyleClass(B,G,"ColpsdHdr");Ice.PanelCollapsible.collapse(A);}else{D.className=Ice.PanelCollapsible.getStyleClass(B,G,"Hdr");Ice.PanelCollapsible.expand(A);}}catch(C){console.log("Error in panel collapsible ["+C+"]");}},expand:function(A){var B=document.getElementById(A);if(!Element.visible(B)){Effect.SlideDown(A,{uploadCSS:true,submit:true,duration:0.5});}},collapse:function(A){var B=document.getElementById(A);if(Element.visible(B)){Effect.SlideUp(A,{uploadCSS:true,submit:true,duration:0.5});}},getStyleClass:function(A,C,D){var B=A+D;if(C!=null){B+=" "+C+D;}return B;}};var singleRowSelectionExecuter;var localEvent;Ice.tableRowClicked=function(P,S,I,T,C,G,H,J){var M=document.getElementsByName(C+"ctrKy");var E=document.getElementsByName(C+"sftKy");if(M.length>0){M=M[0];}else{M=null;}if(E.length>0){E=E[0];}else{E=null;}if(M&&P){M.value=P.ctrlKey||P.metaKey;}if(E&&P){E.value=P.shiftKey;}try{if(S){var K;if(!P){var P=window.event;}if(!P){var P=localEvent;}if(P.target){K=P.target;}else{if(P.srcElement){K=P.srcElement;}}if(K.nodeType==3){K=K.parentNode;}while(true){var L=K.tagName.toLowerCase();if(L=="tr"){break;}if(L=="input"||L=="select"||L=="option"||(L=="a"&&"iceHdnLnk"!=K.className)||L=="textarea"){return ;}if(K.parentNode){K=K.parentNode;}else{break;}}}var D=H.iceHdnLnk;if(!D){var N=H.getElementsByTagName("a");if(N.length>0&&N[0].className=="iceHdnLnk"){D=N[0];H.iceHdnLnk=D;}}if(D){setFocus(D.id);}if(J){var Q=Ice.tableRowClicked.findPanelGroupContainer(H);if(Q){var O=document.getElementsByName(C+"scrCont");if(O.length>0){O=O[0];}else{O=null;}if(O){var F=document.getElementsByName(C+"scrPos");if(F.length>0){F=F[0];}else{F=null;}if(F){O.value=Q.id;F.value=Q.scrollLeft;setFocus("");}}}}if(G){H.className=G;H.onmouseover=Prototype.emptyFunction;H.onmouseout=Prototype.emptyFunction;}var A=document.forms[T][C];A.value=I;var B=new Object();iceSubmitPartial(null,A,B);setFocus("");}catch(R){logger.info("Error in rowSelector["+R+"]");}};Ice.tableRowClicked.findPanelGroupContainer=function(A){if(A){if(A.className.indexOf("icePnlGrp")>-1){return A;}else{return Ice.tableRowClicked.findPanelGroupContainer(A.parentNode);}}else{return null;}};Ice.clickEvents={};Ice.registerClick=function(F,A,E,D,J,G,K,B,C,I,H){if(!Ice.clickEvents[F.id]){Ice.clickEvents[F.id]=new Ice.clickEvent(F,A,E,D,J,G,K,B,C,I,H);}};Ice.registerDblClick=function(A){try{if(document.selection){document.selection.empty();}}catch(B){}if(Ice.clickEvents[A.id]){Ice.clickEvents[A.id].submit(2);}};Ice.clickEvent=Class.create({initialize:function(F,A,E,D,J,G,K,B,C,I,H){this.elem=F;this.hdnClkRow=A;this.hdnClkCount=E;this.rowid=D;this.formId=J;if(G<0){this.delay=0;}else{if(G>1000){this.delay=1000;}else{this.delay=G;}}this.toggleOnClick=K;if(this.toggleOnClick){this.event=Object.clone(B);this.useEvent=C;this.hdnFld=I;this.toggleClassNames=H;}this.timer=setTimeout(this.submit.bind(this,1),this.delay);},submit:function(B){clearTimeout(this.timer);Ice.clickEvents[this.elem.id]=null;var A=document.forms[this.formId][this.hdnClkRow];A.value=this.rowid;var D=document.forms[this.formId][this.hdnClkCount];D.value=B;if(this.toggleOnClick){Ice.tableRowClicked(this.event,this.useEvent,this.rowid,this.formId,this.hdnFld,this.toggleClassNames,this.elem);}else{var C=new Object();iceSubmitPartial(null,A,C);}}});Ice.preventTextSelection=function(A){if(Ice.isEventSourceInputElement(A)){return true;}else{if(A.shiftKey||A.ctrlKey){Ice.disableTxtSelection(document.body);return false;}return true;}};Ice.disableTxtSelection=function(A){A.onselectstart=function(){return false;};A.onmousedown=function(B){return false;};};Ice.enableTxtSelection=function(A){A.onselectstart=function(){return true;};A.onmousedown=function(B){return true;};};Ice.txtAreaMaxLen=function(B,A){if(A>=0&&B.value.length>A){B.value=B.value.substring(0,A);}};Ice.isEventSourceInputElement=function(D){var B=D||window.event;var B=Event.extend(B);var C=B.element();var A=C.tagName.toLowerCase();if(A=="input"||A=="select"||A=="option"||A=="a"||A=="textarea"){return true;}else{return false;}};Ice.tabNavigator=function(D){var E=Event.element(D);var B=D.keyCode;switch(B){case 37:case 38:var A=E.up(".icePnlTb").previousSibling;if(A){var F=A.down(".icePnlTbLblLnk");if(F){F.focus();}}if(E.up(".icePnlTb")){if(D.preventDefault){D.preventDefault();}else{if(D.returnValue){D.returnValue=false;}}}break;case 39:case 40:var C=E.up(".icePnlTb").nextSibling;if(C&&Element.hasClassName(C,"icePnlTb")){var F=C.down(".icePnlTbLblLnk");if(F){F.focus();}}if(E.up(".icePnlTb")){if(D.preventDefault){D.preventDefault();}else{if(D.returnValue){D.returnValue=false;}}}break;}};Ice.pnlTabOnFocus=function(B,C,A){setFocus(B.id);if(A){Event.observe(B,"keydown",Ice.tabNavigator);}if(!C){return ;}Ice.simulateFocus(B.parentNode,B);};Ice.pnlTabOnBlur=function(B,C,A){if(A){Event.stopObserving(B,"keydown",Ice.tabNavigator);}if(!C){return ;}setFocus("");Ice.simulateBlur(B.parentNode,B);};Ice.pnlClpFocus=function(B){var A=B.parentNode;Ice.simulateFocus(A,B);A.style.padding="0px";};Ice.pnlClpBlur=function(B){var A=B.parentNode;Ice.simulateBlur(A,B);A.style.padding="1px";};Ice.simulateFocus=function(B,A){if(!document.all){A.style.visibility="hidden";}A.style.borderStyle="none";A.style.outlineStyle="none";A.style.borderWidth="0px";A.style.outlineWidth="0px";A.style.margin="0px";if(B==null){return ;}B._borderStyle=B.style.borderStyle;B.style.borderStyle="dotted";B._borderWidth=B.style.borderWidth;B.style.borderWidth="1px 1px 1px 1px";B._borderColor=B.style.borderColor;B.style.borderColor="black";};Ice.simulateBlur=function(B,A){if(!document.all){A.style.visibility="visible";}if(B==null){return ;}B.style.borderStyle=B._borderStyle;B.style.borderWidth=B._borderWidth;B.style.borderColor=B._borderColor;};Ice.DataExporters={};Ice.DataExporter=function(B){this.id=B;if(!Ice.DataExporters[this.id]){Ice.DataExporters[this.id]=this;if(Ice.DataExporter.shouldOpenPopUp()){if(!this.window){this.openWindow();}}}else{if(Ice.DataExporter.shouldOpenPopUp()){var A=Ice.DataExporters[this.id];if(A.window.closed){A.openWindow();}A.body.innerHTML="<p>Please wait while your file is generated...</p>";A.window.focus();}}};Ice.DataExporter.prototype.openWindow=function(){this.window=window.open("","","width=400,height=150");this.window.document.write('<html><head><title>Data export file loader</title></head><body id="body"></body></html>');this.body=this.window.document.getElementById("body");this.body.innerHTML="<p>Please wait while your file is generated...</p>";};Ice.DataExporter.prototype.url=function(A){if(Ice.DataExporter.shouldOpenPopUp()){this.body.innerHTML='<p>Click link below to download file.</p><a href="'+A+'">Download</a>';this.window.focus();}else{var B=document.createElement("iframe");B.setAttribute("src",A);B.style.display="none";document.body.appendChild(B);Ice.DataExporters[this.id]=null;}};Ice.DataExporter.shouldOpenPopUp=function(){if(Prototype.Browser.IE){var A=parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5));if(A==6||A==7){return true;}}return false;};Ice.tblRowFocus=function(C,A){var B=C.parentNode.parentNode;Ice.simulateFocus(null,C);setFocus(C.id);B.onmouseover.apply(B,arguments);if(C.keydownRegistered==null){Element.observe(C,"keydown",function(G){G=Event.extend(G);var P=G.keyCode;switch(P){case 0:case 32:B.onclick.apply(B,arguments);Event.stop(G);return false;case 38:if(Element.previous(B)){var K=Element.previous(B);K.firstChild.firstChild.focus();if(A){localEvent=Object.clone(G);window.clearTimeout(singleRowSelectionExecuter);singleRowSelectionExecuter=window.setTimeout(function(){try{arguments[0]=localEvent;K.onclick.apply(K,arguments);}catch(Q){}},400);}var J=B.parentNode.parentNode.parentNode;var E=Element.cumulativeOffset(K).top;var H=Element.cumulativeOffset(J).top;var I=J.scrollTop;var L=E-(H+I);if(L<0){J.scrollTop=I+L;}}Event.stop(G);return false;case 40:if(Element.next(B)){var K=Element.next(B);K.firstChild.firstChild.focus();if(A){localEvent=Object.clone(G);window.clearTimeout(singleRowSelectionExecuter);singleRowSelectionExecuter=window.setTimeout(function(){try{arguments[0]=localEvent;K.onclick.apply(K,arguments);}catch(Q){}},400);}var J=B.parentNode.parentNode.parentNode;var E=Element.cumulativeOffset(K).top;var D=Element.getHeight(K);var H=Element.cumulativeOffset(J).top;var F=Element.getHeight(J);var I=J.scrollTop;var L=(E+D)-(F+I+H);if(L>0){J.scrollTop=I+L;}}Event.stop(G);return false;case 33:case 34:case 35:case 36:var O=Element.up(B,".iceDatTbl");var M=null;if(O.paginator==null){if(Prototype.Browser.IE){var N=$(document.body).select(".iceDatPgr");for(i=0;i<N.length;i++){if(N[i].name==O.id){M=N[i];O.paginator=M;break;}}}else{var N=document.getElementsByName(O.id);if(N.length>0){M=N[0];}}}if(M){Ice.DatPagKybrd(M.id,G);}return false;}});C.keydownRegistered=true;}};Ice.tblRowBlur=function(B){var A=B.parentNode.parentNode;Ice.simulateBlur(null,B);A.onmouseout.apply(A,arguments);setFocus("");};Ice.tblMsOvr=function(A){};Ice.DatPagKybrd=function(B,D){D=Event.extend(D);var F=D.keyCode;var A=null;switch(F){case 33:logger.info("PageUp");A="previous";break;case 34:A="next";logger.info("pageDown");break;case 35:A="last";logger.info("end");break;case 36:A="first";logger.info("Home");break;}if(A==null){return ;}var C=formOf(document.getElementById(B));var E=new Ice.Parameter.Query();E.add(B,A);if(D.target.id.contains(B)){E.add(B+"kbd","true");}iceSubmitPartial(C,null,D,E);Event.stop(D);};Prototype.Browser.Safari4=navigator.userAgent.indexOf("4.0.4 Safari")>-1;Prototype.Browser.Chrome=navigator.userAgent.indexOf("Chrome")>-1;String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"");};Ice.registerEventListener=function(ele,mask,handler){if(mask==null||mask==""){return ;}ele=$(ele);if(ele.listenerInstalled){return ;}ele.listenerInstalled=true;events=mask.split(",");if(handler){try{ele.jshandler=eval(handler.trim());}catch(e){logger.info(e);}}for(i=0;i<events.length;i++){Event.observe(ele,events[i].trim(),function(event){event=Event.extend(event);var proceed=true;if(ele.jshandler){try{proceed=ele.jshandler(event);}catch(e){logger.info(e);}}if(!proceed){return ;}try{var form=formOf(ele);var query=new Ice.Parameter.Query();query.add(ele.id,"submitted");iceSubmitPartial(form,null,event,query);}catch(e){logger.info(e);}});}};
Ice.util=Class.create();Ice.util={findForm:function(A){var B=A.nodeName.toLowerCase();if(B=="form"){return A;}return this.findForm(A.parentNode);},adjustMyPosition:function(F,Q){var J=$(F).getHeight();var K=Element.cumulativeOffset($(F)).top;var O=document.viewport.getScrollOffsets().top+document.viewport.getHeight();var P=Element.cumulativeOffset($(Q)).top;var N=K-P;var C=K+$(F).getHeight();var D=J+N;if(O<C&&D<O&&J<P){$(F).parentNode.style.position="absolute";$(F).parentNode.style.top="-"+D+"px";var E=$(F).up().next("iframe");if(E){E.clonePosition(F);}}var I=$(Q).select("input:first-child")[0].getWidth();var L=$(F).getWidth();var G=Element.cumulativeOffset($(F)).left;var M=document.viewport.getScrollOffsets().left+document.viewport.getWidth();var H=Element.cumulativeOffset($(Q)).left;N=G-H;var A=G+$(F).getWidth();var B=L+N;if(M<A&&B<M&&L<H){$(F).parentNode.style.position="absolute";$(F).parentNode.style.left="-"+(L-I)+"px";E=$(F).up().next("iframe");if(E){E.clonePosition(F);}}},radioCheckboxEnter:function(C,B,A){if(A.keyCode==Event.KEY_RETURN){iceSubmit(C,B,A);}}};var IE=(Try.these(function(){new ActiveXObject("Msxml2.XMLHTTP");return true;},function(){new ActiveXObject("Microsoft.XMLHTTP");return true;})||false);
Ice.StateMon=Class.create();Ice.StateMon={logger:null,monitors:Array(),add:function(A){this.logger.debug("Added monitor for ["+A.id+"] type ["+A.type+"]");this.monitors.push(A);},checkAll:function(){var D=0;var A=null;var C=this.monitors.length;for(D=0;D<C;D++){A=this.monitors[D];try{this.detectChangedAndRemoved(A);}catch(B){this.logger.error("Error checking monitor ["+A.id+"] Msg ["+B+"]");}}this.destroy();this.rebuild();},removeMonitors:function(B){var A=Array();var C=0;for(C=0;C<this.monitors.length;C++){if(!this.monitors[C].removeMe){A.push(this.monitors[C]);}}this.monitors=A;},destroy:function(){var D=0;var A=null;var E=Array();for(D=0;D<this.monitors.length;D++){A=this.monitors[D];try{if(!A.destroyMe){E.push(A);}else{try{this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}catch(C){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+C+"]");}A=null;}}catch(B){this.logger.error("Error destroying monitor ["+A.id+"] Msg ["+B+"]");}}this.monitors=E;},destroyAll:function(){var C=0;var A=null;var D=Array();for(C=0;C<this.monitors.length;C++){A=this.monitors[C];try{if(A!=null){this.logger.debug("Destroyed monitor ["+A.id+"]");A.destroy();}}catch(B){this.logger.warn("Monitor ["+A.id+"] destroyed with exception ["+B+"]");}A=null;}this.monitors=Array();},rebuild:function(){var B=this.monitors.length;try{for(i=0;i<B;i++){monitor=this.monitors[i];if(monitor.rebuildMe){this.logger.debug("Rebuilding ["+monitor.id+"]");try{monitor.destroy();}catch(C){this.logger.warn("Could not destroy monitor before rebuilding ID["+monitor.id+"] msg ["+C+"]");}monitor.rebuildingMe=true;monitor.rebuild();monitor.rebuildingMe=false;monitor.rebuildMe=false;monitor.removeMe=true;}else{this.logger.debug("Not rebuilding ["+monitor.id+"] type ["+monitor.type+"]");}}this.removeMonitors();}catch(A){this.logger.error("Error rebuilding monitors ["+A+"]");}},elementExists:function(B){var A=$(B);if(!A){return false;}return true;},detectChangedAndRemoved:function(A){var B=$(A.id);if(A.changeDetected(B)){this.logger.debug("Monitor ["+A.id+"] has been replaced");A.rebuildMe=true;}else{this.logger.debug("Monitor ["+A.id+"] has not been replaced");A.rebuildMe=false;}if(!B){this.logger.debug("Monitor ["+A.id+"] no longer exists in dom");A.destroyMe=true;}},elementReplaced:function(B,A){if(B&&!B.id){return false;}if(!A){this.logger.debug("Element not found id["+B.id+"] element["+B+"] type ["+B.nodeName+"]");}if(A!=null&&A!=B){this.logger.debug("Element replaced");return true;}}};Ice.MonitorBase=Class.create();Ice.MonitorBase.prototype={object:null,id:null,htmlElement:null,rebuildMe:false,rebuild:function(){},createOptions:null,options:null,destroyMe:false,destroy:function(){},type:"Base",initialize:function(){},changeDetected:function(A){return Ice.StateMon.elementReplaced(this.htmlElement,A);},removeMe:false};Ice.SortableMonitor=Class.create();Ice.SortableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Sortable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Sortable.destroy(this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Sortable ID["+this.id+"] Options["+this.createOptions+"]");Sortable.create(this.id,this.createOptions);},changeDetected:function(A){return true;}});Ice.DraggableMonitor=Class.create();Ice.DraggableMonitor.prototype=Object.extend(new Ice.MonitorBase(),{initialize:function(B,A){this.type="Draggable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){this.object.destroy();Ice.StateMon.logger.debug("Destroyed Draggable ["+this.id+"]");$A(Draggables.drags).each(function(A){Ice.StateMon.logger.debug("Draggable ["+A.element.id+"] not destroyed");});},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"]");var A=new Draggable(this.id,this.createOptions);Ice.StateMon.logger.debug("Rebuilding Draggable ID["+this.id+"] Options["+this.createOptions+"] Complete");}});Ice.DroppableMonitor=Class.create();Ice.DroppableMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(B,A){this.type="Droppable";this.object=null;this.id=B.id;this.htmlElement=B;this.createOptions=A;},destroy:function(){Droppables.removeOptimised(this.id,this.htmlElement);},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Droppables ID["+this.id+"] Options["+this.createOptions+"]");Droppables.add(this.id,this.createOptions);}});Ice.AutocompleterMonitor=Class.create();Ice.AutocompleterMonitor.prototype=Object.extend(new Ice.MonitorBase,{initialize:function(D,E,C,A,B){this.type="Autocompleter";this.object=null;this.id=D.id;this.htmlElement=D;this.createOptions=C;this.update=E;this.rowClass=A;this.selectedRowClass=B;},destroy:function(){this.object.dispose();},rebuild:function(){Ice.StateMon.logger.debug("Rebuilding Autocompleter ID["+this.id+"] Options["+this.createOptions+"]");return new Ice.Autocompleter(this.id,this.update.id,this.createOptions,this.rowClass,this.selectedRowClass);}});
Ice.DnD.StyleReader=Class.create();Ice.DnD.StyleReader={styles:"position,top,left,display",buildStyle:function(B){var A="";Ice.DnD.StyleReader.styles.split(",").each(function(C){A+=C+":"+Ice.DnD.StyleReader.getStyle(B,C)+";";});return A;},getStyle:function(B,A){if(B.currentStyle){var C=B.currentStyle[A];}else{if(window.getComputedStyle){var C=document.defaultView.getComputedStyle(B,null).getPropertyValue(A);}else{var C=B.style[A];}}return C;},findCssField:function(E,D){if(!D){D=Ice.util.findForm(E);}var B=D.getElementsByTagName("input");var A=null;var C=0;for(C=0;C<B.length;C++){if(B[C].type=="hidden"&&B[C].name=="icefacesCssUpdates"){A=B[C];break;}}return A;},upload:function(E,D){var A=Ice.DnD.StyleReader.findCssField(E);if(A){var F=A.value;var B=Ice.DnD.StyleReader.buildStyle(E);Ice.DnD.logger.debug("Update CSS ID["+E.id+"] CSS["+B+"] form filed name = ["+A.name+"]");A.value=F+E.id+"{"+B+"}";if(D){var C=Ice.util.findForm(E);iceSubmitPartial(C,E,null);}}}};Ice.modal={running:[],isRunning:function(A){return this.running.include(A);},setRunning:function(A){if(!this.running.include(A)){this.running.push(A);}this.disableTabindex(A);},stopRunning:function(A){this.running=this.running.reject(function(B){return B==A;});this.restoreTabindex(this.getRunning());},getRunning:function(){return this.running.isEmpty()?null:this.running.last();},target:null,zIndexCount:25000,start:function(H,M,D,B,F){var L=document.getElementById(H);L.style.visibility="hidden";L.style.position="absolute";var G=document.getElementById("iceModalFrame"+H);if(!G){G=document.createElement("iframe");G.title="Ice Modal Frame";G.frameborder="0";G.id="iceModalFrame"+H;G.src=M;G.style.zIndex=Ice.modal.zIndexCount;Ice.modal.zIndexCount+=3;G.style.opacity=0.5;G.style.filter="alpha(opacity=50)";G.style.position="absolute";G.style.visibility="hidden";G.style.backgroundColor="black";G.style.borderWidth="0";var N=$(H).getOffsetParent().cumulativeOffset();G.style.top="-"+N.top+"px";G.style.left="-"+N.left+"px";L.parentNode.insertBefore(G,L);var K=document.createElement("div");K.style.position="absolute";K.style.zIndex=parseInt(G.style.zIndex)+1;K.style.backgroundColor="transparent";L.parentNode.insertBefore(K,L);var C=function(){var Q=document.getElementById("iceModalFrame"+H);if(Q){var R=Q.style.display;Q.style.display="none";var Z=document.documentElement.scrollWidth;var Y=document.body.scrollWidth;var c=document.documentElement.scrollHeight;var b=document.body.scrollHeight;var P=(Y>Z?Y:Z);var a=(b>c?b:c);var U=document.viewport.getHeight();if(a<U){a=U;}Q.style.width=P+"px";Q.style.height=a+"px";Q.style.visibility="visible";var W=100;var T=100;try{W=Element.getWidth(L);T=Element.getHeight(L);}catch(X){}W=parseInt(W)/2;T=parseInt(T)/2;if(!B&&!Ice.autoCentre.ids.include(H)){var V=document.viewport.getWidth();var S=document.viewport.getScrollOffsets();L.style.top=(parseInt(U)/2)-T-N.top+S.top+"px";L.style.left=(parseInt(V)/2)-W-N.left+S.left+"px";}Q.style.display=R;$(Q.nextSibling).clonePosition(Q);}};C();window.onResize(C);if(!F){window.onScroll(C);}}var L=document.getElementById(H);L.style.zIndex=parseInt(G.style.zIndex)+2;Ice.modal.target=L;Ice.modal.setRunning(H);L.style.visibility="visible";if(D){Ice.modal.trigger=D;$(D).blur();setFocus("");}function J(){return false;}function A(Q){while(Q.parentNode){var P=Q.parentNode;if(P==L){return true;}Q=P;}return false;}if(!Ice.modal.rollbacks){function E(U,Q){if(U.hasCallbacksDisabled){return Function.NOOP;}else{U.hasCallbacksDisabled=true;var S=U.onkeypress;var R=U.onkeyup;var T=U.onkeydown;var P=U.onclick;U.onkeypress=Q;U.onkeyup=Q;U.onkeydown=Q;U.onclick=Q;I.push(function(){try{U.onkeypress=S;U.onkeyup=R;U.onkeydown=T;U.onclick=P;U.hasCallbacksDisabled=null;}catch(V){logger.error("failed to restore callbacks on "+U,V);}});}}var I=Ice.modal.rollbacks=[];var O=["input","select","textarea","button","a"];O.each(function(P){$enumerate(document.body.getElementsByTagName(P)).each(function(Q){if(!A(Q)){E(Q,J);}});});$enumerate(document.body.getElementsByTagName("iframe")).each(function(Q){if(!A(Q)){var S=Q.contentDocument||Q.contentWindow.document;var P=Q.contentWindow;function R(U){var T=(U&&U.target)||(P.event&&P.event.srcElement);return T&&S==T.ownerDocument;}E(P,R);E(S,R);}});}},stop:function(C){var B=Ice.modal.running.include(C);if(B){Ice.modal.stopRunning(C);Ice.modal.zIndexCount-=3;var A=document.getElementById("iceModalFrame"+C);if(A){A.parentNode.removeChild(A.nextSibling);A.parentNode.removeChild(A);}if(Ice.modal.trigger){Ice.Focus.setFocus(Ice.modal.trigger);Ice.modal.trigger="";}if(Ice.modal.running.length==0){Ice.modal.rollbacks.broadcast();Ice.modal.rollbacks=null;}}},enableDisableTabindex:function(F,C){var B=null;if(F){B=$(F);if(!B){B=document;}}else{B=document;}var G={};G.a=B.getElementsByTagName("a");G.area=B.getElementsByTagName("area");G.button=B.getElementsByTagName("button");G.input=B.getElementsByTagName("input");G.object=B.getElementsByTagName("object");G.select=B.getElementsByTagName("select");G.textarea=B.getElementsByTagName("textarea");for(listName in G){var E=G[listName];for(var A=0;A<E.length;A++){var D=E[A];if(C){if(D.oldtabIndex!=null){D.tabIndex=D.oldtabIndex;}}else{if(!D.oldtabIndex){D.oldtabIndex=D.tabIndex?D.tabIndex:"";}D.tabIndex="-1";}}}},disableTabindex:function(B,A){this.restoreTabindex();this.enableDisableTabindex(null,false);this.restoreTabindex(B);},restoreTabindex:function(A){this.enableDisableTabindex(A,true);}};Ice.autoCentre=Class.create();Ice.autoCentre={ids:[],centerAll:function(){Ice.autoCentre.ids.each(Ice.autoCentre.keepCentred);},keepCentred:function(F){var C=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var B=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var E=document.getElementById(F);if(E){Element.setStyle(E,{position:"absolute"});var A=Math.round((Element.getWidth(document.body)-Element.getWidth(E))/2+C);if(A<0){A=0;}var D=Math.round(((window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight)-Element.getHeight(E))/2+B);if(D<0){D=0;}A=A+"px";D=D+"px";Element.setStyle(E,{left:A});Element.setStyle(E,{top:D});}},start:function(B,A){Ice.autoCentre.keepCentred(B);if(Ice.autoCentre.ids.size()==0){Event.observe(window,"resize",Ice.autoCentre.centerAll);if(!A){Event.observe(window,"scroll",Ice.autoCentre.centerAll);}}if(Ice.autoCentre.ids.indexOf(B)<0&&!A){Ice.autoCentre.ids.push(B);}},stop:function(A){Ice.autoCentre.ids=Ice.autoCentre.ids.without(A);if(Ice.autoCentre.ids.size()==0){Event.stopObserving(window,"resize",Ice.autoCentre.centerAll);Event.stopObserving(window,"scroll",Ice.autoCentre.centerAll);}}};Ice.autoPosition=Class.create();Ice.autoPosition={id:null,xPos:null,yPos:null,keepPositioned:function(){var C=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;var B=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop;var E=document.getElementById(Ice.autoPosition.id);if(E){var A=Math.round(Ice.autoPosition.xPos+C)+"px";var D=Math.round(Ice.autoPosition.yPos+B)+"px";Element.setStyle(E,{position:"absolute"});Element.setStyle(E,{left:A});Element.setStyle(E,{top:D});}},start:function(D,A,E,C){Ice.autoPosition.id=D;Ice.autoPosition.xPos=A;Ice.autoPosition.yPos=E;var B=document.getElementById(D).style;if(!Prototype.Browser.IE){B.visibility="hidden";}Ice.autoPosition.keepPositioned();if(!Prototype.Browser.IE){B.visibility="visible";}if(!C){Event.observe(window,"scroll",Ice.autoPosition.keepPositioned);}},stop:function(A){if(Ice.autoPosition.id==A){Event.stopObserving(window,"scroll",Ice.autoPosition.keepPositioned);}}};Ice.iFrameFix=Class.create();Ice.iFrameFix={start:function(B,D){var C=navigator.userAgent.indexOf("MSIE");if(C==-1){return ;}var A=parseFloat(navigator.userAgent.substring(C+5));if(A>=7){return ;}var E=document.getElementById(B);if(!E){return ;}var F=document.getElementById(B+":iframe");if(!F){F=document.createElement("iframe");F.src=D;F.setAttribute("id",B+":iframe");E.appendChild(F);}F.style.position="absolute";F.style.zIndex=-1;F.style.filter="progid:DXImageTransform.Microsoft.Alpha(opacity=0)";F.style.left="0px";F.style.top="0px";F.style.width=E.offsetWidth+"px";F.style.height=E.offsetHeight+"px";}};Ice.DnD.adjustPosition=function(H){var C=$(H);var F=document.viewport.getDimensions();var B=C.getDimensions();var A=C.viewportOffset();var E=C.positionedOffset();var D=F.width-A.left-B.width;var G=F.height-A.top-B.height;if(A.left<0){C.style.left=E.left-A.left+"px";}else{if(D<0){C.style.left=E.left+D+"px";}}if(A.top<0){C.style.top=E.top-A.top+"px";}else{if(G<0){C.style.top=E.top+G+"px";}}};
Ice.Initializer=Class.create();Ice.Initializer={queuedCalls:new Array(),ranCalls:new Array(),loaded:false,addCall:function(id,call){if(Ice.Initializer.loaded){Ice.DnD.logger.debug("Call Ran");eval(call);}else{rapper=new Object();rapper.call=call;rapper.id=id;Ice.Initializer.queuedCalls[Ice.Initializer.queuedCalls.length]=rapper;Ice.DnD.logger.debug("Call Queued");}},runQueuedCalls:function(){Ice.Initializer.loaded=true;ar=Ice.Initializer.queuedCalls;var i=0;for(i=0;i<ar.length;i++){eval(ar[i].call);Ice.Initializer.ranCalls[ar[i].id]=true;}Ice.DnD.logger.debug("Run Queued Calls");}};
Ice.delimitedProperties=Class.create({initialize:function(){this.props={};},set:function(A,B){this.props[A]=B;},get:function(A){this.props[A];},deleteAll:function(){for(p in this.props){delete this.props[p];}},getPropsAsString:function(){var A="";for(p in this.props){A+=p+"!"+this.props[p]+",";}return A;},getPropsAsObject:function(){return this.props;}});
var DropRegions={init:false,SCALE:10,map:[],register:function(A){var B=A.element;var J=Position.cumulativeOffset(B);var C=[J[0]+B.offsetWidth,J[1]+B.offsetHeight];var H=Math.round(J[0]/this.SCALE);var G=Math.round(J[1]/this.SCALE);var I=Math.round(C[0]/this.SCALE)+1;var F=Math.round(C[1]/this.SCALE)+1;var E=0;var D=0;for(E=H;E<I;E++){for(D=G;D<F;D++){if(this.map[E]==null){this.map[E]=[];}if(this.map[E][D]==null){this.map[E][D]=[];}this.map[E][D].push(A);}}},drops:function(B){var A=Math.round(B[0]/DropRegions.SCALE);var C=Math.round(B[1]/DropRegions.SCALE);if(this.map[A]==null){return[];}if(this.map[A][C]==null){return[];}return this.map[A][C];}};Ice.DndEvent=Class.create();Ice.DndEvent.lastEvent=null;Ice.DndEvent.prototype={drag:null,drop:null,eventType:null,dragFire:null,dropFire:null,submitInfo:new Ice.delimitedProperties(),initialize:function(){},submit:function(){var J=this.drag.element;var F=document.getElementById("iceModalFrame"+J.id);if(F){J.style.zIndex=parseInt(F.style.zIndex)+2;}if(this.drag.options.sort==true){return ;}thisEv=J.id+"-"+this.eventType;try{Ice.DndEvent.lastEvent=thisEv;ignoreDrag=this.ignoreEvent(this.drag.options.mask);if(ignoreDrag){Ice.DnD.logger.debug("Drag Type ["+this.eventType+"] Ignored. Mask ["+this.drag.options.mask+"]");}ignoreDrop=true;if(this.drop){ignoreDrop=this.ignoreEvent(this.drop.mask);}if(this.drop){Ice.DnD.logger.debug("Drop Mask ["+this.drop.mask+"] Ignored ["+ignoreDrop+"]");}if(ignoreDrag&&ignoreDrop){return ;}if(this.drop&&ignoreDrop){Ice.DnD.logger.debug("Drop Type ["+this.eventType+"] Ignored. Mask ["+this.drop.mask+"]");}var A=false;if(this.drag.options.revert==true){A=true;}if(this.drag.options.dragGhost==true){A=true;}if(this.eventType==4||this.eventType==5||this.eventType==1){A=true;}Ice.DnD.logger.debug("DnD Event ["+this.eventType+"] ignoreCss["+A+"] value ["+Ice.DnD.StyleReader.buildStyle(J)+"]");if(!ignoreDrag){Ice.DnD.logger.debug("Drag CSS");this.populateDrag(J,A);if(this.drag.dragGhost==true){this.populateDrag(this.drag._original,A);}}if(!ignoreDrop){Ice.DnD.logger.debug("Drop CSS");this.populateDrop(this.drop.element,A);}var G=$(J.id+"clientOnly");if((!ignoreDrag||!ignoreDrop)&&!G){Ice.DnD.logger.debug("DnD Event ["+this.eventType+"] Sent");var C=Ice.util.findForm(J);var H=C.id;var D=new Object();var B=Ice.DnD.StyleReader.findCssField(J,C);Ice.DnD.logger.debug("Submitting  drag form ID["+C.id+"] CssUpdate ["+B.value+"]!");this.serializeSubmitInfo(C);try{iceSubmitPartial(C,J,D);}catch(E){Ice.DnD.logger.error("error submitting dnd event",E);}Ice.DnD.logger.debug("drag form ID["+C.id+"] submitted");if(!ignoreDrop){C=Ice.util.findForm(this.drop.element);if(C.id!=H){Ice.DnD.logger.debug("Diff ["+C.id+"]!=["+H+"] Submitting");iceSubmitPartial(C,this.drop.element,D);}}this.resetSubmitInfo(C);}}catch(I){Ice.DnD.logger.error("Could not find form in drag drop",I);}return ;},populateDrag:function(B,A){this.submitInfo.set(B.id+"status",this.eventType);if(this.drop){this.submitInfo.set(B.id+"dropID",this.drop.element.id);}if(!A){Ice.DnD.StyleReader.upload(B);}return true;},populateDrop:function(B,A){this.submitInfo.set(B.id+"status",this.eventType);this.submitInfo.set(B.id+"dropID",this.drag.element.id);if(!A){Ice.DnD.StyleReader.upload(B);}return true;},ignoreEvent:function(B){if(!B){return false;}var A=false;if(B){if(B.indexOf(this.eventType)!=-1){A=true;}}return A;},serializeSubmitInfo:function(B){var C=this.submitInfo.getPropsAsString();var A=this.getHiddenField(B);if(A){A.value=C.substring(0,C.length-1);}},resetSubmitInfo:function(B){this.submitInfo.deleteAll();var A=this.getHiddenField(B);if(A){A.value="";}},getHiddenField:function(C){var B=C.id+":iceDND";var A=document.getElementsByName(B)[0];if(A){return A;}else{Ice.DnD.logger.debug("Data field not found");}return null;}};Ice.SortEvent=Class.create();Ice.SortEvent.prototype={start:function(){Ice.DnD.logger.debug("Starting Sort Event");},end:function(){Ice.DnD.logger.debug("Ending Sort Event");}};
Draggable.prototype.dragGhost=false;Draggable.prototype.ORIGINAL_initialize=Draggable.prototype.initialize;Draggable.prototype.initialize=function(C){var B=Ice.StateMon.monitors;for(i=0;i<B.length;i++){A=B[i];if(A.id==C&&A.type=="Draggable"&&!A.rebuildingMe){Ice.DnD.logger.debug("Draggable ["+$(C).id+"] has already been created");return ;}}this.element=$(C);var D=arguments[1];if(D.dragGhost==true){this.dragGhost=true;}if(!D.starteffect){D.starteffect=function(){};}if(!D.endeffect){D.endeffect=function(){};}if(D.handle){D.handle=$(D.handle);D.handle=$(D.handle.id);}this.ORIGINAL_initialize(this.element,D);if(!D.sort){Ice.DnD.logger.debug("Draggable Created ID["+this.element.id+"]");var A=new Ice.DraggableMonitor(this.element,D);A.object=this;Ice.StateMon.add(A);}Ice.DnD.logger.debug("Draggable ["+this.element.id+"] created");};Draggable.prototype.ORIGINAL_startDrag=Draggable.prototype.startDrag;Draggable.prototype.startDrag=function(C){this.dragging=true;if(this.dragGhost==true){Ice.DnD.logger.debug("Init Drag Ghost ID["+this.element.id+"]");Draggables.register(this);try{this._ghost=this.element.cloneNode(true);var B=Ice.util.findForm(this.element);B.appendChild(this._ghost);Position.absolutize(this._ghost);Element.makePositioned(this._ghost);this._original=this.element;Position.clone(this._original,this._ghost);var D=parseInt(this._original.style.zIndex);D=isNaN(D)?0:D;this._ghost.style.left=Event.pointerX(C)+"px";this._ghost.style.zIndex=++D;this.element=this._ghost;this.eventResize=this.resize.bindAsEventListener(this);Event.observe(window,"resize",this.eventResize);}catch(A){Ice.DnD.logger.error("Error init DragGhost  ID["+this.element.id+"]",A);}}if(this.options.dragCursor){this._cursor=this.element.cloneNode(true);document.body.appendChild(this._cursor);Position.absolutize(this._cursor);var D=1+this.element.style.zIndex;this._cursor.style.zIndex=D;Ice.DnD.logger.debug("clone created");}this.ORIGINAL_startDrag(C);};Draggable.prototype.ORIGINAL_draw=Draggable.prototype.draw;Draggable.prototype.draw=function(A){if(!this.options.dragCursor){return this.ORIGINAL_draw(A);}var E=Position.cumulativeOffset(this.element);var D=this.currentDelta();E[0]-=D[0];E[1]-=D[1];var C=A;if(this.options.snap){if(typeof this.options.snap=="function"){C=this.options.snap(C[0],C[1]);}else{if(this.options.snap instanceof Array){C=C.map(function(F,G){return Math.round(F/this.options.snap[G])*this.options.snap[G];}.bind(this));}else{C=C.map(function(F){return Math.round(F/this.options.snap)*this.options.snap;}.bind(this));}}}var B=this._cursor.style;if((!this.options.constraint)||(this.options.constraint=="horizontal")){B.left=C[0]+"px";}if((!this.options.constraint)||(this.options.constraint=="vertical")){B.top=C[1]+"px";}if(B.visibility=="hidden"){B.visibility="";}};Draggable.prototype.resize=function(A){};Draggable.removeMe=function(D){$(D).undoPositioned();var C=Ice.StateMon.monitors;var F=Array();for(i=0;i<C.length;i++){monitor=C[i];try{if(monitor.id==D&&monitor.type=="Draggable"){if(monitor.object.dragging){return ;}try{var E=$(D+"clientOnly");if(!E){monitor.destroyMe=true;monitor.destroy();}}catch(B){logger.warn("Monitor ["+monitor.id+"] destroyed with exception ["+B+"]");}}else{F.push(monitor);}}catch(A){logger.error("Error destroying monitor ["+monitor.id+"] Msg ["+A+"]");}}Ice.StateMon.monitors=F;};Draggable.prototype.ORIGINAL_updateDrag=Draggable.prototype.updateDrag;Draggable.prototype.updateDrag=function(F,G){Droppables.affectedDrop=null;this.ORIGINAL_updateDrag(F,G);ad=Droppables.affectedDrop;iceEv=new Ice.DndEvent();iceEv.drag=this;if(this.dragGhost==true){var A=parseInt(this.element.offsetHeight);var C=parseInt(Element.getStyle(this.element,"top").split("px")[0]);if(Prototype.Browser.IE){C=this.element.cumulativeOffset().top;}var B=Event.pointerY(F);var E=A+C;var D=(B>C&&B<E);if(!D){this.element.style.top=B+"px";}}if(this.hoveringDrop&&!ad){iceEv.eventType=Ice.DnD.HOVER_END;}if(ad&&(!this.hoveringDrop||this.hoveringDrop.element.id!=ad.element.id)){iceEv.eventType=Ice.DnD.HOVER_START;iceEv.drop=ad;}this.hoveringDrop=(ad!=null)?ad:null;if(!iceEv.eventType){iceEv.eventType=Ice.DnD.DRAG_START;}iceEv.submit();};Draggable.prototype.ORIGINAL_finishDrag=Draggable.prototype.finishDrag;Draggable.prototype.finishDrag=function(D,E){if(!this.options.sort){this.dragging=false;if(E){iceEv=new Ice.DndEvent();iceEv.drag=this;if(this.hoveringDrop){iceEv.drop=this.hoveringDrop;iceEv.eventType=Ice.DnD.DROPPED;}else{iceEv.eventType=Ice.DnD.DRAG_CANCEL;}iceEv.submit();if(this.dragGhost==true){this.element=this._original;Element.remove(this._ghost);this._ghost=null;}if(this.options.dragCursor){Element.remove(this._cursor);this._cursor=null;}Draggable.removeMe(this.element.id);}}this.ORIGINAL_finishDrag(D,E);DropRegions.init=false;DropRegions.map=[];if(this.options.sort&&E){try{var C=Ice.util.findForm(this.element);var B=new Object();Ice.DnD.logger.debug("Submitting Sortable ["+this.element+"]");iceSubmit(C,this.element,B);}catch(A){Ice.DnD.logger.error("error submiting sortable element["+this.element+"] Err Msg["+A+"]");}}};
Droppables.affectedDrop=null;Droppables.ORIGINAL_show=Droppables.show;Droppables.show=function(A,B){if(!this.drops.length){return ;}if(this.last_active){this.deactivate(this.last_active);}var C=this.drops;if(DropRegions.init&&this.drops.all(function(D){return !D.scrollid;})){C=DropRegions.drops(A);}C.each(function(D){if(Position.within(D.element,A[0],A[1])){if(Droppables.isAffected(A,B,D)){Droppables.affectedDrop=D;if(D.onHover){D.onHover(B,D.element,Position.overlap(D.overlap,D.element));}if(D.greedy){Droppables.activate(D);}}}if(!DropRegions.init){DropRegions.register(D);}});DropRegions.init=true;};Droppables.ORIGINAL_isAffected=Droppables.isAffected;Droppables.isAffected=function(B,D,C){var A=false;A=Droppables.ORIGINAL_isAffected(B,D,C);if(A&&C.sort){if(!Ice.DnD.sortableDraggable(D)){A=false;}}return A;};Droppables.ORIGINAL_add=Droppables.add;Droppables.add=function(D,B){if(B&&!B.sort){if(D.droppableInstalled){return ;}D.droppableInstalled=true;}var C=Ice.StateMon.monitors;for(i=0;i<C.length;i++){A=C[i];if(A.id==D&&A.type=="Droppable"){return ;}}Droppables.ORIGINAL_add(D,B);if(B&&!B.sort){var A=new Ice.DroppableMonitor($(D),B);Ice.StateMon.add(A);}};
var SortableObserver=Class.create();SortableObserver.prototype={initialize:function(B,A){this.element=$(B);this.observer=A;this.lastValue=Sortable.serialize(this.element);},onStart:function(B,C){this.lastValue=Sortable.serialize(this.element);var A=Sortable.options(this.element);A.lastDrag=C;A.lastDrag=C.element.id;},onEnd:function(){Sortable.unmark();var B=Sortable.serialize(this.element);var A=Sortable.options(this.element);A.serializeValue=B;if(this.lastValue!=B){this.observer(this.element);}}};var Sortable={sortables:{},sortableElements:Array(),kids:null,_findRootElement:function(A){while(A.tagName!="BODY"){if(A.id&&Sortable.sortables[A.id]){return A;}A=A.parentNode;}},options:function(A){A=Sortable._findRootElement($(A));if(!A){return ;}return Sortable.sortables[A.id];},destroy:function(B){var C=Sortable.options(B);if(C){Draggables.removeObserver(C.element);C.droppables.each(function(E){Droppables.remove(E);});C.draggables.invoke("destroy");delete Sortable.sortables[C.element.id];var A=0;var D=Array();for(A=0;A<Sortable.sortableElements.length;A++){if(Sortable.sortableElements[A]&&Sortable.sortableElements[A].id!=C.element.id){D.push(Sortable.sortableElements[A]);}}Sortable.sortableElements=D;}},create:function(F,H,E){F=$(F);if(Ice.DnD.alreadySort(F)){Ice.DnD.logger.debug("Sort ID ["+F.id+"] already created");return ;}var B=new Ice.SortableMonitor(F,H);var D=Object.extend({element:F,tag:"li",dropOnEmpty:false,overlap:"vertical",constraint:"vertical",containment:F,handle:false,only:false,hoverclass:null,ghosting:false,format:null,onChange:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction},arguments[1]||{});this.destroy(F);var A={revert:true,ghosting:D.ghosting,constraint:D.constraint,handle:D.handle,sort:true};if(D.starteffect){A.starteffect=D.starteffect;}if(D.reverteffect){A.reverteffect=D.reverteffect;}else{if(D.ghosting){A.reverteffect=function(I){I.style.top=0;I.style.left=0;};}}if(D.endeffect){A.endeffect=D.endeffect;}if(D.zindex){A.zindex=D.zindex;}var G={overlap:D.overlap,containment:D.containment,hoverclass:D.hoverclass,onHover:Sortable.onHover,greedy:!D.dropOnEmpty,sort:true};Element.cleanWhitespace(F);D.draggables=[];D.droppables=[];if(D.dropOnEmpty){Droppables.add(F,{containment:D.containment,onHover:Sortable.onEmptyHover,greedy:false,sort:true});D.droppables.push(F);}(D.elements||this.findElements(F,D)||[]).each(function(K,I){var J=D.handles?$(D.handles[I]):(D.handle?$(K).select("."+D.handle)[0]:K);D.draggables.push(new Draggable(K,Object.extend(A,{handle:J})));Droppables.add(K,G);if(D.tree){K.treeNode=F;}D.droppables.push(K);});this.sortables[F.id]=D;this.sortableElements.push(F);B.options=D;Ice.StateMon.add(B);var C=new SortableObserver(F,D.onUpdate);Draggables.addObserver(C);},findElements:function(B,A){if(!B.hasChildNodes()){return null;}var C=[];$A(B.childNodes).each(function(D){if(D.tagName&&D.tagName.toUpperCase()==A.tag.toUpperCase()&&(!A.only||(Element.hasClassName(D,A.only)))){C.push(D);}});return(C.length>0?C.flatten():null);},onHover:function(E,D,A){if(A>0.5){Sortable.mark(D,"before");if(D.previousSibling!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,D);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}else{Sortable.mark(D,"after");var C=D.nextSibling||null;if(C!=E){var B=E.parentNode;E.style.visibility="hidden";D.parentNode.insertBefore(E,C);if(D.parentNode!=B){Sortable.options(B).onChange(E);}Sortable.options(D.parentNode).onChange(E);}}},onEmptyHover:function(C,B){if(C.parentNode!=B){var A=C.parentNode;B.appendChild(C);Sortable.options(A).onChange(C);Sortable.options(B).onChange(C);}},unmark:function(){if(Sortable._marker){Element.hide(Sortable._marker);}},mark:function(B,A){var D=Sortable.options(B.parentNode);if(!D){return ;}if(D&&!D.ghosting){return ;}if(!Sortable._marker){Sortable._marker=$("dropmarker")||document.createElement("DIV");Element.hide(Sortable._marker);Element.addClassName(Sortable._marker,"dropmarker");Sortable._marker.style.position="absolute";document.getElementsByTagName("body").item(0).appendChild(Sortable._marker);}var C=Position.cumulativeOffset(B);Sortable._marker.style.left=C[0]+"px";Sortable._marker.style.top=C[1]+"px";if(A=="after"){if(D.overlap=="horizontal"){Sortable._marker.style.left=(C[0]+B.clientWidth)+"px";}else{Sortable._marker.style.top=(C[1]+B.clientHeight)+"px";}}Element.show(Sortable._marker);},serialize:function(C){C=$(C);var B=Sortable.options(C);var A=Object.extend({tag:B.tag,only:B.only,name:C.id,format:B.format||/^[^_]*_(.*)$/},arguments[1]||{});return"first;"+B.lastDrag+";changed;"+$(this.findElements(C,A)||[]).map(function(D){return D.id;}).join(";");}};
var Autocompleter={};Autocompleter.Finder={list:new Array(),add:function(B,A){this.list[B.id]=A;},find:function(A){return this.list[A];}};Autocompleter.Base=function(){};Autocompleter.Base.prototype={baseInitialize:function(D,G,C,A,B){this.element=$(D);this.update=$(G);this.hasFocus=false;this.changed=false;this.active=false;this.index=-1;this.entryCount=0;this.rowClass=A;this.selectedRowClass=B;if(this.setOptions){this.setOptions(C);}else{this.options=C||{};}this.options.paramName=this.options.paramName||this.element.name;this.options.tokens=this.options.tokens||[];this.options.frequency=this.options.frequency||0.4;var F=typeof this.options.minChars;if(F!="number"){this.options.minChars=0;}this.options.onShow=this.options.onShow||function(H,L){var I=null;if(window.navigator.appName=="Microsoft Internet Explorer"){if(document.documentMode){I=document.documentMode;}else{if(document.compatMode&&document.compatMode=="CSS1Compat"){I=7;}else{I=5;}}}if(!L.style.position||L.style.position=="absolute"){L.style.position="absolute";Position.clone(H,L,{setHeight:false,offsetTop:H.offsetHeight});L.clonePosition(H.parentNode,{setTop:false,setWidth:false,setHeight:false,offsetLeft:H.offsetLeft-H.parentNode.offsetLeft});if(I>=7){var K=H.style.position;H.style.position="relative";L.style.left=H.offsetLeft+"px";if(I==7||H.getOffsetParent().getStyle("position")=="fixed"){L.style.top=(H.offsetTop+H.offsetHeight)+"px";}else{var J=H.cumulativeScrollOffset().top-document.documentElement.scrollTop;L.style.top=(H.offsetTop-J+H.offsetHeight)+"px";}H.style.position=K;}}Effect.Appear(L,{duration:0.15});};this.options.onHide=this.options.onHide||function(H,I){new Effect.Fade(I,{duration:0.15});};if(typeof (this.options.tokens)=="string"){this.options.tokens=new Array(this.options.tokens);}this.observer=null;this.element.setAttribute("autocomplete","off");Element.hide(this.update);Event.observe(this.element,"blur",this.onBlur.bindAsEventListener(this));var E="keypress";if(Prototype.Browser.IE||Prototype.Browser.WebKit){E="keydown";}Event.observe(this.element,E,this.onKeyPress.bindAsEventListener(this));if(Prototype.Browser.IE||Prototype.Browser.WebKit){Event.observe(this.element,"paste",this.onPaste.bindAsEventListener(this));}},show:function(){if(Element.getStyle(this.update,"display")=="none"){this.options.onShow(this.element,this.update);}if(!this.iefix&&(navigator.appVersion.indexOf("MSIE")>0)&&(navigator.userAgent.indexOf("Opera")<0)&&(Element.getStyle(this.update,"position")=="absolute")){new Insertion.After(this.update,'<iframe id="'+this.update.id+'_iefix" title="IE6_Fix" style="display:none;position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);" src="javascript:document.write(\'<html></html>\');" frameborder="0" scrolling="no"></iframe>');this.iefix=$(this.update.id+"_iefix");}if(this.iefix){setTimeout(this.fixIEOverlapping.bind(this),50);}if(this.hasFocus){this.element.focus();}},fixIEOverlapping:function(){Position.clone(this.update,this.iefix);this.iefix.style.zIndex=1;this.update.style.zIndex=2;Element.show(this.iefix);},hide:function(){this.stopIndicator();if(Element.getStyle(this.update,"display")!="none"){this.options.onHide(this.element,this.update);}if(this.iefix){Element.hide(this.iefix);}},startIndicator:function(){if(this.options.indicator){Element.show(this.options.indicator);}},stopIndicator:function(){if(this.options.indicator){Element.hide(this.options.indicator);}},onKeyPress:function(F){if(Prototype.Browser.IE&&Ice.modal.running.length){this.justPressedKey=true;if(this.justPressedKeyObserver){clearTimeout(this.justPressedKeyObserver);}var D=this;var C=parseInt(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5));var E=C==7||C==8?700:500;this.justPressedKeyObserver=setTimeout(function(){D.justPressedKey=false;},E);}if(!this.active){Ice.Autocompleter.logger.debug("Key press ignored. Not active.");switch(F.keyCode){case Event.KEY_TAB:setFocus("");case Event.KEY_RETURN:this.getUpdatedChoices(true,F,-1);return ;case Event.KEY_DOWN:this.getUpdatedChoices(false,F,-1);return ;}}Ice.Autocompleter.logger.debug("Key Press");if(this.active){switch(F.keyCode){case Event.KEY_TAB:setFocus("");case Event.KEY_RETURN:this.hidden=true;var A=this.selectEntry();Ice.Autocompleter.logger.debug("Getting updated choices on enter");this.getUpdatedChoices(true,F,A);this.hide();Event.stop(F);return ;case Event.KEY_ESC:this.hide();this.active=false;Event.stop(F);return ;case Event.KEY_LEFT:case Event.KEY_RIGHT:return ;case Event.KEY_UP:this.markPrevious();this.render();Event.stop(F);return ;case Event.KEY_DOWN:this.markNext();this.render();Event.stop(F);return ;}}else{if(F.keyCode==Event.KEY_TAB||F.keyCode==Event.KEY_RETURN){setFocus("");return ;}}this.changed=true;this.hasFocus=true;this.index=-1;this.skip_mouse_hover=true;if(this.active){this.render();}if(this.observer){clearTimeout(this.observer);}var D=this;var B=Object.clone(F);this.observer=setTimeout(function(){D.onObserverEvent(B);},this.options.frequency*1000);},onKeyDown:function(C){if(!this.active){switch(C.keyCode){case Event.KEY_TAB:setFocus("");case Event.KEY_DOWN:this.getUpdatedChoices(false,C,-1);return ;case Event.KEY_BACKSPACE:case Event.KEY_DELETE:if(this.observer){clearTimeout(this.observer);}var B=this;var A=Object.clone(C);this.observer=setTimeout(function(){B.onObserverEvent(A);},this.options.frequency*1000);return ;}}else{if(this.active){switch(C.keyCode){case Event.KEY_UP:this.markPrevious();this.render();Event.stop(C);return ;case Event.KEY_TAB:setFocus("");case Event.KEY_DOWN:this.markNext();this.render();Event.stop(C);return ;case Event.KEY_ESC:if(Prototype.Browser.WebKit){this.hide();this.active=false;Event.stop(C);return ;}case Event.KEY_BACKSPACE:case Event.KEY_DELETE:if(this.observer){clearTimeout(this.observer);}var B=this;var A=Object.clone(C);this.observer=setTimeout(function(){B.onObserverEvent(A);},this.options.frequency*1000);return ;}}}},activate:function(){this.changed=false;this.hasFocus=true;},onHover:function(B){var A=Event.findElement(B,"DIV");if(this.index!=A.autocompleteIndex){if(!this.skip_mouse_hover){this.index=A.autocompleteIndex;}this.render();}Event.stop(B);},onMove:function(A){if(this.skip_mouse_hover){this.skip_mouse_hover=false;this.onHover(A);}},onClick:function(C){this.hidden=true;var B=Event.findElement(C,"DIV");this.index=B.autocompleteIndex;var A=B.autocompleteIndex;this.selectEntry();this.getUpdatedChoices(true,C,A);this.hide();},onBlur:function(C){if(Prototype.Browser.IE&&Ice.modal.running.length&&this.justPressedKey){return ;}setFocus("");if(navigator.userAgent.indexOf("MSIE")>=0){var B=document.compatMode&&document.compatMode=="CSS1Compat";var A=B?document.documentElement:document.body;if(C.clientX>A.clientLeft+A.clientWidth||C.clientY>A.clientTop+A.clientHeight){this.element.focus();return ;}}setTimeout(this.hide.bind(this),250);this.hasFocus=false;this.active=false;},onPaste:function(C){this.changed=true;this.hasFocus=true;this.index=-1;this.skip_mouse_hover=true;if(this.active){this.render();}if(this.observer){clearTimeout(this.observer);}var B=this;var A=Object.clone(C);this.observer=setTimeout(function(){B.onObserverEvent(A);},this.options.frequency*1000);return ;},render:function(){if(this.entryCount>0){for(var B=0;B<this.entryCount;B++){if(this.index==B){ar=this.rowClass.split(" ");for(var A=0;A<ar.length;A++){Element.removeClassName(this.getEntry(B),ar[A]);}ar=this.selectedRowClass.split(" ");for(var A=0;A<ar.length;A++){Element.addClassName(this.getEntry(B),ar[A]);}}else{ar=this.selectedRowClass.split(" ");for(var A=0;A<ar.length;A++){Element.removeClassName(this.getEntry(B),ar[A]);}ar=this.rowClass.split(" ");for(var A=0;A<ar.length;A++){Element.addClassName(this.getEntry(B),ar[A]);}}}if(this.hasFocus){this.show();this.active=true;}}else{this.active=false;this.hide();}},markPrevious:function(){if(this.index>0){this.index--;}else{this.index=this.entryCount-1;}},markNext:function(){if(this.index==-1){this.index++;return ;}if(this.index<this.entryCount-1){this.index++;}else{this.index=0;}},getEntry:function(B){try{return this.update.firstChild.childNodes[B];}catch(A){return null;}},getCurrentEntry:function(){return this.getEntry(this.index);},selectEntry:function(){var A=-1;this.active=false;if(this.index>=0){A=this.index;this.updateElement(this.getCurrentEntry());this.index=-1;}return A;},updateElement:function(F){if(this.options.updateElement){this.options.updateElement(F);return ;}var C="";if(this.options.select){var A=document.getElementsByClassName(this.options.select,F)||[];if(A.length>0){C=Element.collectTextNodes(A[0],this.options.select);}}else{C=Element.collectTextNodesIgnoreClass(F,"informal");}var E=this.findLastToken();if(E!=-1){var D=this.element.value.substr(0,E+1);var B=this.element.value.substr(E+1).match(/^\s+/);if(B){D+=B[0];}this.element.value=D+C;}else{this.element.value=C;}if(this.hasFocus){this.element.focus();}if(this.options.afterUpdateElement){this.options.afterUpdateElement(this.element,F);}},updateChoices:function(C){if(!this.changed&&this.hasFocus){this.update.innerHTML=C;Element.cleanWhitespace(this.update);Element.cleanWhitespace(this.update.firstChild);if(this.update.firstChild&&this.update.firstChild.childNodes){this.entryCount=this.update.firstChild.childNodes.length;for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;this.addObservers(B);}}else{this.entryCount=0;}this.stopIndicator();this.index=-1;this.render();}else{Ice.Autocompleter.logger.debug("Not updating choices Not Changed["+this.changed+"] hasFocus["+this.hasFocus+"]");}},addObservers:function(A){Event.observe(A,"mouseover",this.onHover.bindAsEventListener(this));Event.observe(A,"click",this.onClick.bindAsEventListener(this));Event.observe(A,"mousemove",this.onMove.bindAsEventListener(this));},dispose:function(){for(var A=0;A<this.entryCount;A++){var B=this.getEntry(A);B.autocompleteIndex=A;Event.stopObserving(B,"mouseover",this.onHover);Event.stopObserving(B,"click",this.onClick);Event.stopObserving(B,"mousemove",this.onMove);}Event.stopObserving(this.element,"mouseover",this.onHover);Event.stopObserving(this.element,"click",this.onClick);Event.stopObserving(this.element,"mousemove",this.onMove);Event.stopObserving(this.element,"blur",this.onBlur);Event.stopObserving(this.element,"keypress",this.onKeyPress);if(Prototype.Browser.IE||Prototype.Browser.WebKit){Event.stopObserving(this.element,"keydown",this.onKeyDown);}Autocompleter.Finder.list[this.element.id]=null;Ice.Autocompleter.logger.debug("Destroyed autocomplete ["+this.element.id+"]");},onObserverEvent:function(A){this.changed=false;if(this.getToken().length>=this.options.minChars){this.startIndicator();this.getUpdatedChoices(false,A,-1);}else{this.active=false;this.hide();}},getToken:function(){var B=this.findLastToken();if(B!=-1){var A=this.element.value.substr(B+1).replace(/^\s+/,"").replace(/\s+$/,"");}else{var A=this.element.value;}return/\n/.test(A)?"":A;},findLastToken:function(){var C=-1;for(var B=0;B<this.options.tokens.length;B++){var A=this.element.value.lastIndexOf(this.options.tokens[B]);if(A>C){C=A;}}return C;}};Ajax.Autocompleter=Class.create();Object.extend(Object.extend(Ajax.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(C,D,B,A){this.baseInitialize(C,D,A);this.options.asynchronous=true;this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.url=B;},getUpdatedChoices:function(){entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams;}new Ajax.Request(this.url,this.options);},onComplete:function(A){this.updateChoices(A.responseText);}});Ice.Autocompleter=Class.create();Object.extend(Object.extend(Ice.Autocompleter.prototype,Autocompleter.Base.prototype),{initialize:function(A,H,I,D,E,F){Ice.Autocompleter.logger.debug("Building Ice Autocompleter ID ["+A+"]");this.partialSubmit=F;var B=Autocompleter.Finder.list[A];if(B&&!B.monitor.changeDetected()){return ;}var C=$(A);var G=$(H);this.baseInitialize(C,G,I,D,E);this.options.onComplete=this.onComplete.bind(this);this.options.defaultParams=this.options.parameters||null;this.monitor=new Ice.AutocompleterMonitor(C,G,I,D,E);this.monitor.object=this;Ice.StateMon.add(this.monitor);Autocompleter.Finder.add(this.element,this);Ice.Autocompleter.logger.debug("Done building Ice Autocompleter");if(this.monitor.changeDetected()){Ice.Autocompleter.logger.debug("Change has been detected");}},getUpdatedChoices:function(B,D,A){if(!D){D=new Object();}entry=encodeURIComponent(this.options.paramName)+"="+encodeURIComponent(this.getToken());this.options.parameters=this.options.callback?this.options.callback(this.element,entry):entry;if(this.options.defaultParams){this.options.parameters+="&"+this.options.defaultParams;}var C=Ice.util.findForm(this.element);if(A>-1){var E=this.element.id+"_idx";C[E].value=A;}if(B&&!this.partialSubmit){Ice.Autocompleter.logger.debug("Sending submit");iceSubmit(C,this.element,D);}else{Ice.Autocompleter.logger.debug("Sending partial submit");iceSubmitPartial(C,this.element,D);}},onComplete:function(A){this.updateChoices(A.responseText);},updateNOW:function(A){if(this.hidden){this.hidden=false;return ;}if(window.currentFocus&&this.element.id==window.currentFocus){this.hasFocus=true;}else{this.hasFocus=false;}Element.cleanWhitespace(this.update);this.updateChoices(A);this.show();this.render();}});
Effect.Highlight.prototype.ORIGINAL_setup=Effect.Highlight.prototype.setup;Effect.Highlight.prototype.setup=function(){if(this.element.highlighting){this.cancel();return ;}this.ORIGINAL_setup();this.element.highlighting=true;};Effect.Highlight.prototype.ORIGINAL_finish=Effect.Highlight.prototype.finish;Effect.Highlight.prototype.finish=function(){this.ORIGINAL_finish();this.element.highlighting=false;};Object.extend(Effect.DefaultOptions,{afterFinish:function(A){if(this.uploadCSS!=null){Ice.DnD.StyleReader.upload(A.element,A.options.submit);}if(A.options.iceFinish){A.options.iceFinish(A);}}});function blankEffect(){}Effect.Grow=function(C){C=$(C);var B=Object.extend({direction:"center",moveTransition:Effect.Transitions.sinoidal,scaleTransition:Effect.Transitions.sinoidal,opacityTransition:Effect.Transitions.full},arguments[1]||{});var A={top:C.style.top,left:C.style.left,height:C.style.height,width:C.style.width,opacity:C.getInlineOpacity()};var G=C.getDimensions();var H,F;var E,D;switch(B.direction){case"top-left":H=F=E=D=0;break;case"top-right":H=G.width;F=D=0;E=-G.width;break;case"bottom-left":H=E=0;F=G.height;D=-G.height;break;case"bottom-right":H=G.width;F=G.height;E=-G.width;D=-G.height;break;case"center":H=G.width/2;F=G.height/2;E=-G.width/2;D=-G.height/2;break;}return new Effect.Move(C,{x:H,y:F,duration:0.01,beforeSetup:function(I){I.element.hide().makeClipping().makePositioned();},afterFinishInternal:function(I){new Effect.Parallel([new Effect.Opacity(I.element,{sync:true,to:1,from:0,transition:B.opacityTransition}),new Effect.Move(I.element,{x:E,y:D,sync:false,transition:B.moveTransition}),new Effect.Scale(I.element,100,{scaleMode:{originalHeight:G.height,originalWidth:G.width},sync:false,scaleFrom:window.opera?1:0,transition:B.scaleTransition,restoreAfterFinish:true})],Object.extend({beforeSetup:function(J){J.effects[0].element.setStyle({height:"10px"},{width:"10px"}).show();},afterFinishInternal:function(J){J.effects[0].element.undoClipping().undoPositioned().setStyle(A);}},B));}});};
try{Ice.DnD.init();Ice.Autocompleter.logger=logger.child("autocomplete");Ice.StateMon.checkAll();Ice.StateMon.rebuild();}catch(ee){alert("Error in extras bootstrap ["+ee+"]");}window.onUnload(function(){try{Ice.StateMon.destroyAll();Autocompleter.Finder.list=new Array();}catch(A){Ice.DnD.logger.debug("Unload Error ["+A+"]");}});
var GMapRepository=new Array();var GMapWrapper=Class.create();GMapWrapper.prototype={initialize:function(A,B){this.eleId=A;this.realGMap=B;this.controls=new Object();this.overlays=new Object();this.directions=new Object();this.geoMarker=new Object();this.geoMarkerAddress;this.geoMarkerSet=false;this.currentMarker=null;this.currentInfoWindow=null;},getElementId:function(){return this.eleId;},getRealGMap:function(){return this.realGMap;},getControlsArray:function(){return this.controls;}};Ice.GoogleMap=Class.create();Ice.GoogleMap={getGeocoder:function(B){var A=GMapRepository[B+"geo"];if(A==null){GMapRepository[B+"geo"]=new GClientGeocoder();return GMapRepository[B+"geo"];}else{return A;}},getGDirection:function(E,C){var B=GMapRepository[E+"dir"];if(B==null){var D=Ice.GoogleMap.getGMapWrapper(E).getRealGMap();var A=document.getElementById(C);GMapRepository[E+"dir"]=new GDirections(D,A);return GMapRepository[E+"dir"];}else{return B;}},getGMapWrapper:function(C){var A=GMapRepository[C];if(A){var B=document.getElementById(C);if(!B.hasChildNodes()){A=Ice.GoogleMap.recreate(C,A);}}else{A=Ice.GoogleMap.create(C);}return A;},loadDirection:function(id,textDivId,from,to){var wrapper=Ice.GoogleMap.getGMapWrapper(id);var map=Ice.GoogleMap.getGMapWrapper(id).getRealGMap();service=new google.maps.DirectionsService();var origin=(from=="(")?"origin: new google.maps.LatLng"+from+", ":'origin: "'+from+'", ';var destination=(to=="(")?"destination: new google.maps.LatLng"+to+", ":'destination: "'+to+'", ';var request="({"+origin+destination+"travelMode:google.maps.TravelMode.DRIVING})";var directionsCallback=function(response,status){if(status!=google.maps.DirectionsStatus.OK){alert("Error was: "+status);}else{var renderer=(wrapper.directions[id]!=null)?wrapper.directions[id]:new google.maps.DirectionsRenderer();renderer.setMap(null);renderer.setMap(map);renderer.setDirections(response);if(textDivId){var textDiv=$(textDivId);if(textDiv){textDiv.innerHTML="";renderer.setPanel(textDiv);}}wrapper.directions[id]=renderer;}};service.route(eval(request),directionsCallback);},addOverlay:function(ele,overlayId,ovrLay){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var overlay=gmapWrapper.overlays[overlayId];if(overlay==null){overlay=eval(ovrLay);gmapWrapper.getRealGMap().addOverlay(overlay);gmapWrapper.overlays[overlayId]=overlay;}},removeOverlay:function(D,C){var A=Ice.GoogleMap.getGMapWrapper(D);var B=A.overlays[C];if(B!=null){A.getRealGMap().removeOverlay(B);}else{return ;}var E=new Object();for(overlayObj in A.overlays){if(C!=overlayObj){E[overlayObj]=A.overlays[overlayObj];}}A.overlays=E;},addKML:function(F,D,A){var B=Ice.GoogleMap.getGMapWrapper(F);var G=Ice.GoogleMap.getGMapWrapper(F).getRealGMap();var C=B.overlays[D];if(C==null||C.getMap()==null){var E=new google.maps.KmlLayer(A);E.setMap(G);B.overlays[D]=E;}},removeKML:function(D,C){var A=Ice.GoogleMap.getGMapWrapper(D);var B=A.overlays[C];if(B!=null){B.setMap(null);}else{return ;}var E=new Object();for(overlayObj in A.overlays){if(B!=overlayObj){E[overlayObj]=A.overlays[overlayObj];}}A.overlays=E;},addMarker:function(ele,overlayId,marker){var gmapWrapper=Ice.GoogleMap.getGMapWrapper(ele);var map=Ice.GoogleMap.getGMapWrapper(ele).getRealGMap();var overlay=gmapWrapper.overlays[overlayId];if(overlay==null||overlay.getMap()==null){var mapMarker=eval(marker);gmapWrapper.overlays[overlayId]=mapMarker;}},removeMarker:function(D,C){var A=Ice.GoogleMap.getGMapWrapper(D);var B=A.overlays[C];if(B!=null){B.setMap(null);}else{return ;}var E=new Object();for(overlayObj in A.overlays){if(B!=overlayObj){E[overlayObj]=A.overlays[overlayObj];}}A.overlays=E;},locateAddress:function(A,B){var D=Ice.GoogleMap.getGMapWrapper(A).getRealGMap();var C=new google.maps.Geocoder();C.geocode({address:B},function(F,E){if(E==google.maps.GeocoderStatus.OK){D.setCenter(F[0].geometry.location);Ice.GoogleMap.showMarkerAndInfoWindow(D,Ice.GoogleMap.getGMapWrapper(A),F[0]);}else{alert("Geocode was not successful for the following reason: "+E);}});},showMarkerAndInfoWindow:function(B,C,A){if(!C.currentMarker||!C.currentInfoWindow){C.currentMarker=new google.maps.Marker({draggable:false});C.currentInfoWindow=new google.maps.InfoWindow({});}C.currentMarker.setMap(B);C.currentMarker.setPosition(A.geometry.location);C.currentInfoWindow.setPosition(A.geometry.location);C.currentInfoWindow.setContent(A.formatted_address);C.currentInfoWindow.open(B);},create:function(D){var B=new GMapWrapper(D,new google.maps.Map(document.getElementById(D),{mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:8,center:new google.maps.LatLng(0,0),disableDefaultUI:"true"}));var A=document.getElementById(D+"hdn");var C=false;initializing=false;GMapRepository[D]=B;return B;},submitEvent:function(M,B,G,F){try{var A=B.getCenter();var J=$(M+"lat");var K=$(M+"lng");var C=$(M+"event");var L=$(M+"zoom");var I=$(M+"type");J.value=A.lat();K.value=A.lng();C.value=G;if(F==null){L.value=B.getZoom();}else{L.value=F;if(L.value==B.getZoom()){return ;}}var D=Ice.util.findForm(J);var E=new Object();iceSubmitPartial(D,J,E);C.value="";}catch(H){}},recreate:function(F,B){Ice.GoogleMap.remove(F);var C=B.controls;var E=B.geoMarker;var A=B.geoMarkerAddress;B=Ice.GoogleMap.create(F);B.geoMarker=E;B.geoMarkerAddress=A;B.geoMarkerSet="true";var D=new Object();for(control in C){if(D[control]==null){Ice.GoogleMap.removeControl(F,control);Ice.GoogleMap.addControl(F,control);}}return B;},addControl:function(C,E){var B=Ice.GoogleMap.getGMapWrapper(C);var D=B.controls[E];if(D==null){B.controls[E]=E;var A={};if(E=="GScaleControl"){E="scaleControl";}else{if(E=="GMapTypeControl"){E="mapTypeControl";A.mapTypeControlOptions={mapTypeIds:[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]};}else{if(E=="GOverviewMapControl"){E="overviewMapControl";A.overviewMapControlOptions={opened:true};}else{if(E=="GSmallZoomControl"){E="zoomControl";A.zoomControlOptions={style:google.maps.ZoomControlStyle.SMALL};}else{if(E=="GSmallMapControl"){E="panControl";A.zoomControl=true;A.zoomControlOptions={style:google.maps.ZoomControlStyle.SMALL};}else{if(E=="GLargeMapControl"){E="panControl";A.zoomControl=true;A.zoomControlOptions={style:google.maps.ZoomControlStyle.LARGE};}}}}}}A[E]=true;B.getRealGMap().setOptions(A);}},removeControl:function(D,F){var B=Ice.GoogleMap.getGMapWrapper(D);var E=B.controls[F];if(E!=null){var C=new Object();for(ctrl in B.controls){if(F!=ctrl){C[ctrl]=B.controls[ctrl];}}B.controls=C;var A={};if(F=="GScaleControl"){F="scaleControl";}else{if(F=="GMapTypeControl"){F="mapTypeControl";}else{if(F=="GOverviewMapControl"){F="overviewMapControl";}else{if(F=="GSmallZoomControl"){if(!B.controls.GSmallMapControl&&!B.controls.GLargeMapControl){F="zoomControl";}if(B.controls.GLargeMapControl){A.zoomControlOptions={style:google.maps.ZoomControlStyle.LARGE};}}else{if(F=="GSmallMapControl"){if(B.controls.GLargeMapControl){A.zoomControlOptions={style:google.maps.ZoomControlStyle.LARGE};}else{if(B.controls.GSmallZoomControl){F="panControl";}else{F="panControl";A.zoomControl=false;}}}else{if(F=="GLargeMapControl"){if(B.controls.GSmallMapControl){A.zoomControlOptions={style:google.maps.ZoomControlStyle.SMALL};}else{if(B.controls.GSmallZoomControl){F="panControl";A.zoomControlOptions={style:google.maps.ZoomControlStyle.SMALL};}else{F="panControl";A.zoomControl=false;}}}}}}}}A[F]=false;B.getRealGMap().setOptions(A);}},remove:function(B){var A=new Array();for(map in GMapRepository){if(map!=B){A[map]=GMapRepository[map];}}GMapRepository=A;},setMapType:function(C,B){var A=Ice.GoogleMap.getGMapWrapper(C);if(A.geoMarkerSet&&A.geoMarker!=null&&A.geoMarkerAddress!=null){A.getRealGMap().addOverlay(A.geoMarker);A.geoMarker.openInfoWindowHtml(A.geoMarkerAddress);A.geoMarkerSet=false;}if(A.getRealGMap().getMapTypeId()!=null){switch(B){case"Satellite":A.getRealGMap().setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case"Hybrid":A.getRealGMap().setMapTypeId(google.maps.MapTypeId.HYBRID);break;case"Map":A.getRealGMap().setMapTypeId(google.maps.MapTypeId.ROADMAP);break;case"Terrain":A.getRealGMap().setMapTypeId(google.maps.MapTypeId.TERRAIN);break;}}}};
var JSObjects=new Array();Ice.Repository=Class.create();Ice.Repository={obj:null,getInstance:function(_id){if(JSObjects[_id]==null){JSObjects[_id]=eval(this.obj);}return JSObjects[_id];},register:function(A,B){this.obj=B;if(JSObjects[A]==null){JSObjects[A]=this.obj;}return this.obj;},remove:function(B){var A=new Array();for(key in JSObjects){if(key==B){continue;}A[key]=JSObjects[key];}JSObjects=A;},getAll:function(){var B=new Array();var A=0;for(key in JSObjects){if(key.indexOf(":")>0){B[A++]=JSObjects[key];}}return B;}};
var visibleTooltipList=new Array();ToolTipPanelPopup=Class.create({initialize:function(I,K,A,D,E,C,J,F,H,G,B){if(!$(K)){return ;}this.src=I;this.delay=E||500;this.dynamic=(C=="true");this.tooltipCompId=K;this.srcCompId=I.id;this.hideOn=D;this.x=Event.pointerX(A);this.y=Event.pointerY(A);this.formId=J;this.ctxValue=F;this.iFrameUrl=H;this.moveWithMouse=B;this.displayOn=G;this.event=A;A.cancelBubble=true;if(this.hideOn=="mousedown"){this.hideEvent=this.hidePopupOnMouseClick.bindAsEventListener(this);}else{if(this.hideOn=="mouseout"){this.hideEvent=this.hidePopupOnMouseOut.bindAsEventListener(this);}else{this.hideOn="none";this.hideEvent=Function.NOOP;}}this.eventMouseMove=this.updateCordinate.bindAsEventListener(this);this.clearTimerEvent=this.clearTimer.bindAsEventListener(this);Event.observe(document,"mouseout",this.clearTimerEvent);Event.observe(document,this.hideOn,this.hideEvent);Event.observe(document,"mousemove",this.eventMouseMove);if(G=="hover"){this.timer=setTimeout(this.showPopup.bind(this),parseInt(this.delay));}else{this.showPopup.bind(this)();}},showPopup:function(){if(this.isTooltipVisible()){return ;}var D=this.getTooltip();if(!D){return ;}if(this.dynamic){if(D){D.style.visibility="hidden";var C=D.childNodes[0];if(C){D.removeChild(C);}}this.submit("show");if(this.hideOn=="none"){this.populateFields(true);}}else{D.style.visibility="visible";D.style.position="absolute";D.style.display="";var A=$(this.srcCompId);var E=A.cumulativeOffset();var B=A.positionedOffset();D.style.top=this.y-D.offsetHeight-4-E.top+B.top+"px";D.style.left=this.x+4-E.left+B.left+"px";if(D.getOffsetParent().hasClassName("icePnlPop")){ToolTipPanelPopupUtil.adjustPositionInDialog(D);}else{ToolTipPanelPopupUtil.adjustPosition(D,this.x,this.y);}Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);}this.addToVisibleList();if(this.event&&this.displayOn=="altclick"){Event.extend(this.event).stop();}},hidePopupOnMouseOut:function(B){if(!this.isTooltipVisible()){return ;}var A=Event.pointerX(B);var D=Event.pointerY(B);var C=$(this.tooltipCompId);if(!C){return ;}if(Position.within(C,A,D)){return ;}if(Position.within(this.src,A,D)){return ;}this.hidePopup(B);this.state="hide";this.populateFields();if(this.hideOn=="mouseout"){this.removedFromVisibleList();}this.dispose(B);},hidePopupOnMouseClick:function(A){if(!this.isTooltipVisible()||!Event.isLeftClick(A)){return ;}var B=Event.element(A);if(this.srcOrchildOfSrcElement(B)){return ;}else{this.hidePopup(A);}if(this.hideOn=="mousedown"){this.removedFromVisibleList();}this.dispose(A);},dispose:function(A){Event.stopObserving(document,this.hideOn,this.hideEvent);Event.stopObserving(document,"mousemove",this.eventMouseMove);},hidePopup:function(A){if(this.dynamic){this.submit("hide");}else{tooltip=this.getTooltip();if(!tooltip){return ;}tooltip.style.visibility="hidden";tooltip.style.display="none";}},submit:function(D,C){if(!C){C=new Object();}this.state=D;this.populateFields();var A=$(this.srcCompId);try{var B=Ice.util.findForm(A);iceSubmitPartial(B,A,C);}catch(E){logger.info("Form not found"+E);}},clearTimer:function(){Event.stopObserving(document,"mouseout",this.clearTimerEvent);clearTimeout(this.timer);},updateCordinate:function(A){if(Event.element(A)!=this.src&&!Element.descendantOf(A.element(),this.src)){return ;}this.x=Event.pointerX(A);this.y=Event.pointerY(A);if(!this.isTooltipVisible()||!this.moveWithMouse){return ;}var B=this.getTooltip();B.style.top=this.y-B.offsetHeight-4+"px";B.style.left=this.x+4+"px";ToolTipPanelPopupUtil.adjustPosition(B,this.x,this.y);Ice.iFrameFix.start(this.tooltipCompId,this.iFrameUrl);},srcOrchildOfSrcElement:function(B){var A=this.getTooltip();if(A==B){return true;}while(B.parentNode){B=B.parentNode;if(A==B){return true;}}},getTooltip:function(){return $(this.tooltipCompId);},populateFields:function(B){var A=$(this.formId);if(A==null){return ;}var C=A.getElements().find(function(D){if(D.id=="iceTooltipInfo"){return D;}});if(!C){C=document.createElement("input");C.id="iceTooltipInfo";C.name="iceTooltipInfo";C.type="hidden";A.appendChild(C);}else{}if(B){C.value="";}else{C.value="tooltip_id="+this.tooltipCompId+"; tooltip_src_id="+this.src.id+"; tooltip_state="+this.state+"; tooltip_x="+this.x+"; tooltip_y="+this.y+"; cntxValue="+this.ctxValue;}},addToVisibleList:function(){if(!this.isTooltipVisible()){this.removedFromVisibleList("all");visibleTooltipList[parseInt(visibleTooltipList.length)]={tooltipId:this.tooltipCompId,srcCompId:this.srcCompId};}else{}},removedFromVisibleList:function(C){if(this.isTooltipVisible()||C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=this.tooltipCompId){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;}else{}},isTooltipVisible:function(A){for(i=0;i<visibleTooltipList.length;i++){if(A){if(visibleTooltipList[i].tooltipId==this.tooltipCompId){return true;}}else{if(visibleTooltipList[i].tooltipId==this.tooltipCompId&&visibleTooltipList[i].srcCompId==this.srcCompId){return true;}}}return false;}});ToolTipPanelPopupUtil={removeFromVisibleList:function(C){var B=new Array();var A=-1;for(i=0;i<visibleTooltipList.length;i++){if(visibleTooltipList[i].tooltipId!=C){A=parseInt(A)+1;B[A]=visibleTooltipList[i];}else{}}visibleTooltipList=B;},adjustPositionInDialog:function(H){var B=$(H);var E=document.viewport.getDimensions();var F=document.viewport.getScrollOffsets();var A=B.getDimensions();var D=B.cumulativeOffset();var C=B.positionedOffset();var G=0;if(D.left<F.left){G=F.left-D.left;}else{if(D.left+A.width>F.left+E.width){G=(D.left+A.width)-(F.left+E.width);G=-Math.min(G,(D.left-F.left));}}B.style.left=C.left+G+"px";G=0;if(D.top<F.top){G=F.top-D.top;}else{if(D.top+A.height>F.top+E.height){G=(D.top+A.height)-(F.top+E.height);G=-Math.min(G,(D.top-F.top));}}B.style.top=C.top+G+"px";},adjustPosition:function(A,H,F){var B=$(A);var G=document.viewport.getDimensions();var E=document.viewport.getScrollOffsets();var I=B.getDimensions();var C=B.cumulativeOffset();var D=4;if(H+I.width+D>E.left+G.width){B.style.left=(E.left+G.width-I.width)+"px";}else{B.style.left=(H+D)+"px";}if(F-I.height-D<E.top){B.style.top=(E.top)+"px";}else{B.style.top=(F-(I.height+D))+"px";}},showPopup:function(C,A,B){ToolTipPanelPopupUtil.adjustPosition(C,A,B);}};
Ice.Resizable=Class.create({initialize:function(B,A){this.source=Event.element(B);this.horizontal=A;if(this.horizontal){this.pointerLocation=parseInt(Event.pointerY(B));}else{this.pointerLocation=parseInt(Event.pointerX(B));}this.eventMouseMove=this.resize.bindAsEventListener(this);this.eventMouseUp=this.detachEvent.bindAsEventListener(this);Event.observe(document,"mousemove",this.eventMouseMove);Event.observe(document,"mouseup",this.eventMouseUp);this.origionalHeight=this.source.style.height;this.disableTextSelection();this.getGhost().style.position="absolute";this.deadPoint=20;},print:function(A){logger.info(A);},getPreviousElement:function(){},getContainerElement:function(){},getNextElement:function(){},getGhost:function(){return this.source;},finalize:function(A){this.source.style.position="";this.source.style.left=Event.pointerX(A)+"px";},resize:function(A){this.getGhost().style.visibility="";if(this.deadEnd(A)){return ;}if(this.horizontal){this.getGhost().style.cursor="n-resize";var C=Event.pointerY(A)-this.getGhost().getOffsetParent().cumulativeOffset().top;this.getGhost().style.top=C+"px";}else{this.getGhost().style.cursor="e-resize";var B=Event.pointerX(A)-this.getGhost().getOffsetParent().cumulativeOffset().left;this.getGhost().style.left=B+"px";}},detachEvent:function(A){this.source.style.height=this.origionalHeight;if(this.getDifference(A)>0&&!this.deadEnd(A)){this.adjustPosition(A);}Event.stopObserving(document,"mousemove",this.eventMouseMove);Event.stopObserving(document,"mouseup",this.eventMouseUp);this.enableTextSelection();this.finalize(A);},adjustPosition:function(C){var E=Element.getWidth(this.getPreviousElement());var B=Element.getWidth(this.getNextElement());var A=Element.getWidth(this.getContainerElement());var D=this.getDifference(C);if(this.resizeAction=="inc"){this.getPreviousElement().style.width=(E+D)+"px";this.getNextElement().style.width=(B-D)+"px";this.print("Diff "+D);this.print("Td width "+E+this.getPreviousElement().id);this.print("Table width "+A);}else{this.getPreviousElement().style.width=(E-D)+"px";this.getNextElement().style.width=(B+D)+"px";}},getDifference:function(B){var A;if(this.horizontal){A=parseInt(Event.pointerY(B));}else{A=parseInt(Event.pointerX(B));}if(this.pointerLocation>A){this.resizeAction="dec";return this.pointerLocation-A;}else{this.resizeAction="inc";return A-this.pointerLocation;}},deadEnd:function(B){var C=this.getDifference(B);if(this.resizeAction=="dec"){var D;if(this.horizontal){D=Element.getHeight(this.getPreviousElement());}else{D=Element.getWidth(this.getPreviousElement());}if((D-C)<this.deadPoint){return true;}}else{var A;if(this.horizontal){A=Element.getHeight(this.getNextElement());}else{A=Element.getWidth(this.getNextElement());}if((A-C)<this.deadPoint){return true;}}return false;},disableTextSelection:function(){this.getContainerElement().onselectstart=function(){return false;};this.source.style.unselectable="on";this.source.style.MozUserSelect="none";this.source.style.KhtmlUserSelect="none";},enableTextSelection:function(){this.getContainerElement().onselectstart=function(){return true;};this.source.style.unselectable="";this.source.style.MozUserSelect="";this.source.style.KhtmlUserSelect="";}});Ice.ResizableGrid=Class.create(Ice.Resizable,{initialize:function($super,A){$super(A);logger.info(">>>>>>>>>>>>>>>>>>> ");this.cntHght=(Element.getHeight(this.getContainerElement()))+"px";this.source.style.height=this.cntHght;this.getGhost().style.left=Event.pointerX(A)+"px";this.source.style.backgroundColor="#CCCCCC";}});Ice.ResizableGrid.addMethods({getDifference:function($super,A){return $super(A);},getContainerElement:function(){return this.source.parentNode.parentNode.parentNode.parentNode;},getPreviousElement:function(){if(this.source.parentNode.previousSibling.tagName=="TH"){return this.source.parentNode.previousSibling.firstChild;}else{return this.source.parentNode.previousSibling.previousSibling.firstChild;}},getNextElement:function(){if(this.source.parentNode.nextSibling.tagName=="TH"){return this.source.parentNode.nextSibling.firstChild;}else{return this.source.parentNode.nextSibling.nextSibling.firstChild;}},resize:function($super,A){this.source.style.height=this.cntHght;this.getGhost().style.height=this.cntHght;$super(A);this.source.style.height=this.cntHght;this.getGhost().style.height=this.cntHght;},finalize:function($super,C){$super(C);this.source.style.height="1px";this.source.style.backgroundColor="transparent";this.getGhost().style.height="1px";var A=$(this.getContainerElement().id+"clientOnly");if(A){A.value=this.getAllColumnsWidth();var B=Ice.util.findForm(A);iceSubmitPartial(B,A,C);}},getAllColumnsWidth:function(){var A=this.getContainerElement();var B=A.firstChild.firstChild.childNodes;var D=2;if(Prototype.Browser.Gecko||Prototype.Browser.Safari4||Prototype.Browser.Chrome){D+=2;}var C="";for(i=0;i<B.length;i++){if(i%D==0){C+=Element.getStyle(B[i].firstChild,"width")+",";}}return C;}});Ice.PanelDivider=Class.create(Ice.Resizable,{initialize:function($super,A,B){$super(A,B);this.deadPoint=20;if(this.horizontal){var H=Element.getHeight(this.source);var G=Event.pointerY(A);this.getGhost().style.top=(G-(H))+"px";this.getGhost().style.width=(Element.getWidth(this.getContainerElement()))+"px";}else{var C=Element.getWidth(this.source);var D=parseInt(Element.getStyle(this.source,"border-left-width"));var E=parseInt(Element.getStyle(this.source,"border-right-width"));if(D&&D>=1){C-=D;}if(E&&E>=1){C-=E;}var F=Event.pointerX(A);this.getGhost().style.left=(F-(C))+"px";this.getGhost().style.width=C+"px";this.getGhost().style.height=(Element.getHeight(this.getContainerElement()))+"px";}}});Ice.PanelDivider.addMethods({getDifference:function($super,A){return $super(A);},getContainerElement:function(){return this.source.parentNode.parentNode;},getPreviousElement:function(){if(this.source.previousSibling.tagName=="DIV"){return this.source.previousSibling;}else{return this.source.previousSibling.previousSibling;}},getNextElement:function(){if(this.source.nextSibling.tagName=="DIV"){return this.source.nextSibling;}else{return this.source.nextSibling.nextSibling;}},getGhost:function(){if(!this.ghost){this.ghost=this.source.cloneNode(true);this.ghost.id=this.source.id+":ghost";this.ghost.onmousedown=null;this.source.parentNode.appendChild(this.ghost);this.ghost.style.width=Element.getWidth(this.source)+"px";this.getGhost().style.visibility="hidden";}this.ghost.setStyle({width:this.source.getStyle("width")});if(Prototype.Browser.IE&&this.horizontal){this.ghost.style.width=Element.getWidth(this.source)+"px";}return this.ghost;},finalize:function(A){Element.remove(this.ghost);},adjustPosition:function(A){logger.info("<<<<<<<<<<<<<<<<<<<<< ADJUST POSTITITITITITI >>>>>>>>>>>>>>>>");var D=this.getNextElement().style.visibility;this.getNextElement().style.visibility="hidden";if(this.horizontal){var H=(Element.getHeight(this.getPreviousElement()));var C=(Element.getHeight(this.getNextElement()));var B=Element.getHeight(this.getContainerElement());var I=(parseInt(H)+parseInt(C));var J=this.getDifference(A);var M;if(this.resizeAction=="inc"){M=(H+J)/B;topInPercent=Math.round(M*100);bottomInPercent=99-topInPercent;this.getPreviousElement().style.height=(topInPercent)+"%";}else{M=(H-J)/B;topInPercent=Math.round(M*100);bottomInPercent=99-topInPercent;this.getPreviousElement().style.height=(topInPercent)+"%";}}else{var L=(Element.getWidth(this.getPreviousElement()));var G=(Element.getWidth(this.getNextElement()));var K=(Element.getWidth(this.source));var F=Element.getWidth(this.getContainerElement());var E=(parseInt(L)+parseInt(G));var J=this.getDifference(A);if(this.resizeAction=="inc"){M=(L+J)/F;leftInPercent=Math.round(M*100);rightInPercent=100-leftInPercent;this.getPreviousElement().style.width=leftInPercent+"%";}else{M=(L-J)/F;leftInPercent=Math.round(M*100);rightInPercent=100-leftInPercent;this.getPreviousElement().style.width=leftInPercent+"%";}}Ice.PanelDivider.adjustSecondPaneSize(this.source,this.horizontal);this.getNextElement().style.visibility=D;M=M+0.01;this.submitInfo(A,M);},submitInfo:function(D,B){var C=Ice.util.findForm(this.source);var A=this.getContainerElement().id;var F=$(A+"FirstPane");var G=$(A+"SecondPane");var E=$(A+"InPercent");F.value=this.getPreviousElement().style.cssText;G.value=this.getNextElement().style.cssText;E.value=Math.round(B*100);iceSubmitPartial(C,this.source,D);}});Ice.PanelDivider.adjustSecondPaneSize=function(C,E){C=$(C);var B=$(C.parentNode);var A=$(Ice.PanelDivider.prototype.getPreviousElement.call({source:C}));var D=$(Ice.PanelDivider.prototype.getNextElement.call({source:C}));if(E){D.style.height=B.clientHeight-A.offsetHeight-C.offsetHeight+"px";}else{D.style.width=B.clientWidth-A.offsetWidth-C.offsetWidth-1+"px";}};Ice.PanelDivider.dividerHash=$H();Ice.PanelDivider.onWindowResize=function(){Ice.PanelDivider.dividerHash.each(function(A){if(!$(A.key)){Ice.PanelDivider.dividerHash.unset(A.key);return ;}Ice.PanelDivider.adjustSecondPaneSize(A.key,A.value);});};Ice.PanelDivider.adjustSecondPaneSizeObservers=$H();Ice.PanelDivider.onLoad=function(B,C){Event.stopObserving(window,"resize",Ice.PanelDivider.onWindowResize);Ice.PanelDivider.dividerHash.set(B,C);Event.observe(window,"resize",Ice.PanelDivider.onWindowResize);var A=Ice.PanelDivider.adjustSecondPaneSizeObservers.get(B);if(A){Ice.PanelDivider.adjustSecondPaneSize(B,C);}else{A=Ice.PanelDivider.adjustSecondPaneSizeObservers.set(B,Ice.PanelDivider.adjustSecondPaneSize.curry(B,C));Event.observe(window,"load",A);}Ice.PanelDivider.adjustPercentBasedHeight(B,C);};ResizableUtil={adjustHeight:function(D){var A=Element.getHeight(D);var B=parseInt(Element.getStyle(D,"padding-top"));var C=parseInt(Element.getStyle(D,"padding-top"));if(B&&B>1){A-=B;}if(C&&C>1){A-=C;}D.firstChild.style.height=(A-1)+"px";}};Ice.PanelDivider.adjustPercentBasedHeight=function(D,G){if(G){return ;}var F=D.replace(/Divider$/,"");var A=$(F);var B=Element.getStyle(A,"height");var E=null;if(B&&B.indexOf("%")>0){E=B.split("%")[0];}if(E){parentHeight=Ice.PanelDivider.getParentHeight(A);newVal=Math.round(parentHeight*(E/100));A.style.height=newVal+"px";$(D).style.height=newVal+"px";}var C=null;if(window.navigator.appName=="Microsoft Internet Explorer"){if(document.documentMode){C=document.documentMode;}else{if(document.compatMode&&document.compatMode=="CSS1Compat"){C=7;}else{C=5;}}}if(C==5&&B){Element.previous(D).style.height=B;Element.next(D).style.height=B;}};Ice.PanelDivider.getParentHeight=function(B){if(B.tagName=="BODY"){var C=document.viewport.getHeight();if(Prototype.Browser.WebKit&&typeof window.innerHeight!="undefined"){C=window.innerHeight;}return(C-4);}var A=Element.getStyle(B,"height");if(A.indexOf("%")>0){return Ice.PanelDivider.getParentHeight(B.parentNode);}else{A=Element.getHeight(B);if(A=="2"){return Ice.PanelDivider.getParentHeight(B.parentNode);}}return A;};
Ice.KeyNavigator=Class.create({initialize:function(B,A){this.component=$(B);if(A){this.component.onkeydown=this.keydown.bindAsEventListener(this);}},keydown:function(A){this.srcElement=Event.element(A);switch(A.keyCode){case Event.KEY_RETURN:this.showMenu(A);break;case Event.KEY_UP:this.goNorth(A);Event.stop(A);break;case Event.KEY_DOWN:this.goSouth(A);Event.stop(A);break;case Event.KEY_LEFT:this.goWest(A);Event.stop(A);break;case Event.KEY_RIGHT:this.goEast(A);Event.stop(A);break;}},goNorth:function(A){},goSouth:function(A){},goWest:function(A){},goEast:function(A){}});Ice.MenuBarKeyNavigator=Class.create(Ice.KeyNavigator,{initialize:function($super,B,C,D,A){$super(B,A);this.displayOnClick=C;this.scrollableDivMode=D;this.component.onclick=this.hideAll.bindAsEventListener(this);document.onclick=this.hideAllDocument.bindAsEventListener(this);if(Element.hasClassName(this.component,"iceMnuBarVrt")){this.vertical=true;}else{this.vertical=false;}this.clicked=true;this.configureRootItems();}});Ice.MenuBarKeyNavigator.addMethods({goEast:function(A){this.applyFocus("e");},goWest:function(A){this.applyFocus("w");},goSouth:function(A){this.applyFocus("s");},goNorth:function(A){this.applyFocus("n");},focusMenuItem:function(B,E,G){var D=this.srcElement.up(B);if(D){if(G=="e"){var F=$(D.id+"_sub");this.focusAnchor(F);return ;}if(G=="w"){var A=$(D.id.substring(0,D.id.length-6));if(A){this.focusAnchor(A);}else{this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));}return ;}var C=null;if(E){C=D.next(B);}else{C=D.previous(B);if(!C&&G=="n"){this.focusAnchor($(D.id.substring(0,D.id.lastIndexOf(":"))));return ;}}this.focusAnchor(C);}},focusSubMenuItem:function(A){if(A){var B=$(A.id+"_sub");this.focusAnchor(B);}},focusAnchor:function(B){if(B){try{var A=B.down("a");A.focus();}catch(C){}}},applyFocus:function(E){var C=this.srcElement.parentNode;var B=Element.hasClassName(C,this.getPopupMenuClass());var D=Element.hasClassName(C,this.getMenuBarItemClass());var A=Element.hasClassName(C,this.getMenuItemClass());if(D){switch(E){case"s":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass(),true);}else{this.focusSubMenuItem(C);}break;case"e":if(this.vertical){this.focusSubMenuItem(C);}else{this.focusMenuItem("."+this.getMenuBarItemClass(),true);}break;case"w":this.focusMenuItem("."+this.getMenuBarItemClass());break;case"n":if(this.vertical){this.focusMenuItem("."+this.getMenuBarItemClass());}break;}}else{if(A){this.focusMenuItem("."+this.getMenuItemClass(),E=="s",E);}else{if(B){switch(E){case"n":this.focusMenuItem("."+this.getPopupMenuClass());break;case"s":this.focusMenuItem("."+this.getPopupMenuClass(),true);break;case"e":this.focusSubMenuItem(C);break;}}}}},getMenuBarItemClass:function(A){if(this.vertical){return"iceMnuBarVrtItem";}else{return"iceMnuBarItem";}},getSubMenuClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenu";}else{return"iceMnuBarSubMenu";}},getSubMenuIndClass:function(A){if(this.vertical){return"iceMnuBarVrtSubMenuInd";}else{return"iceMnuBarSubMenuInd";}},getRootClass:function(){if(this.vertical){return"iceMnuBarVrt";}else{return"iceMnuBar";}},getMenuItemClass:function(){return"iceMnuItm";},getPopupMenuClass:function(){return"iceMnuPopVrtItem";},hover:function(D,B,A){if(!A){if(Ice.Menu.currentHover&&Ice.Menu.currentHover==B.id){return ;}}Ice.Menu.currentHover=B.id;if(this.clicked){if(this.displayOnClick&&Ice.Menu.lastClickedMenu!=this.component.id){this.clicked=false;return ;}var C=$(B.id+"_sub");Ice.Menu.hideOrphanedMenusNotRelatedTo(B);if(this.vertical){Ice.Menu.show(this.component,C,B);}else{Ice.Menu.show(B,C,null,this.scrollableDivMode);}}},mousedown:function(B,A){Ice.Menu.lastClickedMenu=this.component.id;if(this.clicked){this.clicked=false;}else{this.clicked=true;this.hover(B,A,true);}},focus:function(B,A){this.hover(B,A);},configureRootItems:function(){var B=this.component.childNodes;for(i=0;i<B.length;i++){var C=B[i];if(C.tagName=="DIV"){if(Element.hasClassName(C,this.getMenuBarItemClass())){C.onmouseover=this.hover.bindAsEventListener(this,C);var A=C.firstChild;if(A.tagName=="A"){A.onfocus=this.focus.bindAsEventListener(this,C);}if(this.displayOnClick){C.onmousedown=this.mousedown.bindAsEventListener(this,C);this.clicked=false;}}}}},hideAll:function(C){element=Event.element(C);var A=element.up("."+this.getMenuBarItemClass());var B=C.element();if(B&&B.match("a[onclick]")){B=B.down();}if(B){B=B.up(".iceMnuItm a[onclick^='return false']");}if(!(A&&this.clicked)&&!B){Ice.Menu.lastClickedMenue=null;Ice.Menu.hideAll();if(this.displayOnClick){this.clicked=false;}}C.stopPropagation();},hideAllDocument:function(A){Ice.Menu.lastClickedMenu="document";if(this.displayOnClick){this.clicked=false;}Ice.Menu.hideAll();},showMenu:function(B){element=Event.element(B);var A=element.up("."+this.getMenuBarItemClass());if(A&&this.displayOnClick){this.mousedown(B,A);}}});
Ice.dataTable={};Ice.dataTable.DataTable=Class.create({initialize:function(A){this.id=A;this.resizeObserver=this.resize.bindAsEventListener(this);},resize:function(){var K=$(this.id);if(!K){return ;}var C=K.select("div.iceDatTblScrlSpr")[0];if(!C){return ;}var H=C.select("table > thead > tr > th:last-child > div")[0];var G=K.select("div.iceDatTblScrlSpr + div")[0];if(!G){return ;}var J=G.getStyle("borderLeftWidth");var A=G.getStyle("borderRightWidth");if(Prototype.Browser.IE&&G.scrollHeight>G.clientHeight){G.style.overflowX="hidden";G.style.overflowY="scroll";}var B=G.getWidth();var E=B-G.clientWidth;if(E==0){return ;}G.setStyle({borderLeftWidth:0,borderRightWidth:0});var F=G.select("table")[0];var I=C.select("table")[0];if(H){H.setStyle({width:E+"px"});}var F=G.select("table")[0];if(F){var D=F.getWidth();if(Prototype.Browser.IE){}}G.setStyle({borderLeftWidth:J,borderRightWidth:A});}});Ice.dataTable.DataTable.hash=$H();Ice.dataTable.onLoad=function(B){var A=Ice.dataTable.DataTable.hash.get(B);if(A){Event.stopObserving(window,"load",A.resizeObserver);Event.stopObserving(window,"resize",A.resizeObserver);}A=new Ice.dataTable.DataTable(B);A.resize();Event.observe(window,"load",A.resizeObserver);Event.observe(window,"resize",A.resizeObserver);Ice.dataTable.DataTable.hash.set(B,A);};
Ice.PanelConfirmation=Class.create({initialize:function(B,F,E,G,A,H,C,D){this.srcComp=B;this.event=F;this.panel=$(E);this.url=C;this.srcHandler=D;this.isAutoCentre=G;this.isDraggable=A;this.isAtMouse=H;Ice.PanelConfirmation.current=this;this.showPanel();},showPanel:function(){Ice.modal.start(this.panel.id,this.url);Ice.iFrameFix.start(this.panel.id,this.url);this.panel.style.display="";this.handleDraggableObject();Ice.autoPosition.stop(this.panel.id);if(this.isAtMouse){this.panel.style.left=parseInt(Event.pointerX(this.event))+"px";this.panel.style.top=parseInt(Event.pointerY(this.event))+"px";}else{Ice.autoCentre.start(this.panel.id);}if(!this.isAutoCentre){Ice.autoCentre.stop(this.panel.id);}this.setDefaultFocus();},accept:function(){this.close();setFocus(this.srcComp.id);this.srcHandler.call(this.srcComp,this.event);},cancel:function(){this.close();},close:function(){Ice.PanelConfirmation.current=null;this.panel.style.visibility="hidden";this.panel.style.display="none";Ice.modal.stop(this.panel.id);Ice.autoCentre.stop(this.panel.id);Draggable.removeMe(this.panel.id);Ice.Focus.setFocus(this.srcComp.id);},handleDraggableObject:function(){if(this.isDraggable){Ice.DnD.adjustPosition(this.panel.id);new Draggable(this.panel.id,{handle:this.panel.id+"-handle",dragGhost:false,dragCursor:false,ghosting:false,revert:false,mask:"1,2,3,4,5"});}},setDefaultFocus:function(){var A=$(this.panel.id+"-cancel");if(A){A.focus();}else{$(this.panel.id+"-accept").focus();}}});Ice.PanelConfirmation.current=null;
Ice.Calendar={};Ice.Calendar.listeners={};Ice.Calendar.addCloseListener=function(D,B,C,A){if(Ice.Calendar.listeners[D]){return ;}else{Ice.Calendar.listeners[D]=new Ice.Calendar.CloseListener(D,B,C,A);}};Ice.Calendar.CloseListener=Class.create({initialize:function(D,B,C,A){this.calendarId=D;this.formId=B;this.commandLinkId=C;this.hiddenFieldId=A;this.popupId=this.calendarId+"_ct";this.buttonId=this.calendarId+"_cb";this.handler=this.closePopupOnClickOutside.bindAsEventListener(this);Event.observe(document,"mousedown",this.handler);},closePopupOnClickOutside:function(A){if(this.getPopup()){if(this.isInPopup(A.element())){return ;}if(this.isWithin(this.getPopup(),A)){return ;}if(A.element()==this.getButton()){this.dispose();return ;}var B=A.element().id;if(B){setFocus(B);}else{setFocus("");}this.submit(A);this.dispose();}},isInPopup:function(A){if(A.id==this.popupId){return true;}if(A==undefined||A==document){return false;}return this.isInPopup(A.parentNode);},isWithin:function(A,B){return Position.within(A,Event.pointerX(B),Event.pointerY(B));},dispose:function(){Ice.Calendar.listeners[this.calendarId]=null;Event.stopObserving(document,"mousedown",this.handler);},submit:function(A){document.forms[this.formId][this.commandLinkId].value=this.getButton().id;document.forms[this.formId][this.hiddenFieldId].value="toggle";iceSubmitPartial(document.forms[this.formId],this.getButton(),A);},getPopup:function(){return $(this.popupId);},getButton:function(){return $(this.buttonId);}});
Ice.treeNavigator=Class.create();Ice.treeNavigator={handleFocus:function(F,B,A){var E=F.type;if(E=="click"){Ice.treeNavigator.reset();return ;}var G=Event.element(F);var C=F.keyCode;var D=null;if(G&&G.firstChild&&G.firstChild.getAttribute){D=G.firstChild.getAttribute("src");}if(!D){return ;}switch(C){case 37:if(D.indexOf("top_close_no_siblings")>0||D.indexOf("middle_close")>0||D.indexOf("bottom_close")>0){logger.info("LEFT_KEY: top_close_no_siblings FOUND, root Node opend close it and reinitialize index");G.onclick();Ice.treeNavigator.reset();return false;}break;case 39:if(D.indexOf("top_open_no_siblings")>0||D.indexOf("middle_open")>0||D.indexOf("bottom_open")>0){G.onclick();Ice.treeNavigator.reset();return false;}break;case 38:if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}if(D){if(D.indexOf("top_close_no_siblings")>0){Ice.treeNavigator.index=1;Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();}Ice.treeNavigator.focusPrevious();}else{Ice.treeNavigator.focusPrevious();}return false;case 40:logger.info("down");if(!Ice.treeNavigator.anchors){Ice.treeNavigator.updateAnchor(B,G,A);}Ice.treeNavigator.focusNext();return false;}},index:0,anchors:null,reset:function(){Ice.treeNavigator.index=0;Ice.treeNavigator.anchors=null;},focusNext:function(A){if(Ice.treeNavigator.index<(Ice.treeNavigator.anchors.length-1)){Ice.treeNavigator.index=Ice.treeNavigator.index+1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},focusPrevious:function(A){if(Ice.treeNavigator.index>0){Ice.treeNavigator.index=Ice.treeNavigator.index-1;}Ice.treeNavigator.anchors[Ice.treeNavigator.index].focus();},updateAnchor:function(B,D,A){var C=[];if(A){C=B.parentNode.getElementsByTagName("a");for(i=0;C.length>i;i++){if(D==C[i]){Ice.treeNavigator.index=i;}}}else{_anchors=B.parentNode.getElementsByTagName("a");j=0;for(i=0;_anchors.length>i;i++){if(_anchors[i].firstChild.src&&_anchors[i].firstChild.src.indexOf("tree_nav")>0){if(D==_anchors[i]){Ice.treeNavigator.index=j;}C[j++]=_anchors[i];}}}Ice.treeNavigator.anchors=C;}};
Ice.selectChange=function(F,E,D,A){if(!A){A=300;}if(E.timeout){clearTimeout(E.timeout);E.removeAttribute("timeout");}else{var C=new Date();var B=C.getTime();if(!E.lastTime||((B-E.lastTime)>A)||(A<=0)){E.lastTime=C.getTime();return iceSubmitPartial(F,E,D);}}E.timeout=setTimeout(function(){E.removeAttribute("timeout");var G=new Date();E.lastTime=G.getTime();iceSubmitPartial(F,E,null);},A);};
Ice.Menu=Class.create();Ice.Menu={menuContext:null,currentMenu:null,currentHover:null,lastClickedMenu:null,openMenus:new Array(0),printOpenMenus:function(){var B="";for(var A=0;A<Ice.Menu.openMenus.length;A++){B=B+Ice.Menu.openMenus[A].id+" , ";}return B;},printHoverMenuAndOpenMenus:function(A){alert("hoverMenu=["+A.id+"]\nopenMenus=["+Ice.Menu.printOpenMenus()+"]");},printArray:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B]+", ";}return A;},printArrayOfIds:function(C){var A="";for(var B=0;B<C.length;B++){A=A+C[B].id+", ";}return A;},hideAll:function(){for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].iframe){Ice.Menu.openMenus[A].iframe.hide();}Ice.Menu.openMenus[A].style.display="none";}Ice.Menu.openMenus=new Array();Ice.Menu.currentMenu=null;Ice.Menu.menuContext=null;Ice.Menu.currentHover=null;},getPosition:function(C,B){var A=0;while(C!=null){A+=C["offset"+B];C=C.offsetParent;}return A;},show:function(I,A,E,B){if(A){var C=$(A);if(C&&C.style.display==""){return ;}Ice.Menu.showMenuWithId(A);var J=I.viewportOffset(),K=A.viewportOffset(),G=document.viewport,D=I.offsetWidth,M=A.offsetWidth,F=A.offsetHeight,L=I.offsetHeight;E=$(E);if(E){var H=E.offsetHeight;if(J.left+D+M<G.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:D},J);}else{A.clonePosition(I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:D});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-M},J);}else{A.clonePosition(I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:-M});}}if(E.viewportOffset().top+F<G.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,E,{setLeft:false,setWidth:false,setHeight:false});}else{A.clonePosition(E,{setLeft:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,E,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-F+H});}else{A.clonePosition(E,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-F+H});}}}else{if(J.left+M<G.getWidth()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setTop:false,setWidth:false,setHeight:false},J);}else{A.clonePosition(I,{setTop:false,setWidth:false,setHeight:false});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:G.getWidth()-J.left-M},J);}else{A.clonePosition(I,{setTop:false,setWidth:false,setHeight:false,offsetLeft:G.getWidth()-J.left-M});}}if(J.top+L+F<G.getHeight()){if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setLeft:false,setWidth:false,setHeight:false,offsetTop:L},J);if(B){if(parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))<8&&I.cumulativeScrollOffset().top>0){A.style.top=A.offsetTop-I.viewportOffset().top+I.positionedOffset().top;}}}else{A.clonePosition(I,{setLeft:false,setWidth:false,setHeight:false,offsetTop:L});}}else{if(Prototype.Browser.IE){Ice.clonePositionIE(A,I,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-F},J);}else{A.clonePosition(I,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-F});}}}K.top=A.viewportOffset().top;if(B){K.top=A.cumulativeOffset().top-document.viewport.getScrollOffsets().top;}if(K.top<0){A.clonePosition(A,{setLeft:false,setWidth:false,setHeight:false,offsetTop:-K.top});}Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showPopup:function(H,G,A){Ice.Menu.hideAll();A=$(A);if(A){Ice.Menu.showMenuWithId(A);var F=H+"px";A.style.left=F;var C=A.viewportOffset().left;var I=A.getWidth();var E=document.viewport.getWidth();var B=C+I-E;if(B>0){A.style.left=H-B+"px";}var D=G+"px";A.style.top=D;Ice.Menu.showIframe(A);}Ice.Menu.currentMenu=A;},showIframe:function(B){if(!Prototype.Browser.IE){return ;}if(parseFloat(navigator.userAgent.substring(navigator.userAgent.indexOf("MSIE")+5))>=7){return ;}var A=B.iframe;if(!A){var C='javascript:document.write("<html><html>");';B.iframe=A=new Element("iframe",{src:C,frameborder:"0",scrolling:"no"});A.setStyle({position:"absolute",opacity:0}).hide();B.insert({before:A});}if(Prototype.Browser.IE){Ice.clonePositionIE(A,B);}else{Element.clonePosition(A,B);}A.show();},contextMenuPopup:function(D,B,G){var F=$(B+"_dynamic");if(!D){D=window.event;}if(D){D.returnValue=false;D.cancelBubble=true;if(D.stopPropagation){D.stopPropagation();}var A=0;var H=0;if(D.pageX||D.pageY){A=D.pageX;H=D.pageY;}else{if(D.clientX||D.clientY){A=D.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;H=D.clientY+document.body.scrollTop+document.documentElement.scrollTop;}}if(F){F.value=A+", "+H+", "+B+", "+G;try{var C=Ice.util.findForm(F);iceSubmitPartial(C,F,D);}catch(E){logger.info("Form not found"+E);}return ;}Ice.Menu.showIt(A,H,B,G);}},showIt:function(A,D,B,C){Ice.Menu.showPopup(A,D,B.strip());Event.observe(document,"click",Ice.Menu.hidePopupMenu);Ice.Menu.setMenuContext(C.strip());},setMenuContext:function(A){if(Ice.Menu.menuContext==null){Ice.Menu.menuContext=A;}},hideOrphanedMenusNotRelatedTo:function(H){var I=new Array();var G=H.id.split(":");var A="";for(var F=0;F<G.length;F++){A=A+G[F];var B=new Array(A+"_sub");I=I.concat(B);A=A+":";}var E=Ice.Menu.openMenus.length;var J=new Array();for(var D=0;D<E;D++){var L=$(Ice.Menu.openMenus[D]);var K="false";for(var C=0;C<I.length;C++){if(L.id==I[C]){K="true";}}if(K!="true"){J[J.length]=L.id;if(L==Ice.Menu.currentMenu){Ice.Menu.currentMenu=null;}}}Ice.Menu.hideMenusWithIdsInArray(J);},hideSubmenu:function(C){var D=Ice.Menu.currentMenu;var A=C.id.substring(0,C.id.lastIndexOf(":"));var B=D.id.substring(0,D.id.lastIndexOf(":"));if(A==B){Ice.Menu.hideMenuWithId(Ice.Menu.currentMenu);}},hideMenusWithIdsInArray:function(B){if(B){for(var A=0;A<B.length;A++){Ice.Menu.hideMenuWithId(B[A]);}}},hideMenuWithId:function(A){A=$(A);if(A){if(A.iframe){A.iframe.hide();}A.style.display="none";Ice.Menu.removeFromOpenMenus(A);}return ;},removeFromOpenMenus:function(C){var B=new Array();for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id!=C.id){B=B.concat(new Array(Ice.Menu.openMenus[A]));}}Ice.Menu.openMenus=B;},showMenuWithId:function(A){if(A){A=$(A);A.style.display="";Ice.Menu.addToOpenMenus(A);}},addToOpenMenus:function(D){if(D){D=$(D);var C="false";for(var A=0;A<Ice.Menu.openMenus.length;A++){if(Ice.Menu.openMenus[A].id==D.id){C="true";break;}}if(C!="true"){var B=new Array(D);Ice.Menu.openMenus=Ice.Menu.openMenus.concat(B);}}},appendHoverClasses:function(C){var A=C.className.replace(/^\s+|\s+$/g,"").split(/\s+/);if(A[0]==""){return ;}for(var B=0;B<A.length;B++){if(A[B]=="portlet-menu-item-selected"){C.className+=" portlet-menu-item-hover-selected";}else{C.className+=" "+A[B]+"-hover";}}},removeHoverClasses:function(B){var C=B.className.replace(/^\s+|\s+$/g,"").split(/\s+/).length/2;var A=new RegExp("( portlet-menu-item-hover-selected| \\S+-hover){"+C+"}$");B.className=B.className.replace(A,"");},hidePopupMenu:function(){Ice.Menu.hideAll();Event.stopObserving(document,"click",Ice.Menu.hidePopupMenu);},hideOnMouseOut:function(C,B){if(!B){B=window.event;}if(B){var A;A=B.relatedTarget;if(!A){A=B.toElement;}if(A){if(!Ice.Menu.isInMenu(A,C)){Ice.Menu.hideAll();}}}},isInMenu:function(A,B){if(A.id==B){return true;}if(A==undefined||A==document){return false;}return Ice.Menu.isInMenu(A.parentNode,B);},cancelEvent:function(A){if(window.event){A.cancelBubble=true;}else{if(A.stopPropagation){A.stopPropagation();}}return false;}};Ice.clonePositionIE=function(E,A,L,K){logger.info("Using clonePosition() optimized for IE");var L=Object.extend({setLeft:true,setTop:true,setWidth:true,setHeight:true,offsetTop:0,offsetLeft:0},arguments[2]||{});E=$(E);var B=null;if(K){B=K;}else{B=A.viewportOffset();}var J=[0,0];var I=null;if(Element.getStyle(E,"position")=="absolute"){I=E.getOffsetParent();var H=Element.getStyle(I,"top");var C=Element.getStyle(I,"left");var F=document.documentElement.scrollTop;var D=document.documentElement.scrollLeft;var G=false;_viewportOffset=I._viewportOffset;if(!_viewportOffset){I._top=null;I._left=null;I._bodyScrollTop=F;I._bodyScrollLeft=D;G=true;}else{G=!((I._top==H&&I._left==C)&&(I._bodyScrollTop==F&&I._bodyScrollLeft==D));}I._top=H;I._left=C;I._bodyScrollTop=F;I._bodyScrollLeft=D;if(G){J=I.viewportOffset();I._viewportOffset=J;}else{J=I._viewportOffset;}}if(L.setLeft){E.style.left=(B[0]-J[0]+L.offsetLeft)+"px";}if(L.setTop){E.style.top=(B[1]-J[1]+L.offsetTop)+"px";}if(L.setWidth){E.style.width=A.offsetWidth+"px";}if(L.setHeight){E.style.height=A.offsetHeight+"px";}return E;};
}
